<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>JDBC相关操作</title>
    <url>/2022/08/03/JavaWeb/Mysql/JDBC%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h3 id="JDBC-Java-DataBase-Connectivity"><a href="#JDBC-Java-DataBase-Connectivity" class="headerlink" title="JDBC(Java DataBase Connectivity)"></a>JDBC(Java DataBase Connectivity)</h3><p>JDBC是使用Java语言操作关系型数据库的一套API，用一套Java代码操作不同的关系型数据库</p>
<span id="more"></span>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803142756.png" width=80%></div>

<p>实现步骤：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803142935.png" width=80%></div>

<h4 id="JDBC快速入门"><a href="#JDBC快速入门" class="headerlink" title="JDBC快速入门"></a>JDBC快速入门</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC快速入门</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCdemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. 获取连接(8.x之后版本的配置方法)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mydb1?useSSL=false&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">        <span class="comment">// 需要显示关闭SSL和指定时区</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;801299&quot;</span>;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, username, pwd);</span><br><span class="line">        <span class="comment">// 3. 定义sql语句,mudb1中有一张student表,我们查询表结构</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from student&quot;</span>;</span><br><span class="line">        <span class="comment">// 4. 获取执行sql的对象:statement</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="comment">// 5. 执行sql</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">result</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line">        <span class="comment">//resultset内部有一个可移动的光标，默认是指向第一条记录</span></span><br><span class="line">        <span class="comment">// 6. 查看结果</span></span><br><span class="line">        <span class="keyword">while</span>(result.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> result.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            System.out.println(id + <span class="string">&quot; &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 7. 释放资源</span></span><br><span class="line">        result.close();</span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="JDBC’s-API详解"><a href="#JDBC’s-API详解" class="headerlink" title="JDBC’s API详解"></a>JDBC’s API详解</h4><h4 id="DriverManager"><a href="#DriverManager" class="headerlink" title="DriverManager"></a>DriverManager</h4><p>驱动管理类是一个工具类，内部都是静态static方法，作用：</p>
<ul>
<li>注册驱动<br>上面的代码中，使用的是Class.forName，通过反射来获取类，但这个类的内部实际上是一个静态代码块，静态代码块会随着class的加载自动执行，从而实现了驱动注册</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803151858.png" width=90%></div>

<blockquote>
<p>在5.0之后的jdbc驱动版本中，可以直接省略注册驱动这一步，会自动加载jar包中META-INF&#x2F;services&#x2F;java.sql.Driver文件中的驱动类</p>
</blockquote>
<ul>
<li>获取数据库连接<br>注册完成之后，就可以直接使用DriverManager这个类中的静态方法getConnection来获取数据库的连接，在方法中需要指定url、user、password，以完成数据库的连接</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803152542.png" width=80%></div>

<h4 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h4><p>数据库连接对象，由上面getConnection静态方法产生，作用：</p>
<ul>
<li>获取执行SQL语句的对象，这个sql语句包含了之前学习的DDL、DML、DQL</li>
<li>管理事务</li>
</ul>
<p>获取执行SQL的对象createStatement，通过获取到的对象再执行相应的SQL语句</p>
<ul>
<li>普通执行SQL对象<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Statement <span class="title function_">createStatement</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li>
<li>预编译SQL的执行SQL对象：防止SQL注入<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">PreparedStatement prepareStatement(<span class="keyword">sql</span>);</span><br></pre></td></tr></table></figure></li>
<li>执行存储过程的对象(不常用)<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">CallableStatement prepareCall(<span class="keyword">sql</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>事务管理</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803162415.png" width=80%></div>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 开启事务</span></span><br><span class="line">    conn.setAutoCommit(<span class="literal">false</span>);  <span class="comment">// 手动开启事务</span></span><br><span class="line">    <span class="comment">// 执行sql1</span></span><br><span class="line">    <span class="comment">// 执行sql2</span></span><br><span class="line">    <span class="comment">// 提交事务</span></span><br><span class="line">    conn.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception throwables) &#123;  <span class="comment">// 执行sql过程中产生异常才会回滚</span></span><br><span class="line">    <span class="comment">// 回滚事务</span></span><br><span class="line">    conn.rollback();</span><br><span class="line">    throwables.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h4><p>Statement支持DML、DDL、DQL语句</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803162944.png" width=80%></div>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC API 详解：statement</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCdemo2_statement</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行DML语句:对表中数据的增删改</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDML</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 注册驱动</span></span><br><span class="line"><span class="comment">//        Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span></span><br><span class="line">        <span class="comment">// 2. 获取连接(8.x之后版本的配置方法)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mydb1?useSSL=false&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">        <span class="comment">// 需要显示关闭SSL和指定时区</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;801299&quot;</span>;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, username, pwd);</span><br><span class="line">        <span class="comment">// 3. 定义sql语句,mudb1中有一张student表,我们查询表结构</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update student set english=90 where id=1&quot;</span>;</span><br><span class="line">        <span class="comment">// 4. 获取执行sql的对象:statement</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="comment">// 5. 执行sql</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> stmt.executeUpdate(sql);  <span class="comment">// 返回执行完DML语句后受影响的行数</span></span><br><span class="line">        <span class="comment">// 6. 查看结果</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) System.out.println(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;修改失败&quot;</span>);</span><br><span class="line">        <span class="comment">// 7. 释放资源</span></span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行DDL语句:对数据库和数据库中表的相关操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDDL</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 注册驱动</span></span><br><span class="line"><span class="comment">//        Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span></span><br><span class="line">        <span class="comment">// 2. 获取连接(8.x之后版本的配置方法)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mydb1?useSSL=false&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">        <span class="comment">// 需要显示关闭SSL和指定时区</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;801299&quot;</span>;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, username, pwd);</span><br><span class="line">        <span class="comment">// 3. 定义sql语句</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;drop database mydb2&quot;</span>;</span><br><span class="line">        <span class="comment">// 4. 获取执行sql的对象:statement</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="comment">// 5. 执行sql</span></span><br><span class="line">        stmt.executeUpdate(sql);</span><br><span class="line">        <span class="comment">// 6. 释放资源</span></span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ResultSet"><a href="#ResultSet" class="headerlink" title="ResultSet"></a>ResultSet</h4><p>封装了DQL查询语句的结果</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803165015.png" width=80%></div>

<p>使用方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(result.next()) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"><span class="comment">//  int id = result.getInt(1);  // 也可传入列序，从1开始</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> result.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">english</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;english&quot;</span>);</span><br><span class="line">    System.out.println(id + <span class="string">&quot; &quot;</span> + name + <span class="string">&quot; &quot;</span> + english);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将从student中查询到的数据封装成Student对象，并存储到ArrayList集合中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC中的ResultSet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> chinese;</span><br><span class="line">    <span class="type">int</span> english;</span><br><span class="line">    Student(<span class="type">int</span> id, String name, <span class="type">int</span> chinese, <span class="type">int</span> english) &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.chinese = chinese;</span><br><span class="line">        <span class="built_in">this</span>.english = english;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCdemo3_resultset</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 注册驱动</span></span><br><span class="line"><span class="comment">//        Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span></span><br><span class="line">        <span class="comment">// 2. 获取连接(8.x之后版本的配置方法)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mydb1?useSSL=false&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">        <span class="comment">// 需要显示关闭SSL和指定时区</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;801299&quot;</span>;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, username, pwd);</span><br><span class="line">        <span class="comment">// 3. 定义sql语句,mudb1中有一张student表,我们查询表结构</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from student&quot;</span>;</span><br><span class="line">        <span class="comment">// 4. 获取执行sql的对象:statement</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="comment">// 5. 执行sql</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">result</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line">        <span class="comment">//resultset内部有一个可移动的光标，默认是指向第一条记录</span></span><br><span class="line">        <span class="comment">// 6. 查看结果/存储结果</span></span><br><span class="line">        ArrayList&lt;Student&gt; stu = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(result.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"><span class="comment">//            int id = result.getInt(1);  // 也可传入列序，从1开始</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> result.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">chinese</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;chinese&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">english</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;english&quot;</span>);</span><br><span class="line">            stu.add(<span class="keyword">new</span> <span class="title class_">Student</span>(id, name, chinese, english));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 7. 释放资源</span></span><br><span class="line">        result.close();</span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PreparedStatement-解决SQL注入的问题，同时预编译SQL"><a href="#PreparedStatement-解决SQL注入的问题，同时预编译SQL" class="headerlink" title="PreparedStatement(解决SQL注入的问题，同时预编译SQL)"></a>PreparedStatement(解决SQL注入的问题，同时预编译SQL)</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803165923.png" width=80%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803170214.png" width=80%></div>

<p>简单理解就是将之前SQL语句中固定的值用参数占位符来替代，再将参数传递进去</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC的PreparedStatement</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCdemo4_preparedstatement</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 注册驱动</span></span><br><span class="line"><span class="comment">//        Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span></span><br><span class="line">        <span class="comment">// 2. 获取连接(8.x之后版本的配置方法)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mydb1?useSSL=false&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">        <span class="comment">// 需要显示关闭SSL和指定时区</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;801299&quot;</span>;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, username, pwd);</span><br><span class="line">        <span class="comment">// 3. 定义sql语句,mudb1中有一张student表,我们查询表结构</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from student where english &gt;= ?&quot;</span>;</span><br><span class="line">        <span class="comment">// 4. 获取执行sql的对象</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">        <span class="comment">// 5. 设置问号?的值</span></span><br><span class="line">        pstmt.setInt(<span class="number">1</span>, <span class="number">90</span>);  <span class="comment">// 给出参数的位置和值，位置从1开始</span></span><br><span class="line">        <span class="comment">// 6. 执行sql语句</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">result</span> <span class="operator">=</span> pstmt.executeQuery();</span><br><span class="line">        <span class="comment">// 7. 查看结果</span></span><br><span class="line">        <span class="keyword">while</span>(result.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> result.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">english</span> <span class="operator">=</span> result.getInt(<span class="string">&quot;english&quot;</span>);</span><br><span class="line">            System.out.println(id + <span class="string">&quot; &quot;</span> + name + <span class="string">&quot; &quot;</span> + english);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 7. 释放资源</span></span><br><span class="line">        result.close();</span><br><span class="line">        pstmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PreparedStatement原理"><a href="#PreparedStatement原理" class="headerlink" title="PreparedStatement原理"></a>PreparedStatement原理</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803171041.png" width=80%></div>

<p>1.首先是url要修改</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mydb1?useSSL=false&amp;serverTimezone=UTC&amp;useServerPrepStmts=true&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>2.不要按照上面的内容修改my.ini文件，因为mysql8.0的my.ini文件中自带有这些设置，但没有开启，只需要去开启即可</strong></p>
<blockquote>
<p>注意mysql8.0的my.ini在C:\ProgramData\MySQL\MySQL Server 8.0</p>
</blockquote>
<p>找到my.ini文件后，按照下面截图进行修改即可</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803182231.png" width=80%></div>

<p>在java代码执行过程中，创建PreparedStatement的地方就会进行SQL语句的编译，当后面调用setxxx方法设置参数值，再进行SQL语句的执行，这样就完成了SQL语句的预编译，如果需要执行多条SQL语句，只需要修改参数，而原始的SQL语句只需要进行一次预编译，在创建PreparedStatement对象的时候就进行了编译</p>
<p>3.执行java代码后，可以从log文件中看到，prepare，也就是预编译</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803182725.png" width=80%></div>

<h4 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h4><h4 id="什么是数据库连接池？"><a href="#什么是数据库连接池？" class="headerlink" title="什么是数据库连接池？"></a>什么是数据库连接池？</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803194725.png" width=80%></div>

<p><strong>允许应用程序重复使用一个现有的数据库连接，而不是再重新建立。在数据库连接池中有若干个数据库的连接，需要访问数据库时，从连接池中分配一个连接给该用户，用完之后不会释放，而是归还到连接池中，实现资源复用</strong></p>
<h4 id="数据库连接池实现"><a href="#数据库连接池实现" class="headerlink" title="数据库连接池实现"></a>数据库连接池实现</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803195247.png" width=80%></div>

<h4 id="Driud使用步骤"><a href="#Driud使用步骤" class="headerlink" title="Driud使用步骤"></a>Driud使用步骤</h4><ul>
<li>导入jar包<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803195929.png" width=80%></div></li>
<li>定义配置文件<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803200000.png" width=80%></div></li>
<li>加载配置文件</li>
<li>获取数据库连接池对象</li>
<li>获取连接</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.druid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Druiddemo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.导入jar包</span></span><br><span class="line">        <span class="comment">// 2.定义配置文件</span></span><br><span class="line">        <span class="comment">// 3.加载配置文件</span></span><br><span class="line">        System.out.println(System.getProperty(<span class="string">&quot;user.dir&quot;</span>));  <span class="comment">// 查看当前路径</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        prop.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;demo/src/druid.properties&quot;</span>));</span><br><span class="line">        <span class="comment">// 4.获取连接池对象</span></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> DruidDataSourceFactory.createDataSource(prop);</span><br><span class="line">        <span class="comment">// 5.获取数据库连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">        System.out.println(conn);</span><br><span class="line">        <span class="comment">// 之后正常使用连接即可</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>JDBC</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL函数与视图</title>
    <url>/2022/08/03/JavaWeb/Mysql/MySQL%E5%87%BD%E6%95%B0%E4%B8%8E%E8%A7%86%E5%9B%BE/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL多表操作</title>
    <url>/2022/08/03/JavaWeb/Mysql/MySQL%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL存储过程和触发器</title>
    <url>/2022/08/03/JavaWeb/Mysql/MySQL%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E8%A7%A6%E5%8F%91%E5%99%A8/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL数据库基本操作</title>
    <url>/2022/08/01/JavaWeb/Mysql/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h3 id="DDL-Data-Definition-Language-：数据定义语言"><a href="#DDL-Data-Definition-Language-：数据定义语言" class="headerlink" title="DDL(Data Definition Language)：数据定义语言"></a>DDL(Data Definition Language)：数据定义语言</h3><p>内容包括：</p>
<ul>
<li>对数据库的常用操作</li>
<li>对表结构的常用操作</li>
<li>修改表结构<span id="more"></span></li>
</ul>
<h4 id="1-对数据库的常用操作"><a href="#1-对数据库的常用操作" class="headerlink" title="1.对数据库的常用操作"></a>1.对数据库的常用操作</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220731211229.png" width=80%></div>

<h4 id="2-对表结构的常用操作"><a href="#2-对表结构的常用操作" class="headerlink" title="2.对表结构的常用操作"></a>2.对表结构的常用操作</h4><p>创建表</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801094747.png" width=80%></div>

<p>数据类型(对具体每列进行限定，选择原则：够用就行)</p>
<ul>
<li><p>数值类型</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801100054.png" width=80%></div>
</li>
<li><p>日期和时间类型</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801100521.png" width=80%></div>
</li>
<li><p>字符串类型</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801100454.png" width=80%></div></li>
</ul>
<h4 id="3-对表结构的其它常用操作"><a href="#3-对表结构的其它常用操作" class="headerlink" title="3.对表结构的其它常用操作"></a>3.对表结构的其它常用操作</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801100750.png" width=80%></div>

<ul>
<li><p>修改表添加列</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801101219.png" width=80%></div>
修改数据库就是：alter database, 修改表就是：alter table
</li>
<li><p>修改列名和类型</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801101658.png" width=80%></div>
</li>
<li><p>修改表删除列</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801101854.png" width=80%></div>
</li>
<li><p>修改表名</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801102051.png" width=80%></div></li>
</ul>
<h4 id="DDL代码样例"><a href="#DDL代码样例" class="headerlink" title="DDL代码样例"></a>DDL代码样例</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">sql</span>不区分大小写<span class="operator">!</span></span><br><span class="line"># <span class="number">1.</span> 对数据库的操作</span><br><span class="line"># 查看所有数据库</span><br><span class="line"><span class="keyword">show</span> databases;  </span><br><span class="line"></span><br><span class="line"># 创建数据库if <span class="keyword">not</span>可省</span><br><span class="line"><span class="keyword">create</span> database mydb1;</span><br><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> mydb1;  </span><br><span class="line"></span><br><span class="line"># 选择使用哪一个数据库</span><br><span class="line">use mydb1;  </span><br><span class="line"></span><br><span class="line"># 删除数据库</span><br><span class="line"><span class="keyword">drop</span> database mydb1;  </span><br><span class="line"><span class="keyword">drop</span> database if <span class="keyword">exists</span> mydb1;</span><br><span class="line"></span><br><span class="line"># 修改数据库编码(自身就是utf<span class="number">-8</span>)</span><br><span class="line"><span class="keyword">alter</span> database mydb1 <span class="type">character</span> <span class="keyword">set</span> utf8;  </span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> 对表结构的操作</span><br><span class="line"># 创建表</span><br><span class="line">use mydb1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> student(</span><br><span class="line">	sid <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	gender <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">	age <span class="type">int</span>,</span><br><span class="line">	birth <span class="type">date</span>,</span><br><span class="line">	address <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	score <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span> 查看当前数据库所有的表</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"># <span class="number">4.</span> 查看指定表的创建语句</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> student;</span><br><span class="line"># <span class="number">5.</span> 查看表结构 description</span><br><span class="line"><span class="keyword">desc</span> student;</span><br><span class="line"># <span class="number">6.</span> 删除表</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> student;</span><br><span class="line"></span><br><span class="line"># <span class="number">7.</span> 修改表结构</span><br><span class="line"># <span class="number">7.1</span> 添加列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">add</span> dept <span class="type">varchar</span>(<span class="number">20</span>);</span><br><span class="line"># <span class="number">7.2</span> 修改列名和类型</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student change dept department <span class="type">varchar</span>(<span class="number">30</span>);</span><br><span class="line"># <span class="number">7.3</span> 删除列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">drop</span> department;</span><br><span class="line"># <span class="number">7.4</span> 修改表名</span><br><span class="line">rename <span class="keyword">table</span> student <span class="keyword">to</span> std;</span><br></pre></td></tr></table></figure>
<h3 id="DML-Data-Manipuation-Language-：数据操作语言"><a href="#DML-Data-Manipuation-Language-：数据操作语言" class="headerlink" title="DML(Data Manipuation Language)：数据操作语言"></a>DML(Data Manipuation Language)：数据操作语言</h3><p>用于对数据库中表的数据记录进行更新，关键字：</p>
<ul>
<li>insert插入</li>
<li>delete删除</li>
<li>update更新</li>
</ul>
<h4 id="1-数据插入"><a href="#1-数据插入" class="headerlink" title="1.数据插入"></a>1.数据插入</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801103014.png" width=80%></div>

<h4 id="2-数据修改"><a href="#2-数据修改" class="headerlink" title="2.数据修改"></a>2.数据修改</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801103708.png" width=80%></div>

<h4 id="3-数据删除"><a href="#3-数据删除" class="headerlink" title="3.数据删除"></a>3.数据删除</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801104007.png" width=80%></div>

<h4 id="DML代码样例"><a href="#DML代码样例" class="headerlink" title="DML代码样例"></a>DML代码样例</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># DML操作</span><br><span class="line"># <span class="number">1.</span> 数据的插入</span><br><span class="line"># 格式<span class="number">1</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student (sid, name) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;Mxeron&#x27;</span>);  # 根据需求添加几列</span><br><span class="line"># 格式<span class="number">2</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span> </span><br><span class="line">(<span class="number">2</span>,<span class="string">&#x27;sxy&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;2001-12-23&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>, <span class="number">80.5</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">&#x27;xsy&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;2002-1-29&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>, <span class="number">81.5</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">&#x27;iuy&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;2000-8-13&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>, <span class="number">79.5</span>);</span><br><span class="line"># 所有列都要给值</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> 数据的修改</span><br><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>, age<span class="operator">=</span><span class="number">21</span>, birth<span class="operator">=</span><span class="string">&#x27;2001-09-09&#x27;</span>, address<span class="operator">=</span><span class="string">&#x27;成都&#x27;</span>, score<span class="operator">=</span><span class="number">89</span></span><br><span class="line"><span class="keyword">where</span> sid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span> 数据的删除</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student <span class="keyword">where</span> sid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># <span class="keyword">delete</span> <span class="keyword">from</span> student;  # 删除表中所有数据</span><br><span class="line"># <span class="keyword">truncate</span> <span class="keyword">table</span> student;  # 和上面的效果一样,但相当于创建新表</span><br><span class="line"># <span class="keyword">truncate</span> student;</span><br></pre></td></tr></table></figure>
<h4 id="DML练习"><a href="#DML练习" class="headerlink" title="DML练习"></a>DML练习</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">创建员工表employee,字段为:id, name, gender, salary</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">use mydb1;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> employee(</span><br><span class="line">	id <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	gender <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">	salary <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">插入三条数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employee <span class="keyword">values</span></span><br><span class="line">(<span class="number">1001</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">2000</span>),</span><br><span class="line">(<span class="number">1002</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">3200</span>),</span><br><span class="line">(<span class="number">1003</span>,<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">4000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">修改表结构:</span></span><br><span class="line"><span class="comment">1. 所有员工薪资修改为5000元</span></span><br><span class="line"><span class="comment">2. 将姓名为张三的员工薪资修改为3000元</span></span><br><span class="line"><span class="comment">3. 将姓名为李四的员工薪资修改为4000元，gender为女</span></span><br><span class="line"><span class="comment">4. 所有员工薪资在原有基础上+1000元</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"># <span class="number">1.</span></span><br><span class="line"><span class="keyword">update</span> employee <span class="keyword">set</span> salary<span class="operator">=</span><span class="number">5000</span>;</span><br><span class="line"># <span class="number">2.</span></span><br><span class="line"><span class="keyword">update</span> employee <span class="keyword">set</span> salary<span class="operator">=</span><span class="number">3000</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"># <span class="number">3.</span></span><br><span class="line"><span class="keyword">update</span> employee <span class="keyword">set</span> salary<span class="operator">=</span><span class="number">4000</span>, gender<span class="operator">=</span><span class="string">&#x27;女&#x27;</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;李四&#x27;</span>;</span><br><span class="line"># <span class="number">4.</span></span><br><span class="line"><span class="keyword">update</span> employee <span class="keyword">set</span> salary<span class="operator">=</span>salary<span class="operator">+</span><span class="number">1000</span>;  # 或者salary<span class="operator">+</span><span class="number">1000</span>	</span><br></pre></td></tr></table></figure>
<h3 id="MySQL约束-constraint"><a href="#MySQL约束-constraint" class="headerlink" title="MySQL约束(constraint)"></a>MySQL约束(constraint)</h3><p>约束实际上就是表中数据的限制条件，例如：手机号不能为空，身份证号不能重复</p>
<p>分类：</p>
<ul>
<li>主键约束primary key(PK)</li>
<li>自增长约束auto_increment</li>
<li>非空约束not null</li>
<li>唯一性约束unique</li>
<li>默认约束default</li>
<li>零填充约束zerofill</li>
<li>外键约束foreign key(FK)</li>
</ul>
<h4 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801110116.png" width=80%></div>

<p>需要注意<strong>联合主键</strong>，是多个列作为主键，只要唯一+非空即可</p>
<h4 id="添加单列主键"><a href="#添加单列主键" class="headerlink" title="添加单列主键"></a>添加单列主键</h4><p>创建单列主键方式有两种：一种是在定义字段的同时指定，另一种是定义完字段之后指定</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801211234.png" width=80%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801211656.png" width=80%></div>

<p>上方的constraint pk1可省</p>
<h4 id="添加多列主键-联合主键"><a href="#添加多列主键-联合主键" class="headerlink" title="添加多列主键(联合主键)"></a>添加多列主键(联合主键)</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801212034.png" width=80%></div>

<p>上图省略了constraint pk1，创建联合主键的方法只有一种，就是直接使用primary key(字段1,字段2,…)，<strong>并且联合主键的每一列都不能为空！</strong></p>
<h4 id="通过修改表结构添加主键"><a href="#通过修改表结构添加主键" class="headerlink" title="通过修改表结构添加主键"></a>通过修改表结构添加主键</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801212643.png" width=80%></div>

<p>同样单列、多列主键都可以</p>
<h4 id="删除主键约束"><a href="#删除主键约束" class="headerlink" title="删除主键约束"></a>删除主键约束</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801213014.png" width=80%></div>

<p>删除单列、多列主键都是一样的，因为一个表只有一个主键，mysql知道该主键是哪列</p>
<h4 id="自增长约束-和主键约束配套使用"><a href="#自增长约束-和主键约束配套使用" class="headerlink" title="自增长约束(和主键约束配套使用)"></a>自增长约束(和主键约束配套使用)</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801213209.png" width=80%></div>

<p>自增长的主键，每增加一条记录，主键会自动以相同的步长进行增长，<strong>用于实现主键自增长，所以是和主键约束配套使用</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801213642.png" width=80%></div>

<h4 id="指定自增字段的初始值"><a href="#指定自增字段的初始值" class="headerlink" title="指定自增字段的初始值"></a>指定自增字段的初始值</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801213715.png" width=80%></div>

<p>也可以通过修改表结构来指定初始值：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> xxx auto_increment<span class="operator">=</span><span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<h4 id="delete和truncate在删除所有数据后自增长列的变化"><a href="#delete和truncate在删除所有数据后自增长列的变化" class="headerlink" title="delete和truncate在删除所有数据后自增长列的变化"></a>delete和truncate在删除所有数据后自增长列的变化</h4><ul>
<li>delete数据之后自动增长从断点(上一次+1)开始</li>
<li>truncate数据之后自动增长从默认起始值开始</li>
</ul>
<h4 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801214249.png" width=80%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801214611.png" width=80%></div>

<h4 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801215014.png" width=80%></div>

<p>注意区分唯一约束和主键约束！</p>
<h4 id="删除唯一约束"><a href="#删除唯一约束" class="headerlink" title="删除唯一约束"></a>删除唯一约束</h4><p><strong>由于唯一约束所在列并不像主键约束那样唯一</strong>，所以需要指定<strong>约束名！</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">drop</span> index <span class="operator">&lt;</span>唯一约束名<span class="operator">/</span>列名<span class="operator">&gt;</span>;</span><br><span class="line"># 如果没有指定约束名，就用列名</span><br></pre></td></tr></table></figure>

<h4 id="默认约束"><a href="#默认约束" class="headerlink" title="默认约束"></a>默认约束</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801215828.png" width=80%></div>

<h4 id="删除默认约束"><a href="#删除默认约束" class="headerlink" title="删除默认约束"></a>删除默认约束</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> change <span class="keyword">column</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>类型<span class="operator">&gt;</span> <span class="keyword">default</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h4 id="零填充约束-使用较少"><a href="#零填充约束-使用较少" class="headerlink" title="零填充约束(使用较少)"></a>零填充约束(使用较少)</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220801220557.png" width=80%></div>

<h4 id="MySQL约束代码样例"><a href="#MySQL约束代码样例" class="headerlink" title="MySQL约束代码样例"></a>MySQL约束代码样例</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use mydb1;</span><br><span class="line"># <span class="number">1.</span>主键约束</span><br><span class="line"># 添加主键方式<span class="number">1</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp1(</span><br><span class="line">	eid <span class="type">int</span> <span class="keyword">primary</span> key,  # 主键约束</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	salary <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"># 添加主键方式<span class="number">2</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp2(</span><br><span class="line">	eid <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	salary <span class="keyword">double</span>,</span><br><span class="line">	<span class="keyword">constraint</span> pk1 <span class="keyword">primary</span> key(eid)  # 手动指定主键约束,<span class="keyword">constraint</span> pk1可省</span><br><span class="line">);</span><br><span class="line"># 联合主键</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp3(</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	deptid <span class="type">int</span>,</span><br><span class="line">	salary <span class="keyword">double</span>,</span><br><span class="line">	<span class="keyword">constraint</span> pk1 <span class="keyword">primary</span> key(name, deptid)  # 联合主键</span><br><span class="line">);</span><br><span class="line"># 联合主键测试</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp3 <span class="keyword">values</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="number">10</span>,<span class="number">1000</span>),</span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>,<span class="number">20</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"># 修改表结构添加主键</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp4(</span><br><span class="line">	eid <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	salary <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp4 <span class="keyword">add</span> <span class="keyword">constraint</span> pk1 <span class="keyword">primary</span> key(eid);  # <span class="keyword">constraint</span> pk1可省</span><br><span class="line"></span><br><span class="line"># 删除主键约束</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp4 <span class="keyword">drop</span> <span class="keyword">primary</span> key;</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span>自增长约束</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp5(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp5 <span class="keyword">values</span>(<span class="keyword">NULL</span>, <span class="string">&#x27;张三&#x27;</span>);  # 不给主键id的值，也可以自己赋值</span><br><span class="line"></span><br><span class="line"># 指定自增长约束的初始值</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp6(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">2</span>)</span><br><span class="line">)auto_increment<span class="operator">=</span><span class="number">100</span>;  # 初始值为<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp6 <span class="keyword">values</span>(<span class="keyword">NULL</span>, <span class="string">&#x27;李四&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 通过修改表结构来指定自增长约束的初始值</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp6 auto_increment<span class="operator">=</span><span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span>非空约束</span><br><span class="line"># 方式<span class="number">1</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp7(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary</span> key,  # 主键自带非空</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	salary <span class="keyword">double</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"># 方式<span class="number">2</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp7 modify name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp7 <span class="keyword">values</span>(<span class="number">1</span>);  # 不可以</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp7 <span class="keyword">values</span>(<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);  # 不可以</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp7 <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;NULL&#x27;</span>,<span class="number">0</span>);  # 可以</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp7 <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;&#x27;</span>,<span class="number">2</span>);  # 可以，代表空串</span><br><span class="line"></span><br><span class="line"># 删除非空约束,不指定<span class="keyword">not</span> <span class="keyword">null</span>就删除了</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp7 modify name <span class="type">varchar</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"># <span class="number">4.</span>唯一约束</span><br><span class="line"># 方式<span class="number">1</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp8(</span><br><span class="line">	id <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	phone_number <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">unique</span>  # 唯一约束</span><br><span class="line">);</span><br><span class="line"># 方式<span class="number">2</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp8 <span class="keyword">add</span> <span class="keyword">constraint</span> uq1 <span class="keyword">unique</span>(phone_number);</span><br><span class="line"></span><br><span class="line"># 注意唯一约束可以为<span class="keyword">NULL</span>，且<span class="keyword">NULL</span>可以重复</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp8 <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="keyword">NULL</span>);  # 可以</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp8 <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;张四&#x27;</span>,<span class="keyword">NULL</span>);  # 这句也可以</span><br><span class="line"></span><br><span class="line"># 删除唯一约束</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp8 <span class="keyword">drop</span> index uq1;  # 如果没有指定约束名，就用列名</span><br><span class="line"></span><br><span class="line"># <span class="number">5.</span>默认约束</span><br><span class="line"># 方式<span class="number">1</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> emp9;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp9(</span><br><span class="line">	id <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="string">&#x27;北京&#x27;</span></span><br><span class="line">);</span><br><span class="line"># 在<span class="keyword">insert</span>时一定要指定列名，否则<span class="keyword">default</span>不会起作用</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp9 <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="keyword">NULL</span>);  # <span class="keyword">default</span>不起作用</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp9(id,name) <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;张三&#x27;</span>);  # 可以</span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp9 modify address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="string">&#x27;北京&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 删除默认约束</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp9 change <span class="keyword">column</span> address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h3 id="DQL-Data-Query-Language"><a href="#DQL-Data-Query-Language" class="headerlink" title="DQL(Data Query Language)"></a>DQL(Data Query Language)</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802130559.png" width=80%></div>

<p><strong>数据库管理系统一个重要功能就是数据查询，所以DQL的学习十分重要。</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802130705.png" width=80%></div>

<h4 id="基本查询-数据准备"><a href="#基本查询-数据准备" class="headerlink" title="基本查询-数据准备"></a>基本查询-数据准备</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use mydb1;</span><br><span class="line"># 创建商品表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> product(</span><br><span class="line">	pid <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	pname <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	price <span class="keyword">double</span>,</span><br><span class="line">	category_id <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"># 添加数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> product <span class="keyword">values</span></span><br><span class="line">(<span class="keyword">null</span>,<span class="string">&#x27;海尔洗衣机&#x27;</span>,<span class="number">5000</span>,<span class="string">&#x27;c001&#x27;</span>),</span><br><span class="line">(<span class="keyword">null</span>,<span class="string">&#x27;美的冰箱&#x27;</span>,<span class="number">3000</span>,<span class="string">&#x27;c001&#x27;</span>),</span><br><span class="line">(<span class="keyword">null</span>,<span class="string">&#x27;格力空调&#x27;</span>,<span class="number">2000</span>,<span class="string">&#x27;c001&#x27;</span>),</span><br><span class="line">(<span class="keyword">null</span>,<span class="string">&#x27;九阳电饭煲&#x27;</span>,<span class="number">300</span>,<span class="string">&#x27;c001&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="基本查询-简单查询"><a href="#基本查询-简单查询" class="headerlink" title="基本查询-简单查询"></a>基本查询-简单查询</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查询所有商品</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product;</span><br><span class="line"># 查询商品名和商品价格</span><br><span class="line"><span class="keyword">select</span> pname, price <span class="keyword">from</span> product;</span><br><span class="line"># 别名查询，关键字为<span class="keyword">as</span>(<span class="keyword">as</span>可省)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">as</span> p;  # 表别名</span><br><span class="line"><span class="keyword">select</span> pname <span class="keyword">as</span> pn <span class="keyword">from</span> product;  # 列别名</span><br><span class="line"># 去除重复值</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> price <span class="keyword">from</span> product;  </span><br><span class="line"># 运算查询(对查询结果再进行运算)</span><br><span class="line"><span class="keyword">select</span> pname, price<span class="operator">+</span><span class="number">10</span> <span class="keyword">as</span> new_price <span class="keyword">from</span> product;</span><br></pre></td></tr></table></figure>

<h4 id="基本查询-运算符"><a href="#基本查询-运算符" class="headerlink" title="基本查询-运算符"></a>基本查询-运算符</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802131726.png" width=80%></div>

<ul>
<li>算术运算符<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802131843.png" width=80%></div></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> name, price<span class="operator">+</span><span class="number">10</span> <span class="keyword">as</span> new_price <span class="keyword">from</span> product;</span><br><span class="line"><span class="keyword">select</span> name, price<span class="operator">*</span><span class="number">1.1</span> <span class="keyword">as</span> new_price <span class="keyword">from</span> product;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>比较运算符</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802131929.png" width=80%></div>
</li>
<li><p>逻辑运算符</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802201520.png" width=80%></div>
</li>
<li><p>位运算符(了解)</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802201550.png" width=80%></div></li>
</ul>
<h4 id="运算符操作-条件查询"><a href="#运算符操作-条件查询" class="headerlink" title="运算符操作-条件查询"></a>运算符操作-条件查询</h4><p><strong>特别要注意模糊查询：like</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;海尔洗衣机&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&gt;</span> <span class="number">800</span>;</span><br><span class="line"></span><br><span class="line"># 查找价格不是<span class="number">800</span>的所有商品</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">!=</span> <span class="number">800</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&lt;&gt;</span> <span class="number">800</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> <span class="keyword">not</span>(price <span class="operator">=</span> <span class="number">800</span>);</span><br><span class="line"></span><br><span class="line"># 查询价格是<span class="number">200</span>或<span class="number">800</span>的所有商品</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="keyword">in</span>(<span class="number">200</span>,<span class="number">800</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">=</span> <span class="number">200</span> <span class="keyword">or</span> price <span class="operator">=</span> <span class="number">800</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">=</span> <span class="number">200</span> <span class="operator">||</span> price <span class="operator">=</span> <span class="number">800</span>;</span><br><span class="line"></span><br><span class="line"># 查询区间</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&gt;=</span> <span class="number">200</span> <span class="keyword">and</span> price <span class="operator">&lt;=</span> <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="keyword">between</span> <span class="number">200</span> <span class="keyword">and</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"># 查询含有’鞋‘字的所有商品</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%鞋%&#x27;</span>;  # <span class="operator">%</span>用来匹配任意多个字符(包括<span class="number">0</span>),模糊匹配</span><br><span class="line"></span><br><span class="line"># 查询以’海‘开头的所有商品</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;海%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查询第二个字为’车‘的所有商品</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;_车%&#x27;</span>;  # 下划线匹配单个字符(必须占据一个字符)</span><br><span class="line"></span><br><span class="line"># 查询category_id为<span class="keyword">null</span>的商品</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> category_id <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"># 不是<span class="keyword">null</span>: <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line"># 用least求最小值</span><br><span class="line"><span class="keyword">select</span> least(<span class="number">10</span>,<span class="number">5</span>,<span class="number">20</span>) <span class="keyword">as</span> small_number;</span><br><span class="line"><span class="keyword">select</span> least(<span class="number">5</span>,<span class="keyword">null</span>);  </span><br><span class="line"># 如果有一个值为<span class="keyword">null</span>，则结果直接为<span class="keyword">null</span>,最小<span class="operator">/</span>大值都一样</span><br><span class="line"></span><br><span class="line"># 用greatest求最大值</span><br><span class="line"><span class="keyword">select</span> greatest(<span class="number">10</span>,<span class="number">20</span>,<span class="number">5</span>) <span class="keyword">as</span> big_number;</span><br></pre></td></tr></table></figure>

<h4 id="基本查询-排序查询"><a href="#基本查询-排序查询" class="headerlink" title="基本查询-排序查询"></a>基本查询-排序查询</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802202756.png" width=80%></div>

<p>ASC升序，DESC降序，默认是升序，可以给出多个排序条件</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span>, category_id <span class="keyword">asc</span>;</span><br><span class="line"># 去重排序</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> price <span class="keyword">from</span> product <span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<h4 id="基本查询-聚合查询"><a href="#基本查询-聚合查询" class="headerlink" title="基本查询-聚合查询"></a>基本查询-聚合查询</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802203106.png" width=80%></div>

<p>聚合函数是针对具体某一列而言，求这一列的最大、最小、平均、个数</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 求商品总数</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(pid) <span class="keyword">from</span> product;  # 要以唯一的列来查</span><br><span class="line"># 求价格大于<span class="number">200</span>的商品总数</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(pid) <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&gt;</span> <span class="number">200</span>;</span><br><span class="line"># 查询分类为<span class="string">&#x27;c001&#x27;</span>的所有商品的总和</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(price) <span class="keyword">from</span> product <span class="keyword">where</span> category_id <span class="operator">=</span> <span class="string">&#x27;c001&#x27;</span>;</span><br><span class="line"># 查询商品的最大、最小、平均价格</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(price) <span class="keyword">as</span> max_price,</span><br><span class="line"><span class="built_in">min</span>(price) <span class="keyword">as</span> min_price, </span><br><span class="line"><span class="built_in">avg</span>(price) <span class="keyword">as</span> avg_price <span class="keyword">from</span> product;</span><br><span class="line"># 注意上面的列名都可以使用列序号来代替</span><br></pre></td></tr></table></figure>

<h4 id="聚合查询有关NULL值的处理"><a href="#聚合查询有关NULL值的处理" class="headerlink" title="聚合查询有关NULL值的处理"></a>聚合查询有关NULL值的处理</h4><ul>
<li>count函数，不统计含null值的记录个数</li>
<li>sum、avg函数，忽略包含null值的该条记录</li>
<li>max、min函数，忽略null值的存在</li>
</ul>
<h4 id="基本查询-分组查询-非常重要"><a href="#基本查询-分组查询-非常重要" class="headerlink" title="基本查询-分组查询(非常重要)"></a>基本查询-分组查询(非常重要)</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802203833.png" width=80%></div>

<p>表结构如下：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802204006.png" width=80%></div>

<p><strong>会根据条件先进行分组，切分成若干个子表，然后再对子表执行相关的查询操作，每个子表的查询结果作为结果的一条记录。</strong></p>
<p>筛选过程：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802204530.png" width=80%></div>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 统计各分类商品的个数</span><br><span class="line"><span class="keyword">select</span> category_id,<span class="built_in">count</span>(pid) <span class="keyword">as</span> num <span class="keyword">from</span> product <span class="keyword">group</span> <span class="keyword">by</span> category_id;</span><br><span class="line"></span><br><span class="line"># 省市相同的同学一组</span><br><span class="line"><span class="keyword">select</span> id, name <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> <span class="string">&#x27;省&#x27;</span>,<span class="string">&#x27;市&#x27;</span>;</span><br><span class="line"># 注意<span class="keyword">group</span> <span class="keyword">by</span>后面的条件可以有多个</span><br><span class="line"># 有多个时它们的值都必须一致，才能一组</span><br></pre></td></tr></table></figure>

<h4 id="分组查询-条件筛选having"><a href="#分组查询-条件筛选having" class="headerlink" title="分组查询-条件筛选having"></a>分组查询-条件筛选having</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802204832.png" width=80%></div>

<ul>
<li>where是对from进行筛选</li>
<li>group by是用来分组where子句的输出</li>
<li>having用来<strong>从分组select结果中筛选出记录(行)</strong></li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802205641.png" width=80%></div>

<p>从上面可以很直观的看到having的处理对象，是对分组之后select的结果表(当作是中间有表生成)进行处理</p>
<blockquote>
<p>书写顺序为：select … from … where … group by … having …</p>
</blockquote>
<h4 id="基本查询-分页查询limit"><a href="#基本查询-分页查询limit" class="headerlink" title="基本查询-分页查询limit"></a>基本查询-分页查询limit</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802205910.png" width=80%></div>

<p>最主要目的是对数据进行分页显示</p>
<h4 id="insert-into-select语句"><a href="#insert-into-select语句" class="headerlink" title="insert into select语句"></a>insert into select语句</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220802210138.png" width=80%></div>

<p>把table1的查询结果插入到table2，且前后table1、2的字段一定要一致</p>
<h4 id="DQL练习"><a href="#DQL练习" class="headerlink" title="DQL练习"></a>DQL练习</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># DQL练习</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> student;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line">	id <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	gender <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	chinese <span class="type">int</span>,</span><br><span class="line">	english <span class="type">int</span>,</span><br><span class="line">	math <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span></span><br><span class="line">(<span class="number">1</span>,<span class="string">&#x27;张明&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">89</span>,<span class="number">78</span>,<span class="number">90</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="string">&#x27;李进&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">67</span>,<span class="number">53</span>,<span class="number">95</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">87</span>,<span class="number">67</span>,<span class="number">99</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">&#x27;李一&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">87</span>,<span class="number">23</span>,<span class="number">53</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="string">&#x27;李财&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">92</span>,<span class="number">53</span>,<span class="number">65</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="string">&#x27;张宝&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">55</span>,<span class="number">92</span>,<span class="number">95</span>),</span><br><span class="line">(<span class="number">7</span>,<span class="string">&#x27;黄蓉&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">75</span>,<span class="number">93</span>,<span class="number">59</span>);</span><br><span class="line"></span><br><span class="line"># <span class="number">1.</span>查询所有学生的信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br><span class="line"># <span class="number">2.</span>查询表中所有学生的姓名和对应的英语成绩</span><br><span class="line"><span class="keyword">select</span> name,english <span class="keyword">from</span> student;</span><br><span class="line"># <span class="number">3.</span>过滤表中的重复数据</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br><span class="line"># <span class="number">4.</span>统计每个学生的总分</span><br><span class="line"><span class="keyword">select</span> name, chinese <span class="operator">+</span> english <span class="operator">+</span> math <span class="keyword">as</span> sum <span class="keyword">from</span> student;</span><br><span class="line"># <span class="number">5.</span>给所有学生总分加上<span class="number">10</span>分</span><br><span class="line"><span class="keyword">select</span> name, chinese <span class="operator">+</span> english <span class="operator">+</span> math <span class="operator">+</span> <span class="number">10</span> <span class="keyword">as</span> sum <span class="keyword">from</span> student;</span><br><span class="line"># <span class="number">6.</span>查询英语成绩大于<span class="number">90</span>分的同学</span><br><span class="line"><span class="keyword">select</span> name,english <span class="keyword">from</span> student <span class="keyword">where</span> english <span class="operator">&gt;</span> <span class="number">90</span>;</span><br><span class="line"># <span class="number">7.</span>查询总分大于<span class="number">200</span>分的同学</span><br><span class="line"># 错误：<span class="keyword">select</span> name,chinese <span class="operator">+</span> english <span class="operator">+</span> math <span class="keyword">as</span> sum <span class="keyword">from</span> student <span class="keyword">where</span> sum <span class="operator">&gt;</span> <span class="number">200</span>;</span><br><span class="line"><span class="keyword">select</span> name,chinese <span class="operator">+</span> english <span class="operator">+</span> math <span class="keyword">as</span> sum <span class="keyword">from</span> student <span class="keyword">where</span> chinese <span class="operator">+</span> english <span class="operator">+</span> math <span class="operator">&gt;</span> <span class="number">200</span>;</span><br><span class="line"># <span class="number">8.</span>查询英语分数在<span class="number">80</span><span class="number">-90</span>之间的同学</span><br><span class="line"><span class="keyword">select</span> name,english <span class="keyword">from</span> student <span class="keyword">where</span> english <span class="operator">&gt;=</span> <span class="number">80</span>  <span class="operator">&amp;&amp;</span> english <span class="operator">&lt;=</span> <span class="number">90</span>;</span><br><span class="line"># <span class="number">9.</span>查询英语分数不在<span class="number">80</span><span class="number">-90</span>之间的同学</span><br><span class="line"><span class="keyword">select</span> name,english <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">not</span>(english <span class="operator">&gt;=</span> <span class="number">80</span> <span class="operator">&amp;&amp;</span> english <span class="operator">&lt;=</span> <span class="number">90</span>);</span><br><span class="line"># <span class="number">10.</span>查询数学分数为<span class="number">89</span>,<span class="number">90</span>,<span class="number">91</span>的同学</span><br><span class="line"><span class="keyword">select</span> name,math <span class="keyword">from</span> student <span class="keyword">where</span> math <span class="keyword">in</span> (<span class="number">89</span>,<span class="number">90</span>,<span class="number">91</span>);</span><br><span class="line"># <span class="number">11.</span>查询姓李的学生的英语成绩</span><br><span class="line"><span class="keyword">select</span> name,english <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;李%&#x27;</span>;</span><br><span class="line"># <span class="number">12.</span>对数学成绩降序排列后输出</span><br><span class="line"><span class="keyword">select</span> name, math <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> math <span class="keyword">desc</span>;</span><br><span class="line"># <span class="number">13.</span>将总分按照降序排列后输出</span><br><span class="line"><span class="keyword">select</span> name, chinese <span class="operator">+</span> english <span class="operator">+</span> math <span class="keyword">as</span> sum <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> sum <span class="keyword">desc</span>;</span><br><span class="line"># 注意<span class="keyword">order</span> <span class="keyword">by</span>可以用<span class="keyword">select</span>的别名，但<span class="keyword">where</span>不行！</span><br><span class="line"># <span class="number">14.</span>将姓李的同学的成绩降序排列后输出</span><br><span class="line"><span class="keyword">select</span> name, chinese <span class="operator">+</span> english <span class="operator">+</span> math <span class="keyword">as</span> sum </span><br><span class="line"><span class="keyword">from</span> student </span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;李%&#x27;</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> sum <span class="keyword">desc</span>;</span><br><span class="line"># <span class="number">15.</span>查询男生和女生分别有多少人，并将人数降序排序后输出，查询出人数大于<span class="number">3</span>的性别人数</span><br><span class="line"><span class="keyword">select</span> gender, <span class="built_in">count</span>(id) <span class="keyword">as</span> num </span><br><span class="line"><span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> gender </span><br><span class="line"><span class="keyword">having</span> num <span class="operator">&gt;</span> <span class="number">3</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<h4 id="基本查询-正则表达式"><a href="#基本查询-正则表达式" class="headerlink" title="基本查询-正则表达式"></a>基本查询-正则表达式</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803134326.png" width=80%></div>

<p>正则表达式本质上还是产生一个布尔值，看给定的字符串是否满足要求</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="operator">^</span>在字符串开始处进行匹配</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;^a&#x27;</span>;</span><br><span class="line"># $在字符串末尾开始匹配</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;a$&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;c$&#x27;</span>;</span><br><span class="line"># . 匹配除\n外的单个字符</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;.b&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;.c&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;a.&#x27;</span>;  # 满足</span><br><span class="line"># 注意:匹配不是指完全相同，只要是子串就可以(当然有特殊开始结束匹配的需要满足特定需求)</span><br><span class="line"># [...]匹配括号内任意的单个字符</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;[axx]&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;[xxx]&#x27;</span>;  # 不满足</span><br><span class="line"># [<span class="operator">^</span>...] <span class="operator">^</span>只在[]内才有取反的意思，在别的地方都是表示开始处匹配</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;[^abc]&#x27;</span>;  # 除abc意外的字符，不满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> regexp <span class="string">&#x27;[^xda]&#x27;</span>;  # 满足</span><br><span class="line"># a<span class="operator">*</span> 匹配<span class="number">0</span>个或多个a，包括空字符串，可以作为占位符，有没有字符都能匹配到数据</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;stab&#x27;</span> regexp <span class="string">&#x27;.ta*b&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;stb&#x27;</span> regexp <span class="string">&#x27;.ta*b&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&#x27;</span> regexp <span class="string">&#x27;a*&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&#x27;</span> regexp <span class="string">&#x27;(abc)*&#x27;</span>;  # 满足,代表abc这个组合出现<span class="number">0</span>次或多次</span><br><span class="line"># a<span class="operator">+</span> 匹配<span class="number">1</span>个或多个a</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;stab&#x27;</span> regexp <span class="string">&#x27;.ta+b&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;stb&#x27;</span> regexp <span class="string">&#x27;.ta+b&#x27;</span>;  # 不满足</span><br><span class="line"># a? 匹配<span class="number">0</span>个或<span class="number">1</span>个a</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;stb&#x27;</span> regexp <span class="string">&#x27;a?&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;stab&#x27;</span> regexp <span class="string">&#x27;a?&#x27;</span>;  # 满足</span><br><span class="line"># a<span class="operator">|</span>b 匹配a或b</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;a&#x27;</span> regexp <span class="string">&#x27;a|b&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;b&#x27;</span> regexp <span class="string">&#x27;^(a|b)&#x27;</span>;  # 满足,代表以a或b开头,这里的<span class="operator">^</span>不是非<span class="operator">!</span></span><br><span class="line"># a&#123;m&#125; 匹配m个a</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&#x27;</span> regexp <span class="string">&#x27;a&#123;0&#125;&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;a&#x27;</span> regexp <span class="string">&#x27;a&#123;1&#125;&#x27;</span>;  # 满足</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;a&#x27;</span> regexp <span class="string">&#x27;a&#123;2&#125;&#x27;</span>;  # 不满足</span><br><span class="line"># a&#123;m,&#125; 匹配m个或者更多个a</span><br><span class="line"># a&#123;m,n&#125; 匹配[m,n]个a</span><br><span class="line"># (abc) 匹配abc这个整体</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL索引和事务</title>
    <url>/2022/08/03/JavaWeb/Mysql/MySQL%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8B%E5%8A%A1/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven入门</title>
    <url>/2022/08/03/JavaWeb/Maven/Maven%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h3 id="Maven简介"><a href="#Maven简介" class="headerlink" title="Maven简介"></a>Maven简介</h3><p>Maven是专门用于管理和构建Java项目的工具，主要功能如下</p>
<span id="more"></span>
<ul>
<li>提供了一套标准化的项目结构，使得同一个java项目在eclipse、idea中打开之后项目结构都一样<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803201855.png" width=80%></div></li>
<li>提供了一套标准化的构建流程<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803202119.png" width=80%></div></li>
<li>提供了一套依赖管理机制，管理项目所依赖的第三方资源（jar包、插件…）<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803202327.png" width=80%></div></li>
</ul>
<p>Apache Maven是一个项目管理和构建工具，它基于项目对象模型(POM,project object model)的概念，通过一小段描述信息来管理项目的构建、报告和文档</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803202947.png" width=80%></div>

<p>一系列的jar包就放在本机的maven仓库中，通过在pom.xml文件中注入依赖，就可以导入jar包</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803203222.png" width=80%></div>

<p>仓库又分为本地仓库、中央仓库、远程仓库（私服）</p>
<ul>
<li>本地仓库：自己计算机上的文件夹</li>
<li>中央仓库：由Maven团队维护的全球唯一的仓库，地址：<a href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a></li>
<li>远程仓库：由公司团队搭建的私有仓库</li>
</ul>
<p><strong>当项目中使用坐标引入对应依赖jar包后，首先会查找本地仓库中是否有对应的jar包：</strong></p>
<ul>
<li>如果有，则在项目直接引用</li>
<li>如果没有，则去中央仓库中下载对应的jar包到本地仓库</li>
<li>还可以搭建远程创库，将来jar包的查找顺序变为：本地仓库-&gt;远程仓库-&gt;中央仓库</li>
</ul>
<h3 id="Maven安装配置"><a href="#Maven安装配置" class="headerlink" title="Maven安装配置"></a>Maven安装配置</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803203826.png" width=80%></div>

<blockquote>
<p>环境变量的配置需要注意：新建MAVEN_HOME值为maven的文件夹地址，然后再在Path中添加maven&#x2F;bin的地址</p>
</blockquote>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803204506.png" width=70%></div>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803204513.png" width=50%></div>

<p>如果不对本地仓库进行配置，则默认地址为:C:\Users\12294.m2\repository，但考虑到C盘空间紧缺，需要进行配置为D:\apache-maven-3.8.6\mvn_resp，也就是在maven安装地址下新建一个mvn_resp文件夹，用作本地仓库</p>
<p>找到maven安装地址下的conf&#x2F;settings.xml，修改如下：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803205111.png" width=80%></div>

<p>配置阿里云私服的目的是为了提高以后本地没有jar包的访问速度，找到maven安装地址下的conf&#x2F;settings.xml，修改如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>不要按照阿里云官方写的<a href="https://xxxx去配置,这样配置后需要对maven虚拟机进行ssl设置,比较麻烦/">https://xxxx去配置，这样配置后需要对maven虚拟机进行SSL设置，比较麻烦</a></p>
</blockquote>
<h3 id="Maven基本使用"><a href="#Maven基本使用" class="headerlink" title="Maven基本使用"></a>Maven基本使用</h3><ul>
<li><p>Maven常用命令</p>
<ul>
<li>compile：编译</li>
<li>clean：清理</li>
<li>test：测试</li>
<li>package：打包</li>
<li>install：安装</li>
</ul>
</li>
<li><p>Maven生命周期<br><strong>同一生命周期内，执行后边的命令，前面的所有命令会自动执行</strong></p>
</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803205827.png" width=80%></div>

<h3 id="IDEA配置Maven"><a href="#IDEA配置Maven" class="headerlink" title="IDEA配置Maven"></a>IDEA配置Maven</h3><ul>
<li>IDEA配置Maven环境<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803210111.png" width=80%></div></li>
</ul>
<p>注意setting file要配置为之前新建的conf文件夹下的setting文件</p>
<blockquote>
<p>这个Maven环境的配置，一定要在idea的启动面板中修改，才是全局配置，否则只是对某个项目的配置</p>
</blockquote>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804101042.png" width=80%></div>


<ul>
<li><p>Maven坐标详解</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803212057.png" width=80%></div>
</li>
<li><p>IDEA创建Maven项目</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803212312.png" width=80%></div>
</li>
<li><p>IDEA导入Maven项目</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803213404.png" width=80%></div></li>
</ul>
<p>在使用maven进行compile的时候，可能会报错，原因是jdk版本不匹配，找到D:\apache-maven-3.8.6\conf下的settings.xml，修改如下(本质就是指定maven默认的jdk版本):</p>
<blockquote>
<p>一定要保证Idea中Maven配置中的目录配置为自己Maven所在目录!</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804084341.png" width=80%></div>
</blockquote>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804084238.png" width=80%></div>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-11<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>11<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面这种方法是一劳永逸的方法，当然也可以在每个Maven项目的pom.xml文件中进行管理，添加如下代码即可：<br>(xml中使用ctrl + shift + &#x2F; 可以获得更好的注释效果)</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>同时要注意Idea中File-Settings中的Java Compiler是否也是jdk-11:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803215935.png" width=80%></div>

<p>Project Structure中的jdk版本也同样要为jdk-11:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803220012.png" width=80%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803220030.png" width=80%></div>

<p>可以在win10搜索栏输入cmd进入命令管理器，接着输入 Java -version 便会显示自己的jdk版本，配置完成后即可build success!</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220803220109.png" width=80%></div>

<p><strong>可能还会遇到点击Maven中的clean之后，再点击compile发现又出现了之前的错误，这个时候就一定要回去检查自己的Maven目录、jdk版本等是否配置好了，因为idea有时候打开后会重置之前设置好的Maven所在目录，需要再配置一遍!</strong></p>
<p>总结一下，一旦出现报错信息，先去看看idea中配置的jdk版本是否正确，maven的配置目录是否正确!</p>
<p>最后，为了方便Maven使用，可以安装一个Maven-Helper:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804085849.png" width=80%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804085922.png" width=60%></div>

<h4 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h4><p>使用坐标导入jar包:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804090108.png" width=70%></div>

<h4 id="pom-xml自动补全"><a href="#pom-xml自动补全" class="headerlink" title="pom.xml自动补全"></a>pom.xml自动补全</h4><p>注意，在写依赖导入jar包时，会发现idea没有自动补全，这是因为没有从中央仓库下载索引文件导致的，而阿里云镜像又没有索引文件，这时<strong>需要注释掉settings.xml中mirrors的设置部分</strong>，然后进入下图中对应的位置点击update(<strong>如果不注释掉mirrors代码，点击update后会报错，因为默认从阿里云镜像下载，但阿里云镜像中又没有需要的文件</strong>):</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804122802.png" width=80%></div>

<p>这个时候就发现，正在更新中央仓库:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804111242.png" width=50%></div>

<p>更新完成后，记得再去settings.xml中取消mirrors的注释</p>
<p>也可以在dependencies中右键点击generate:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804130903.png" width=60%></div>

<p>再选择add dependency:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804130931.png" width=30%></div>

<blockquote>
<p>高版本的maven可能会有一些新改动，不便于学习，所以最好把maven版本控制在3.6左右</p>
</blockquote>
<h4 id="依赖范围"><a href="#依赖范围" class="headerlink" title="依赖范围"></a>依赖范围</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804131101.png" width=80%></div>]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>Maven</category>
      </categories>
      <tags>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis入门</title>
    <url>/2022/08/04/JavaWeb/MyBatis/MyBatis%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h3 id="什么是MyBatis"><a href="#什么是MyBatis" class="headerlink" title="什么是MyBatis"></a>什么是MyBatis</h3><p>MyBatis是一款优秀的<strong>持久层框架</strong>，用于简化JDBC开发<br>官网：<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p>
<span id="more"></span>

<h3 id="持久层"><a href="#持久层" class="headerlink" title="持久层"></a>持久层</h3><p>负责将数据保存到数据库中的那一层代码，JavaEE三层架构：表现层、业务层、持久层</p>
<h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h3><p>框架是一个半成品软件，是一套可重用的、通用的、软件基础代码模型，在框架的基础上构建软件编写更加高效、规范、通用、可扩展</p>
<h3 id="JDBC的缺点"><a href="#JDBC的缺点" class="headerlink" title="JDBC的缺点"></a>JDBC的缺点</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804132913.png" width=70%></div>

<ul>
<li><p>硬编码(将字符串写入代码中，维护性较差)</p>
</li>
<li><p><strong>解决方案：使用配置文件</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804133046.png" width=70%></div>

</li>
<li><p>操作繁琐(需要手动设置参数，手动封装结果集)</p>
</li>
<li><p><strong>解决方案：一行代码解决</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804133115.png" width=80%></div></li>
</ul>
<blockquote>
<p>MyBatis免除了几乎所有的JDBC代码，以及设置参数和获取结果集的工作</p>
</blockquote>
<h3 id="MyBatis快速入门"><a href="#MyBatis快速入门" class="headerlink" title="MyBatis快速入门"></a>MyBatis快速入门</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804164831.png" width=80%></div>

<h4 id="1-创建user表，添加数据"><a href="#1-创建user表，添加数据" class="headerlink" title="1. 创建user表，添加数据"></a>1. 创建user表，添加数据</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database mybatis;</span><br><span class="line">use mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> tb_user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	username <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	password <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	gender <span class="type">char</span>(<span class="number">1</span>),</span><br><span class="line">	addr <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;123&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;234&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="string">&#x27;345&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;成都&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2-创建模块，导入坐标"><a href="#2-创建模块，导入坐标" class="headerlink" title="2. 创建模块，导入坐标"></a>2. 创建模块，导入坐标</h4><p>如何创建空项目用以导入模块，在创建项目时选择:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804170430.png" width=90%></div>

<p>这样创建的项目就是空项目，直接导入模块即可：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804170513.png" width=60%></div>

<p>在mybatis官网可以查看依赖导入方法：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804170807.png" width=80%></div>

<h4 id="3-编写MyBatis核心配置文件"><a href="#3-编写MyBatis核心配置文件" class="headerlink" title="3. 编写MyBatis核心配置文件"></a>3. 编写MyBatis核心配置文件</h4><p>从XML中构建SqlSessionFactory，也是根据mybatis官网上的内容来：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804173933.png" width=80%></div>

<blockquote>
<p>文件名为mybatis-config.xml，放在src&#x2F;main&#x2F;resources下</p>
</blockquote>
<p>根据自己的mysql信息进行配置即可</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mybatis?useSSL=false&quot;</span>/&gt;</span>  <span class="comment">&lt;!--mybatis是数据库名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;801299&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加载sql的映射文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span>  <span class="comment">&lt;!--还没修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-编写SQL映射文件"><a href="#4-编写SQL映射文件" class="headerlink" title="4. 编写SQL映射文件"></a>4. 编写SQL映射文件</h4><p>下面还需要配置sql的映射文件：</p>
<blockquote>
<p>文件名：这个表存放的内容+Mapperxml，例如：UserMapper.xml，这么取只是为了方便查看，没有其它实际含义<br>放在 src&#x2F;main&#x2F;resources下</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置后为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    namespace:命名空间</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mxeron.pojo.User&quot;</span>&gt;</span>  </span><br><span class="line">        /*User类是自己创建的*/</span><br><span class="line">        /*id是下面这条sql语句的唯一标识, resultType是返回结果的数据类型*/</span><br><span class="line">        select * from tb_user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>namespace命名空间：mybatis中为每一个映射文件添加一个namespace，这样<strong>不同的映射文件中sql语句的id相同也不会有冲突</strong>，只要定义在映射文件中的sql语句在该映射文件中id唯一就可以</p>
<p><strong>这个namespace必须要和映射文件对应的接口文件的路径一致</strong></p>
</blockquote>
<p>再返回mybatis-config.xml中加载sql的映射文件：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804175147.png" width=80%></div>

<h4 id="5-编码实现功能"><a href="#5-编码实现功能" class="headerlink" title="5. 编码实现功能"></a>5. 编码实现功能</h4><p>先构建好User类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// alt + 鼠标左键可以实现整列编辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id      ;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String gender  ;</span><br><span class="line">    <span class="keyword">private</span> String addr    ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// alt + insert 选择getter、setter 选择所有变量即可一键构建</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(String gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(String addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// alt + insert 选择toString</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, addr=&#x27;&quot;</span> + addr + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再加载MyBatis核心配置文件，获取SqlSessionFactory，执行相应的sql语句，最后释放资源：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> mxeron;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mybatis 快速入门代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行sql，传入名称空间+sql的id名</span></span><br><span class="line">        List&lt;User&gt; users = sqlSession.selectList(<span class="string">&quot;test.selectAll&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(users);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>需要注意的是，在项目中还配置了日志记录功能，下面讲讲如何配置：</strong></p>
<p>首先导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--添加slf4j日志api--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--添加logback-classic依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--添加logback-core依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在src&#x2F;main&#x2F;resources中新建一个logback.xml文件，内容如下，<strong>注意要修改下面内容中的路径！</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>System.out<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 日志输出格式：%d表示日期时间，%-5level：日志级别  ，%c取类 %thread表示线程名(在哪个方法执行)，</span></span><br><span class="line"><span class="comment">                %msg：日志消息，%n是换行符 ，不会用就去百度一下logback的日志格式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;[%-5level]  %c [%thread] :%msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 滚动记录文件，先将日志记录到指定文件，当符合某个条件时，将日志记录到其他文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125;-%msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志输出路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>D:/java_logback/mxeron-data1.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定日志文件拆分和压缩规则 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 通过指定压缩文件的名称，来确定分割文件方式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>D:/java_logback/mxeron-data2-%d&#123;yyyy-MMdd&#125;.log%i.gz	<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件拆分大小 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>1MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- level:用来设计打印级别，大小写无关：TRACE,DEBUG,INFO,WARN,ERROR,ALL和OFF,默认debug</span></span><br><span class="line"><span class="comment">    &lt;root&gt;可以包含零个或多个&lt;appender-ref&gt;元素,标识这个输出位置将会被本日志级别控制。</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;ALL&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注意：如果这里不配置关联打印位置，该位置将不会记录日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后就可以看到相应的日志信息：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804200130.png" width=70%></div>

<p>下面是日志文件记录：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804200139.png" width=70%></div>

<p>整个项目的路径如下：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804200231.png" width=30%></div>

<h3 id="在Idea中配置MySQL数据库连接"><a href="#在Idea中配置MySQL数据库连接" class="headerlink" title="在Idea中配置MySQL数据库连接"></a>在Idea中配置MySQL数据库连接</h3><p>为了在编写SQL映射Mapper文件时，没有警告提示，需要在Idea中建立与数据库的连接</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804200457.png" width=50%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804200706.png" width=70%></div>

<h3 id="Mapper代理开发"><a href="#Mapper代理开发" class="headerlink" title="Mapper代理开发"></a>Mapper代理开发</h3><p>仔细看上面的代码：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804201523.png" width=80%></div>

<p><strong>会发现红框中的代码，还是在硬编码！而且你还得去SQL映射文件中查名称空间 + 对应SQL语句的id，怎么处理？</strong></p>
<blockquote>
<p>Mapper代理开发，通过获取代理对象，使用代理对象执行相应的sql语句来解决原生方式中的硬编码，以及简化后期执行SQL</p>
</blockquote>
<h4 id="Mapper代理入门案例"><a href="#Mapper代理入门案例" class="headerlink" title="Mapper代理入门案例"></a>Mapper代理入门案例</h4><ol>
<li>定义与SQL映射文件<strong>同名的Mapper接口</strong>，并保证Mapper接口和SQL映射文件放置在同一个目录下：</li>
</ol>
<p>一定要保证java编译后生成的class文件和UserMapper.xml在同一目录，直接把UserMapper.xml放到java代码文件夹中并不妥当，因为我们是把code和resources分开放的，这就<strong>需要在resources中新建一个和上面src&#x2F;main&#x2F;java中的目录结构相同的文件夹，这样在java编译后，class文件和UserMapper.xml文件就可以在一起了!</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804202943.png" width=35%></div>

<blockquote>
<p>需要注意的是，resources中创建多级目录使用’&#x2F;‘，而不是’.’，’com&#x2F;mxeron&#x2F;mapper’</p>
</blockquote>
<p>修改了SQL映射文件的地址后还要回到mybatis-config.xml中修改mapper的地址：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220804204222.png" width=80%></div>

<ol start="2">
<li>设置SQL映射文件的namespace属性<strong>为Mapper接口全限定名</strong></li>
</ol>
<p>全限定名就是Mapper接口所在的位置：例如“com.mxeron.mapper.UserMapper”</p>
<ol start="3">
<li>在Mapper接口中定义方法，方法名就是SQL映射文件中sql语句的id，并保持参数类型和返回值类型一致</li>
</ol>
<p>类型一致是说：如果明确知道当前的sql语句会返回一个List，那就需要设置返回值类型为List<xxx></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口要和UserMapper.xml在同一目录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAll</span><span class="params">()</span>;  <span class="comment">// 因为查询结果是集合</span></span><br><span class="line">    <span class="comment">// id和方法名一致</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="4">
<li>编码<ol>
<li><strong>通过SqlSession的getMapper方法获取Mapper接口的代理对象</strong></li>
<li>调用对应方法完成sql语句的执行</li>
</ol>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> mxeron;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mybatis的代理开发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisDemo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 旧：执行sql，传入名称空间+sql的id名</span></span><br><span class="line">        <span class="comment">// List&lt;User&gt; users = sqlSession.selectList(&quot;test.selectAll&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新：代理开发，获取UserMapper接口的代理对象</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br></pre></td></tr></table></figure>

<p><strong>这句代码其实很让人产生疑惑，为什么传入接口.class，也就是类型，就可以获取相应SQL映射文件的代理对象？</strong></p>
<blockquote>
<p>关于getMapper的源码解析，可以见这篇文章：<a href="https://blog.csdn.net/qq_40645822/article/details/101844675">https://blog.csdn.net/qq_40645822/article/details/101844675</a></p>
</blockquote>
<p>使用Mapper代理方式后，可以很方便的加载sql映射文件，将mybatis-config.xml中的内容进行修改：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载sql的映射文件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;mapper resource=&quot;com/mxeron/mapper/UserMapper.xml&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--和sql映射文件同一目录，可以直接导入--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Mapper代理方式，使用包扫描更方便加载，扫描包后自动识别出里面的映射文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mxeron.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用前提：Mapper接口名和SQL映射文件名相同，且在同一目录下--&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="MyBatis核心配置文件"><a href="#MyBatis核心配置文件" class="headerlink" title="MyBatis核心配置文件"></a>MyBatis核心配置文件</h3><p>顶层结构如下：</p>
<ul>
<li>properties:属性</li>
<li>settings:设置</li>
<li>typeAliases:类型别名</li>
<li>typeHandlers:类型处理器</li>
<li>objectFactory:对象工厂</li>
<li>plugins:插件</li>
<li>environment:环境配置<ul>
<li>environment:环境变量<ul>
<li>transactionManager:事务管理器</li>
<li>dataSource:数据源</li>
</ul>
</li>
</ul>
</li>
<li>databaseIdProvider:数据库厂商标识</li>
<li>mappers:映射器</li>
</ul>
<blockquote>
<p>配置各个标签时，需要遵守前后的顺序</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- environments:配置数据库连接环境信息，可以配置多个environment，通过default属性切换不同的environment --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mybatis?useSSL=false&quot;</span>/&gt;</span>  <span class="comment">&lt;!--mybatis是数据库名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;801299&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 之后transactionManager 和 dataSource 的信息都会被Spring接管，这里就不需要管 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加载sql的映射文件--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource=&quot;com/mxeron/mapper/UserMapper.xml&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--和sql映射文件同一目录，可以直接导入--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Mapper代理方式，使用包扫描更方便加载，扫描包后自动识别出里面的映射文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mxeron.mapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用前提：Mapper接口名和SQL映射文件名相同，且在同一目录下--&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先是environments中可以设定多个数据库的environment，例如：development、test之类的，使用哪一个就将外面default设定为哪一个的id值，之后就可以动态切换数据源</p>
<p><strong>可以在里面添加typeAliases，用于设置某个类型的别名，目的是为了简化：</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--设置类型别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            typeAlias：设置某个类型的别名</span></span><br><span class="line"><span class="comment">            属性：</span></span><br><span class="line"><span class="comment">                type：设置需要设置别名的类型</span></span><br><span class="line"><span class="comment">                alias：设置某个类型的别名，若不设置该属性，那么该类型拥有默认的别名，即类名，且不区分大小写</span></span><br><span class="line"><span class="comment">                注意：默认的别名就是类名，且不区分大小写</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定特定类型的别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.mxeron.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;User&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">typeAlias</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--以包为单位，将包下所有的类型设置默认的类型别名，即类名且不区分大小写--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mxeron.pojo&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置好后就可以修改UserMapper.xml中resultType的内容，写为别名即可，注意不区分大小写：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    namespace:名称空间</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mxeron.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span>  /*User类是自己创建的*/</span><br><span class="line">        /*id是下面这条sql语句的唯一标识, resultType是返回结果的数据类型*/</span><br><span class="line">        select * from tb_user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用typeAliases可以简化resultType的配置，resultType用于指定返回的类型</p>
</blockquote>
<h3 id="配置文件完成增删改查"><a href="#配置文件完成增删改查" class="headerlink" title="配置文件完成增删改查"></a>配置文件完成增删改查</h3><h4 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h4><ul>
<li>数据库表tb_brand</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> tb_brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_brand(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,  # 主键</span><br><span class="line">  brand_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">  company_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">  ordered <span class="type">int</span>,  # 排序字段</span><br><span class="line">  description <span class="type">varchar</span>(<span class="number">100</span>),</span><br><span class="line">  status <span class="type">int</span>  # 状态:<span class="number">0</span>禁用 <span class="number">1</span>启用</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_brand (brand_name, company_name, ordered, description, status)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;三只松鼠&#x27;</span>, <span class="string">&#x27;三只松鼠股份有限公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;好吃不上火&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;华为致力于把数字世界带入每个人、每个家庭&#x27;</span>,<span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_brand;</span><br></pre></td></tr></table></figure>

<ul>
<li>实体类Brand</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Brand</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id          ;</span><br><span class="line">    <span class="keyword">private</span> String brandName  ;</span><br><span class="line">    <span class="keyword">private</span> String companyName;</span><br><span class="line">    <span class="keyword">private</span> Integer ordered     ;</span><br><span class="line">    <span class="keyword">private</span> String description ;</span><br><span class="line">    <span class="keyword">private</span> Integer status      ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrandName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBrandName</span><span class="params">(String brandName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCompanyName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompanyName</span><span class="params">(String companyName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getOrdered</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrdered</span><span class="params">(Integer ordered)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ordered = ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(Integer status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Brand&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, brandName=&#x27;&quot;</span> + brandName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, companyName=&#x27;&quot;</span> + companyName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, ordered=&quot;</span> + ordered +</span><br><span class="line">                <span class="string">&quot;, description=&#x27;&quot;</span> + description + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, status=&quot;</span> + status +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试用例</li>
</ul>
<p>在src&#x2F;test&#x2F;java下创建相应的包和类:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805125852.png" width=40%></div>

<ul>
<li>MyBatisX插件</li>
</ul>
<p>由之前的代码可以知道，每次需要查看UserMapper接口中的方法名和UserMapper.xml文件中SQL语句的id和resultType，保证两个文件中的内容是相互对应的:</p>
<p><strong>UserMapper接口：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口要和UserMapper.xml在同一目录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAll</span><span class="params">()</span>;  <span class="comment">// 因为查询结果是集合</span></span><br><span class="line">    <span class="comment">// id和方法名一致</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>UserMapper.xml映射文件：</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    namespace:名称空间</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mxeron.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span>  /*User类是自己创建的*/</span><br><span class="line">        /*id是下面这条sql语句的唯一标识, resultType是返回结果的数据类型*/</span><br><span class="line">        select * from tb_user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>要注意上下两个文件在编译后要处在同一目录</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805130850.png" width=30%></div>
</blockquote>
<p><strong>为了配置好这两个文件，每次都需要来回切换查看，就可以使用MyBatisX插件，方便进行配置!</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805131152.png" width=70%></div>

<p>安装之后可以直接点击旁边的小鸟进行相应映射文件的跳转：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805131330.png" width=70%></div>

<p>并且在UserMapper.java中写方法时，如果映射文件中没有相应的sql语句，会自动帮你创建，十分的方便!</p>
<h4 id="完成品牌数据的增删改查操作"><a href="#完成品牌数据的增删改查操作" class="headerlink" title="完成品牌数据的增删改查操作"></a>完成品牌数据的增删改查操作</h4><p>1.查询</p>
<ul>
<li>查询所有数据</li>
<li>查看详情</li>
<li>条件查询</li>
</ul>
<p>2.添加</p>
<p>3.修改</p>
<ul>
<li>修改全部字段</li>
<li>修改动态字段</li>
</ul>
<p>4.删除</p>
<ul>
<li>删除一个</li>
<li>批量删除</li>
</ul>
<blockquote>
<p>无论完成什么功能，无非就需要三步：</p>
<ul>
<li>编写Mapper接口方法<ul>
<li>参数？</li>
<li>结果类型？</li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>编写mybatis模板，执行方法，完成测试</li>
</ul>
</blockquote>
<p>为了在写SQL映射文件时有SQL语句提示信息，可以按照下面进行配置：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805133440.png" width=70%></div>

<p>配置完成后就有提示啦：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805133515.png" width=60%></div>

<h5 id="查询select"><a href="#查询select" class="headerlink" title="查询select"></a>查询select</h5><p><strong>1. 查询</strong></p>
<p><strong>1.1 查询所有数据</strong></p>
<p>编写接口方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.Brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口要和BrandMapper.xml在同一目录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BrandMapper</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置SQL映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    namespace:名称空间</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mxeron.mapper.BrandMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--因为在mybatis-config.xml中配置的是包扫描，别名默认为类名--&gt;</span></span><br><span class="line">        select * from tb_brand;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写测试代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.mapper.BrandMapper;</span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.Brand;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSeletAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.获取Mapper接口的代理对象</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">brandMapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最主要的是下面的执行，上面都是写好的</span></span><br><span class="line">        <span class="comment">// 4.执行方法</span></span><br><span class="line">        List&lt;Brand&gt; brands = brandMapper.selectAll();</span><br><span class="line">        System.out.println(brands);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>需要注意，数据库表中的字段名称如果跟实体类的属性名称不一致，则不能进行自动封装，解决方法：</strong></p>
<ul>
<li>第一种方法，在sql映射文件中写sql语句时，使用as关键字，来取别名，别名和实体类的属性名一致：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">    select id, brand_name as brandName, company_name as companyName xxxx from tb_brand;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>缺点：每次写sql语句都要定义一次别名</li>
</ul>
<hr>
<ul>
<li>另一种方法，使用sql片段：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;brand_column&quot;</span>&gt;</span></span><br><span class="line">    id, brand_name as brandName, ompany_name as companyName, ordered, description, status</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;brand_column&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 在这里完成对sql片段的引入 --&gt;</span></span><br><span class="line">    from tb_brand; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>缺点：不灵活</li>
</ul>
<hr>
<ul>
<li>第三种方法，最常用的：resultMap，根据具体的业务需求，完成数据库表中列名 到 实体类中属性名 的映射：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    namespace:名称空间</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mxeron.mapper.BrandMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--resultMap用于完成数据库表中列名 到 实体类的属性名的映射--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--id随便取，type为结果类型resultType，同样可以使用别名(使用别名前要先配置mybatis-config)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;brandResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--id完成主键字段的映射，result完成一般字段的映射--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;brand_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;brandName&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;company_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;companyName&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--column是数据库表中的列名，property是实体类中的属性名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--填入resultMap的id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from tb_brand;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>简单说就三步：编写接口方法-&gt;编写sql语句-&gt;编写执行方法，进行测试</p>
</blockquote>
<h4 id="resultMap和resultType的区别"><a href="#resultMap和resultType的区别" class="headerlink" title="resultMap和resultType的区别"></a>resultMap和resultType的区别</h4><p><strong>resultMap和resultType一样都是为了将表查询的结果集映射到自定义的实体类中。但在使用MyBatis进行表查询的时候可能会遇到两个问题：表的列名字段与实体类属性名不一致、多表查询需要将返回的结果集封装为多个实体类对象。这时候resultType便无法解决这两个问题，而resultMap可以根据配置信息将表的列名字段与实体类属性名直接进行映射，不需要像resultType一样需要表字段和属性名一致才能进行映射</strong>，所以resultMap包含了resultType的功能，并且还能完成表中列名-&gt;属性名的映射，这就是为什么后面无论什么情况都在使用resultMap，而没有用resultType的原因。</p>
<p><strong>使用resultMap时要完成数据库字段到java实体类属性字段的映射！</strong></p>
<blockquote>
<p>但一般只在查询时才需要resultMap，因为此时是从数据库中拿数据存储到实体对象中</p>
</blockquote>
<p><strong>1.2 查看详情</strong></p>
<ul>
<li>编写Mapper接口方法：<ul>
<li>参数：哪个商品-id</li>
<li>结果：Brand，只返回一个商品的详情</li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>执行方法，测试</li>
</ul>
<p><strong>MyBatis如何接收参数？</strong></p>
<p><strong>MyBatis中的参数占位符</strong></p>
<ul>
<li><p>#{}:会将括号内部内容替换为 ?，为了防止SQL注入</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805141921.png" width=80%></div>
</li>
<li><p>${}:直接拼接括号内参数，存在SQL注入问题</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805142019.png" width=80%></div></li>
</ul>
<p>使用时机：</p>
<ul>
<li>参数传递时：#{}</li>
<li>表名或列名不固定的情况：${}，很少用，会有sql注入问题</li>
<li><strong>参数类型：在select标签中的parameterType：一般省略</strong></li>
<li><strong>特殊字符的处理：sql语句中大于号没有问题，小于号就要出错</strong><ul>
<li>转义字符：小于号：<code>&amp;lt;</code></li>
<li>CDATA区：写CD，Idea会补全</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdBrand&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tb_brand where id</span><br><span class="line">        &lt;![CDATA[</span><br><span class="line">        &lt;</span><br><span class="line">        ]]&gt;</span><br><span class="line">        #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>这里只介绍了单参数的情况，之后会继续介绍多参数的处理方法</strong></p>
<hr>
<p>在之前使用resultMap的基础上进行代码编写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.Brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口要和BrandMapper.xml在同一目录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BrandMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 查看详情：根据商品Id查询</span></span><br><span class="line">    <span class="keyword">public</span> Brand <span class="title function_">selectByIdBrand</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdBrand&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tb_brand where id = #&#123;id&#125;;  <span class="comment">&lt;!--参数占位符#&#123;&#125;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>1.3 条件查询(使用较多)</strong></p>
<p><strong>1.3.1 多条件查询</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805152531.png" width=80%></div>

<p>可以看到有三个条件：当前状态(status)、企业名称(company_name)、品牌名称(brand_name)</p>
<blockquote>
<p>企业名称 和 品牌名称 <strong>都使用模糊查询like ?</strong></p>
</blockquote>
<ul>
<li>编写Mapper接口方法：<ul>
<li>参数：状态、企业名称、品牌名称(所有所需的查询条件)</li>
<li>结果：List<Brand></li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>执行方法，测试</li>
</ul>
<h4 id="MyBatis多参数传递"><a href="#MyBatis多参数传递" class="headerlink" title="MyBatis多参数传递"></a>MyBatis多参数传递</h4><p><strong>MyBatis如何实现多参数的传递？三种方式：</strong></p>
<p>sql映射文件都一样，不用变，先把sql语句写好</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tb_brand</span><br><span class="line">    where</span><br><span class="line">        status = #&#123;status&#125;</span><br><span class="line">        and company_name like #&#123;companyName&#125;</span><br><span class="line">        and brand_name like #&#123;brandName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.使用@Param()注解<br>2.封装成对象<br>3.封装成Map集合</p>
<p>sql映射相对应的接口代码(BrandMapper.java)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mxeron.pojo.Brand;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口要和BrandMapper.xml在同一目录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BrandMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查看详情：根据商品Id查询</span></span><br><span class="line">    <span class="keyword">public</span> Brand <span class="title function_">selectByIdBrand</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 条件查询</span></span><br><span class="line"><span class="comment">     *  * 参数接受</span></span><br><span class="line"><span class="comment">     *      1. 散装参数：如果方法中有多个参数，需要使用<span class="doctag">@Param</span>(&quot;SQL语句中相应的占位符名称&quot;)</span></span><br><span class="line"><span class="comment">     *      2. 对象参数：对象的属性名称和参数占位符名称一致</span></span><br><span class="line"><span class="comment">     *      3. map集合参数：和对象参数类似，只不过用key-value形式进行存储</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> companyName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brandName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="comment">//    public List&lt;Brand&gt; selectByCondition(@Param(&quot;status&quot;)int status,</span></span><br><span class="line"><span class="comment">//                                         @Param(&quot;companyName&quot;)String companyName,</span></span><br><span class="line"><span class="comment">//                                         @Param(&quot;brandName&quot;)String brandName);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    public List&lt;Brand&gt; selectByCondition(Brand brand);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Brand&gt; <span class="title function_">selectByCondition</span><span class="params">(Map map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSeletByCondition</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 接受参数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">companyName</span> <span class="operator">=</span> <span class="string">&quot;华为&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">brandName</span> <span class="operator">=</span> <span class="string">&quot;华为&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面要处理参数以实现模糊匹配</span></span><br><span class="line">        companyName = <span class="string">&quot;%&quot;</span> + companyName + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        brandName = <span class="string">&quot;%&quot;</span> + brandName + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        <span class="comment">// %用于匹配任意多个字符</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.获取Mapper接口的代理对象</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">brandMapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最主要的是下面的执行，上面都是写好的</span></span><br><span class="line">        <span class="comment">// 4.执行方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        // 4.1 使用@Param()注解</span></span><br><span class="line"><span class="comment">//        List&lt;Brand&gt; brands = brandMapper.selectByCondition(status, companyName, brandName);</span></span><br><span class="line"><span class="comment">//        System.out.println(brands);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        // 4.2 封装对象</span></span><br><span class="line"><span class="comment">//        Brand brand = new Brand();</span></span><br><span class="line"><span class="comment">//        brand.setStatus(status);</span></span><br><span class="line"><span class="comment">//        brand.setBrandName(brandName);</span></span><br><span class="line"><span class="comment">//        brand.setCompanyName(companyName);</span></span><br><span class="line"><span class="comment">//        List&lt;Brand&gt; brands = brandMapper.selectByCondition(brand);</span></span><br><span class="line"><span class="comment">//        System.out.println(brands);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.3 封装成Map集合</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, status);</span><br><span class="line">        map.put(<span class="string">&quot;brandName&quot;</span>, brandName);</span><br><span class="line">        map.put(<span class="string">&quot;companyName&quot;</span>, companyName);</span><br><span class="line"></span><br><span class="line">        List&lt;Brand&gt; brands = brandMapper.selectByCondition(map);</span><br><span class="line">        System.out.println(brands);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>1.3.2 多条件动态条件查询</strong></p>
<p><strong>思考这样一个问题，面对这样一个多条件查询，用户有可能并不会把所有条件都填写上，可能只写了brandName 或者 companyName，该如何实现？</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805152531.png" width=80%></div>

<h4 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h4><p>mybatis的官方介绍和讲解：<a href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html">https://mybatis.org/mybatis-3/zh/dynamic-sql.html</a></p>
<p><strong>我们需要SQL语句能够根据外部条件的变化而变化，称为动态SQL</strong></p>
<p>MyBatis对动态SQL有强大的支持：</p>
<ul>
<li>if</li>
<li>choose(when, otherwise)</li>
<li>trim(where, set)</li>
<li>foreach</li>
</ul>
<p><strong>只需要修改sql映射文件中内容，相对应的接口文件不用修改</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--动态条件查询</span></span><br><span class="line"><span class="comment">        if: 条件判断</span></span><br><span class="line"><span class="comment">            test:写逻辑表达式，and、or</span></span><br><span class="line"><span class="comment">        问题：第一个条件不能为null</span></span><br><span class="line"><span class="comment">            解决方法：</span></span><br><span class="line"><span class="comment">                * 把第一个条件写成恒等式：1=1，之前的第一个sql语句要添加and</span></span><br><span class="line"><span class="comment">                * &lt;where&gt; 替换 where 关键字，会自动去除and(推荐)</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from tb_brand</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">              status = #&#123;status&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;companyName != null and companyName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">              and company_name like #&#123;companyName&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brandName != null and brandName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">              and brand_name like #&#123;brandName&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>有了上面动态sql的支持，就可以完成多条件动态查询!</strong></p>
<p><strong>1.3.3 单条件动态条件查询</strong></p>
<p>顾名思义，实现一个条件的动态查询</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805163550.png" width=80%></div>

<p>choose(when, otherwise)进行选择，类似于Java中的switch语句</p>
<p>sql映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--单条件动态查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByConditionSingle&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from tb_brand</span><br><span class="line">        where</span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                status=#&#123;status&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;companyName != null and companyName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                company_name like #&#123;companyName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brandName != null and brandName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                brand_name like #&#123;brandName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                1 = 1  /*这个恒等式一定要写，因为可能用户一个条件也没有输入!!!*/</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里也可以不用otherwise，而是将choose、when外面用where包裹起来，<strong>它们的最终目的都是为了避免所有条件为null时出现错误</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--单条件动态查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByConditionSingle&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from tb_brand</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                    status=#&#123;status&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;companyName != null and companyName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                    company_name like #&#123;companyName&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brandName != null and brandName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                    brand_name like #&#123;brandName&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意上面的<xxx>后面都不要写注释，否则会报错</strong></p>
<p>映射文件对应的接口方法定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Brand&gt; <span class="title function_">selectByConditionSingle</span><span class="params">(Brand brand)</span>;</span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByConditionSingle</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 接受参数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">companyName</span> <span class="operator">=</span> <span class="string">&quot;华为&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">brandName</span> <span class="operator">=</span> <span class="string">&quot;华为&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面要处理参数以实现模糊匹配</span></span><br><span class="line">        companyName = <span class="string">&quot;%&quot;</span> + companyName + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        brandName = <span class="string">&quot;%&quot;</span> + brandName + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        <span class="comment">// %用于匹配任意多个字符</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.获取Mapper接口的代理对象</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">brandMapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最主要的是下面的执行，上面都是写好的</span></span><br><span class="line">        <span class="comment">// 4.执行方法</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 封装对象方法</span></span><br><span class="line">        <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Brand</span>();</span><br><span class="line">        brand.setStatus(status);</span><br><span class="line"><span class="comment">//        brand.setBrandName(brandName);</span></span><br><span class="line"><span class="comment">//        brand.setCompanyName(companyName);</span></span><br><span class="line">        List&lt;Brand&gt; brands = brandMapper.selectByConditionSingle(brand);</span><br><span class="line">        System.out.println(brands);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="添加insert"><a href="#添加insert" class="headerlink" title="添加insert"></a>添加insert</h5><p><strong>1. 添加</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805171451.png" width=80%></div>

<p>可以看到，用户添加时并不需要指定id值，所以一般将id设置为auto_increment，并且不会手动设置id，而是让它自动设置</p>
<p><strong>1.1 最基础的添加</strong></p>
<ul>
<li>编写Mapper接口方法：<ul>
<li>参数：除了id外所有数据</li>
<li>结果：void(也可以写成int，代表影响行数)</li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>执行方法，测试</li>
</ul>
<p>sql映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--普通添加--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line">    /*输入ins自动补全*/</span><br><span class="line">    insert into tb_brand (brand_name, company_name, ordered, description, status)</span><br><span class="line">    values (#&#123;brandName&#125;,#&#123;companyName&#125;,#&#123;ordered&#125;,#&#123;description&#125;,#&#123;status&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对应的接口方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 普通添加</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Brand brand)</span>;</span><br></pre></td></tr></table></figure>

<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 接受参数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">companyName</span> <span class="operator">=</span> <span class="string">&quot;波导手机&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">brandName</span> <span class="operator">=</span> <span class="string">&quot;波导&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> <span class="string">&quot;手机中的战斗机&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ordered</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 封装对象方法</span></span><br><span class="line">    <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Brand</span>();</span><br><span class="line">    brand.setStatus(status);</span><br><span class="line">    brand.setBrandName(brandName);</span><br><span class="line">    brand.setCompanyName(companyName);</span><br><span class="line">    brand.setDescription(description);</span><br><span class="line">    brand.setOrdered(ordered);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.获取SqlSession对象，用来执行sql</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.获取Mapper接口的代理对象</span></span><br><span class="line">    <span class="type">BrandMapper</span> <span class="variable">brandMapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最主要的是下面的执行，上面都是写好的</span></span><br><span class="line">    <span class="comment">// 4.执行方法</span></span><br><span class="line">    brandMapper.add(brand);</span><br><span class="line">    <span class="comment">// 5.释放资源</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>执行后发现数据并没有写到数据库中，发现下面的日志中</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805193531.png" width=80%></div>

<p>mybatis将自动提交给关闭了，执行了sql语句后又把事务roll back了，也就是说需要我们手动提交事务，需要在测试代码中加上</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 提交事务</span></span><br><span class="line">sqlSession.commit();</span><br></pre></td></tr></table></figure>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805193835.png" width=80%></div>

<p>这样就成功提交了事务，也可以修改openSession的参数为true，这样就可以自动提交事务，不用再去手动提交</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2.获取SqlSession对象，用来执行sql</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h4 id="MyBatis事务"><a href="#MyBatis事务" class="headerlink" title="MyBatis事务"></a>MyBatis事务</h4><p><strong>MyBatis事务</strong></p>
<ul>
<li>openSession()：**默认开启事务(mybatis关闭了自动提交)**，进行增删改操作后需要使用sqlSession.commit();<strong>手动提交事务</strong></li>
<li>openSession(true)：可以设置为自动提交事务（关闭事务）</li>
</ul>
<p><strong>1.2 添加-主键返回</strong><br>在数据添加成功后，需要获取插入数据库数据的<strong>主键的值</strong>，举个例子：添加订单和订单项：</p>
<ul>
<li>添加订单</li>
<li>添加订单项，订单项中需要设置所属订单的id</li>
</ul>
<p>在数据添加后，调用brand.getId()得到的结果是null，是获取不到其Id值的，因为我们没有手动设置Id值，而是让数据库自己去给值，我们设定的是auto_increment，现在就需要去数据库里面拿到这个Id值</p>
<p>只需要在sql映射文件中添加如下内容即可将主键返回给id属性值</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--主键返回--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    /*keyProperty代表将返回的主键赋值给哪个属性值，一个表只有一个主键!*/</span><br><span class="line">    /*输入ins自动补全*/</span><br><span class="line">    insert into tb_brand (brand_name, company_name, ordered, description, status)</span><br><span class="line">    values (#&#123;brandName&#125;,#&#123;companyName&#125;,#&#123;ordered&#125;,#&#123;description&#125;,#&#123;status&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="修改update"><a href="#修改update" class="headerlink" title="修改update"></a>修改update</h5><p><strong>1. 修改</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805195456.png" width=80%></div>

<p><strong>1.1 修改全部字段</strong></p>
<ul>
<li>编写Mapper接口方法：<ul>
<li>参数：所有数据(id用于指定需要修改的数据id)</li>
<li>结果：void(也可以写成int，代表影响行数)</li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>执行方法，测试</li>
</ul>
<p>实现比较简单，直接给代码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--修改全部字段--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">    update tb_brand</span><br><span class="line">    set</span><br><span class="line">        brand_name = #&#123;brandName&#125;,</span><br><span class="line">        company_name = #&#123;companyName&#125;,</span><br><span class="line">        ordered = #&#123;ordered&#125;,</span><br><span class="line">        description = #&#123;description&#125;,</span><br><span class="line">        status = #&#123;status&#125;</span><br><span class="line">    where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 接受参数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">companyName</span> <span class="operator">=</span> <span class="string">&quot;波导手机&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">brandName</span> <span class="operator">=</span> <span class="string">&quot;波导&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> <span class="string">&quot;手机中的战斗机&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ordered</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">// 指定修改id</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 封装对象方法</span></span><br><span class="line">    <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Brand</span>();</span><br><span class="line">    brand.setStatus(status);</span><br><span class="line">    brand.setBrandName(brandName);</span><br><span class="line">    brand.setCompanyName(companyName);</span><br><span class="line">    brand.setDescription(description);</span><br><span class="line">    brand.setOrdered(ordered);</span><br><span class="line">    brand.setId(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.获取SqlSession对象，用来执行sql</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.获取Mapper接口的代理对象</span></span><br><span class="line">    <span class="type">BrandMapper</span> <span class="variable">brandMapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最主要的是下面的执行，上面都是写好的</span></span><br><span class="line">    <span class="comment">// 4.执行方法</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> brandMapper.update(brand);</span><br><span class="line">    System.out.println(update);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.释放资源</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>1.2 修改动态字段(需要使用动态sql)</strong></p>
<p>例如修改密码时，用户只对密码进行了修改，并没有修改其它字段，这就需要修改动态字段</p>
<ul>
<li>编写Mapper接口方法：<ul>
<li>参数：部分数据</li>
<li>结果：void(也可以写成int，代表影响行数)</li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>执行方法，测试</li>
</ul>
<p>可以看看之前多条件动态查询的代码，进行类比</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--动态条件查询</span></span><br><span class="line"><span class="comment">        if: 条件判断</span></span><br><span class="line"><span class="comment">            test:写逻辑表达式，and、or</span></span><br><span class="line"><span class="comment">        问题：第一个条件不能为null</span></span><br><span class="line"><span class="comment">            解决方法：</span></span><br><span class="line"><span class="comment">                * 把第一个条件写成恒等式：1=1，之前的第一个sql语句要添加and</span></span><br><span class="line"><span class="comment">                * &lt;where&gt; 替换 where 关键字，会自动去除and(推荐)</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from tb_brand</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">              status = #&#123;status&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;companyName != null and companyName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">              and company_name like #&#123;companyName&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brandName != null and brandName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">              and brand_name like #&#123;brandName&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>类比可以得到修改动态字段的动态sql代码，和<where></where>一样，set也使用<set></set>，可以让mybatis自动优化sql代码，避免全空时出错，以及最后一个值status&#x3D;null时，存在多余逗号的问题</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--修改动态字段--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update tb_brand</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brandName != null and brandName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                brand_name = #&#123;brandName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;companyName != null and companyName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                company_name = #&#123;companyName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;ordered != null&quot;</span>&gt;</span></span><br><span class="line">                ordered = #&#123;ordered&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;description != null and description != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                description = #&#123;description&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="删除delete"><a href="#删除delete" class="headerlink" title="删除delete"></a>删除delete</h5><p><strong>1. 删除</strong></p>
<p>在下面的页面中可以看到一个单项删除按钮 和 批量删除按钮</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805201208.png" width=80%></div>

<p><strong>1.1 删除一个</strong></p>
<ul>
<li>编写Mapper接口方法：<ul>
<li>参数：id</li>
<li>结果：void((也可以写成int，代表删除行数))</li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>执行方法，测试</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--删除一个--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span>&gt;</span></span><br><span class="line">    delete from tb_brand where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.获取Mapper接口的代理对象</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">brandMapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最主要的是下面的执行，上面都是写好的</span></span><br><span class="line">        <span class="comment">// 4.执行方法</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> brandMapper.deleteById(id);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">        <span class="comment">// 5.释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>1.2 批量删除</strong></p>
<ul>
<li>编写Mapper接口方法：<ul>
<li>参数：id数组</li>
<li>结果：void((也可以写成int，代表删除行数))</li>
</ul>
</li>
<li>编写SQL语句，配置SQL映射文件</li>
<li>执行方法，测试</li>
</ul>
<h4 id="MyBatis数组参数的传递"><a href="#MyBatis数组参数的传递" class="headerlink" title="MyBatis数组参数的传递"></a>MyBatis数组参数的传递</h4><p>为了传递数组，需要使用@Param注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量删除</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteByIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> <span class="type">int</span>[] ids)</span>;</span><br></pre></td></tr></table></figure>

<p>在sql映射文件中，也要使用<foreach>来遍历ids数组中的每一个元素，以实现批量删除，因为不知道有多少个id要删除</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--批量删除--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">    delete from tb_brand</span><br><span class="line">    where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定separator让多个id分隔开，并指定左右开闭符号，in(id1,id2,id3,...)--&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>也可以不使用@Param注解，<strong>在mybatis中会将数组参数，封装为一个Map集合，默认键值对的关系为：array:数组，也就是说，可以写成下面这样</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--批量删除--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">    delete from tb_brand</span><br><span class="line">    where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;array&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="MyBatis底层的参数封装"><a href="#MyBatis底层的参数封装" class="headerlink" title="MyBatis底层的参数封装"></a>MyBatis底层的参数封装</h3><p>MyBatis接口方法中可以接受各种各样的参数，MyBatis底层对于这些参数进行不同的封装处理</p>
<ul>
<li><p>单个参数：</p>
<ol>
<li>POJO类型：直接使用，<strong>属性名 和 sql语句的参数占位符一致即可</strong></li>
</ol>
<ul>
<li>POJO是Plain OrdinaryJava Object的缩写 可以当作简单的Java对象 实际就是普通JavaBeans 外文名 POJO 全称 Plain Ordinary Java Objec</li>
</ul>
<ol start="2">
<li>Map集合：直接使用，<strong>键名 和 sql语句的参数占位符一致即可</strong></li>
<li>Collection：<strong>封装为Map集合</strong><ul>
<li>map.put(“arg0”,collection集合)</li>
<li>map.put(“collection”,collection集合)</li>
</ul>
</li>
<li>List：封装为Map集合<ul>
<li>map.put(“arg0”,list集合)</li>
<li>map.put(“collection”,list集合)</li>
<li>map.put(“collection”,list集合)</li>
</ul>
</li>
<li>Array：<ul>
<li>map.put(“arg0”,array数组)</li>
<li>map.put(“array”,array数组)</li>
</ul>
</li>
<li>其他类型：直接使用，<strong>随便占位符写什么都可以，因为就只有单个参数传递</strong></li>
</ol>
</li>
<li><p>多个参数：封装为Map集合，下面是默认的键值对关系</p>
<ul>
<li>map.put(“arg0”,参数值1)</li>
<li>map.put(“param1”,参数值1)</li>
<li>map.put(“arg1”,参数值2)</li>
<li>map.put(“param2”,参数值2)</li>
<li>也就是说我们可以对参数不做任何处理，直接使用mybatis的默认值也可以</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User <span class="title function_">select</span><span class="params">(String username, String password)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tb_user</span><br><span class="line">    where</span><br><span class="line">        username = #&#123;arg0&#125; and</span><br><span class="line">        password = #&#123;arg1&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样也可以查出来</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tb_user</span><br><span class="line">    where</span><br><span class="line">        username = #&#123;param1&#125; and</span><br><span class="line">        password = #&#123;param2&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>诶！这样也可以！</p>
<p><strong>MyBatis提供了ParamNameResolver类来进行参数封装</strong></p>
<p>去到该类的源码，可以看到这么一个方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getNamedParams</span><span class="params">(Object[] args)</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">int</span> <span class="variable">paramCount</span> <span class="operator">=</span> names.size();</span><br><span class="line">  <span class="keyword">if</span> (args == <span class="literal">null</span> || paramCount == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hasParamAnnotation &amp;&amp; paramCount == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> args[names.firstKey()];</span><br><span class="line">    <span class="keyword">return</span> wrapToMapIfCollection(value, useActualParamName ? names.get(<span class="number">0</span>) : <span class="literal">null</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> Map&lt;String, Object&gt; param = <span class="keyword">new</span> <span class="title class_">ParamMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : names.entrySet()) &#123;</span><br><span class="line">      param.put(entry.getValue(), args[entry.getKey()]);</span><br><span class="line">      <span class="comment">// add generic param names (param1, param2, ...)</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">String</span> <span class="variable">genericParamName</span> <span class="operator">=</span> GENERIC_NAME_PREFIX + (i + <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// ensure not to overwrite parameter named with @Param</span></span><br><span class="line">      <span class="keyword">if</span> (!names.containsValue(genericParamName)) &#123;</span><br><span class="line">        param.put(genericParamName, args[entry.getKey()]);</span><br><span class="line">      &#125;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> param;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，当有多个参数传入时，使用Map集合来存储参数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Map&lt;String, Object&gt; param = <span class="keyword">new</span> <span class="title class_">ParamMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p><strong>在有多个参数传入时，推荐使用@Param注解，用于替换Map集合中默认的arg&#x2F;param键名，来提高代码的可读性</strong></p>
<p>再点击wrapToMapIfCollection函数，进入，可以看到<strong>单个参数的封装情况</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">wrapToMapIfCollection</span><span class="params">(Object object, String actualParamName)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (object <span class="keyword">instanceof</span> Collection) &#123;</span><br><span class="line">      ParamMap&lt;Object&gt; map = <span class="keyword">new</span> <span class="title class_">ParamMap</span>&lt;&gt;();</span><br><span class="line">      map.put(<span class="string">&quot;collection&quot;</span>, object);</span><br><span class="line">      <span class="keyword">if</span> (object <span class="keyword">instanceof</span> List) &#123;</span><br><span class="line">        map.put(<span class="string">&quot;list&quot;</span>, object);</span><br><span class="line">      &#125;</span><br><span class="line">      Optional.ofNullable(actualParamName).ifPresent(name -&gt; map.put(name, object));</span><br><span class="line">      <span class="keyword">return</span> map;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (object != <span class="literal">null</span> &amp;&amp; object.getClass().isArray()) &#123;</span><br><span class="line">      ParamMap&lt;Object&gt; map = <span class="keyword">new</span> <span class="title class_">ParamMap</span>&lt;&gt;();</span><br><span class="line">      map.put(<span class="string">&quot;array&quot;</span>, object);</span><br><span class="line">      Optional.ofNullable(actualParamName).ifPresent(name -&gt; map.put(name, object));</span><br><span class="line">      <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到：</p>
<ul>
<li>如果是Collection，mybatis中map默认的键值对有：arg0:Collection, collection:Collection</li>
<li>如果是List，还会在Collection的基础上，再多一个list:List的键值对</li>
<li>如果是Array，默认的键值对有：array:Array, arg0:Array</li>
</ul>
<blockquote>
<p>不管是什么，<strong>咱们都用上@Param注解，可以应对所有的情况，并且可读性更高！</strong></p>
</blockquote>
<blockquote>
<p>另外一个思考的点，我们知道，参数如果是Map集合，直接使用，<strong>键名 和 sql语句的参数占位符一致即可</strong>，如果Map集合中存放的是对象，在sql语句中该怎么写呢？</p>
</blockquote>
<p>首先，由于参数是Map集合，所以直接写Map中的键名就可以获取值，这个时候需要保持占位符中名称和Map中键名一致，通过user获取到user对象后，再对user对象点一下，就可以获得user对象内部的username 和 password，代码如下，比较有意思</p>
<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setUsername(username);</span><br><span class="line">user.setPassword(password);</span><br><span class="line">map.put(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.select(map);</span><br></pre></td></tr></table></figure>
<p>sql映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tb_user</span><br><span class="line">    where</span><br><span class="line">        username = #&#123;user.username&#125;</span><br><span class="line">        and password = #&#123;user.password&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注解完成增删改查"><a href="#注解完成增删改查" class="headerlink" title="注解完成增删改查"></a>注解完成增删改查</h3><p>就是将sql语句直接写入注解中，<strong>比配置文件开发更加方便！</strong></p>
<p>总共有四个注解：</p>
<ul>
<li>查询：@Select</li>
<li>添加：@Insert</li>
<li>修改：@Update</li>
<li>删除：@Delete</li>
</ul>
<p><strong>使用注解后直接在接口中的方法上写相应的注解即可，不需要再去sql映射文件中写代码。使用注解完成简单功能，配置文件完成复杂的功能！</strong></p>
<blockquote>
<p>来自mybatis官方文档的提醒：</p>
<ul>
<li>使用注解来映射简单语句会使代码显得更加简洁，但对于稍微复杂一点的语句，Java 注解不仅力不从心，还会让本就复杂的 SQL 语句更加混乱不堪。<strong>因此，如果你需要做一些很复杂的操作，最好用 XML 来映射语句。</strong></li>
<li>选择何种方式来配置映射，以及是否应该要统一映射语句定义的形式，完全取决于你和你的团队。 换句话说，永远不要拘泥于一种方式，<strong>你可以很轻松地在基于注解和 XML 的语句映射方式间自由移植和切换。</strong></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>MyBatis</tag>
      </tags>
  </entry>
  <entry>
    <title>贪心</title>
    <url>/2022/08/12/Algorithm/%E8%B4%AA%E5%BF%83/</url>
    <content><![CDATA[<h3 id="455-分发饼干-简单"><a href="#455-分发饼干-简单" class="headerlink" title="455.分发饼干(简单)"></a>455.分发饼干(简单)</h3><p><a href="https://leetcode.cn/problems/assign-cookies/">https://leetcode.cn/problems/assign-cookies/</a></p>
<p>思路：对于每个小孩，我们把刚好能够满足其胃口值的饼干分配给他，从小到大遍历小孩的胃口值和饼干，可以借助双指针，不用写双层for循环。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findContentChildren</span><span class="params">(<span class="type">int</span>[] g, <span class="type">int</span>[] s)</span> &#123;</span><br><span class="line">        Arrays.sort(g);</span><br><span class="line">        Arrays.sort(s);</span><br><span class="line">        <span class="type">int</span> <span class="variable">len1</span> <span class="operator">=</span> g.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len2</span> <span class="operator">=</span> s.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; len1 &amp;&amp; j &lt; len2) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[j] &gt;= g[i]) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                j++;</span><br><span class="line">                <span class="comment">// 当前饼干不能满足小孩胃口</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="376-摆动序列-中等"><a href="#376-摆动序列-中等" class="headerlink" title="376.摆动序列(中等)"></a>376.摆动序列(中等)</h3><p><a href="https://leetcode.cn/problems/wiggle-subsequence/">https://leetcode.cn/problems/wiggle-subsequence/</a></p>
<p>思路：题目中说可以是子序列，意思是可以删除部分元素，换个理解角度，其实就是找波峰的位置，明确波峰出现的条件和特殊情况即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">wiggleMaxLength</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) <span class="keyword">return</span> len;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;  <span class="comment">// 前一个差值的正负标记</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] == nums[i - <span class="number">1</span>]) <span class="keyword">continue</span>;  <span class="comment">// 相同不算摆动</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] - nums[i - <span class="number">1</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (pre != <span class="literal">null</span> &amp;&amp; pre) <span class="keyword">continue</span>;  <span class="comment">// 上一次差为正值</span></span><br><span class="line">                pre = <span class="literal">true</span>;  <span class="comment">// 上一次是null 或 为负值</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (pre != <span class="literal">null</span> &amp;&amp; !pre) <span class="keyword">continue</span>;  <span class="comment">// 上一次差为负值</span></span><br><span class="line">                pre = <span class="literal">false</span>;  <span class="comment">// 上一次是null 或 为正值</span></span><br><span class="line">            &#125;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Algorithm</category>
        <category>贪心</category>
      </categories>
      <tags>
        <tag>贪心</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML入门</title>
    <url>/2022/08/05/JavaWeb/HTML/HTML%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p>前端学习网站：<a href="https://www.w3school.com.cn/%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E8%BF%9B%E5%85%A5%E7%BD%91%E7%AB%99%E5%AD%A6%E4%B9%A0%E5%8D%B3%E5%8F%AF%EF%BC%8C%E9%9D%9E%E5%B8%B8%E7%9A%84%E6%96%B9%E4%BE%BF%E3%80%82">https://www.w3school.com.cn/，只需要进入网站学习即可，非常的方便。</a></p>
<span id="more"></span>

<h3 id="什么是HTML？"><a href="#什么是HTML？" class="headerlink" title="什么是HTML？"></a>什么是HTML？</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220805215445.png" width=80%></div>]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>JSP入门</title>
    <url>/2022/08/13/JavaWeb/JSP%E5%92%8CServlet/JSP%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h3 id="JSP-概述"><a href="#JSP-概述" class="headerlink" title="JSP 概述"></a>JSP 概述</h3><p>JSP（全称：Java Server Pages）：Java 服务端页面。&#x3D;&#x3D;是一种动态的网页技术，其中既可以定义 HTML、JS、CSS等静态内容，还可以定义 Java代码的动态内容，也就是 <code>JSP = HTML + Java</code>。如下就是jsp代码</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;JSP,Hello World&lt;/h1&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">        	System.out.println(<span class="string">&quot;hello,jsp~&quot;</span>);</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>上面代码 <code>h1</code> 标签内容是展示在页面上，而 Java 的输出语句是输出在 idea 的控制台。</p>
<span id="more"></span>

<p>那么，JSP 能做什么呢？现在我们只用 <code>servlet</code> 实现功能，看存在什么问题。如下图所示，当我们登陆成功后，需要在页面上展示用户名：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818101320935.png" width=70%></div>

<p>上图的用户名是动态展示，也就是谁登陆就展示谁的用户名。只用 <code>servlet</code> 如何实现呢？</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818102205544.png" width=70%></div>

<p>输入了 <code>zhangsan</code> 用户的登陆信息后点击 <code>登陆</code> 按钮，就能看到如下图效果</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818102313898.png" width=80%></div>

<p>当然如果是 <code>lisi</code> 登陆的，在该页面展示的就是 <code>lisi,欢迎您</code>，动态的展示效果就实现了。那么 <code>LoginServlet</code> 到底是如何实现的，我们看看它里面的内容：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818102506754.png" width=80%></div>

<p>上面的代码有大量使用到 <code>writer</code> 对象向页面写标签内容，这样我们的代码就显得很麻烦；将来如果展示的效果出现了问题，排错也显得有点力不从心。</p>
<p>而 JSP 是如何解决这个问题的呢？现在有一个<code>login.jsp</code> 页面，该页面也能实现该功能，现将该页面拷贝到项目的 <code>webapp</code>下，需要修改 <code>login.html</code> 中表单数据提交的路径为下图</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818103127245.png" width=80%></div>

<p>重新启动服务器并进行测试，发现也可以实现同样的功能。那么 <code>login.jsp</code> 又是如何实现的呢？那我们来看看 <code>login.jsp</code> 的代码</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818103352432.png" width=80%></div>

<p>上面代码可以看到里面基本都是 <code>HTML</code> 标签，<strong>而动态数据使用 Java 代码进行展示</strong>；这样操作看起来要比用 <code>servlet</code> 实现要舒服很多。</p>
<p><strong>JSP 作用：简化开发，避免了在Servlet中直接输出HTML标签</strong></p>
<h3 id="JSP快速入门"><a href="#JSP快速入门" class="headerlink" title="JSP快速入门"></a>JSP快速入门</h3><ol>
<li>创建一个maven项目：</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220814161122.png" width=40%></div>

<p>pom.xml配置为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mxeron<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-demo2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--一定要添加作用范围--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>导入JSP依赖坐标</li>
</ol>
<p>tomcat中自带了jsp jar包，所以在打包时就不要将其包含在内！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建JSP文件</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220814162149.png" width=80%></div>

<ol start="4">
<li>编写HTML标签和Java代码<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello jsp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &lt;%</span><br><span class="line">        /*控制台输出*/</span><br><span class="line">        System.out.println(&quot;hello jsp ~&quot;);</span><br><span class="line">    %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="JSP原理"><a href="#JSP原理" class="headerlink" title="JSP原理"></a>JSP原理</h3><p>Java Server Pages，Java服务端页面，JSP&#x3D;HTML + Java，用于简化开发。</p>
<p><strong>JSP本质上就是一个Servlet</strong></p>
<p>tomcat自动将jsp文件转换为Servlet(java文件)：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818111039350.png" width=80%></div>

<ol>
<li>浏览器第一次访问 <code>hello.jsp</code> 页面</li>
<li><code>tomcat</code> 会将 <code>hello.jsp</code> 转换为名为 <code>hello_jsp.java</code> 的一个 <code>Servlet</code></li>
<li><code>tomcat</code> 再将转换的 <code>servlet</code> 编译成字节码文件 <code>hello_jsp.class</code></li>
<li><code>tomcat</code> 会执行该字节码文件，向外提供服务</li>
</ol>
<p>我们可以到项目所在磁盘目录下找 <code>target\tomcat\work\Tomcat\localhost\jsp-demo\org\apache\jsp</code> 目录，而这个目录下就能看到转换后的 <code>servlet</code></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818112613589.png" width=80%></div>

<p>打开 <code>hello_jsp.java</code> 文件，来查看里面的代码</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818112724462.png" width=80%></div>

<p>由上面的类的继承关系可以看到继承了名为 <code>HttpJspBase</code> 这个类，那我们在看该类的继承关系。到资料中的找如下目录： <code>资料\tomcat源码\apache-tomcat-8.5.68-src\java\org\apache\jasper\runtime</code> ，该目录下就有 <code>HttpJspBase</code> 类，查看该类的继承关系</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818113118802.png" width=80%></div>

<p>可以看到该类继承了 <code>HttpServlet</code> ；那么 <code>hello_jsp</code> 这个类就间接的继承了 <code>HttpServlet</code> ，也就说明 <code>hello_jsp</code> 是一个 <code>servlet</code>。</p>
<p>继续阅读 <code>hello_jsp</code> 类的代码，可以看到有一个名为 <code>_jspService()</code> 的方法，该方法就是每次访问 <code>jsp</code> 时自动执行的方法，和 <code>servlet</code> 中的 <code>service</code> 方法一样 。</p>
<p>而在 <code>_jspService()</code> 方法中可以看到往浏览器写标签的代码：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818114008998.png" width=60%></div>

<p>以前我们自己写 <code>servlet</code> 时，这部分代码是由我们自己来写，现在有了 <code>jsp</code> 后，由tomcat完成这部分功能。</p>
<h3 id="JSP脚本分类"><a href="#JSP脚本分类" class="headerlink" title="JSP脚本分类"></a>JSP脚本分类</h3><p>JSP 脚本有如下三个分类：</p>
<ul>
<li>&lt;%…%&gt;：内容会直接放到 <strong>_jspService()方法</strong>之中</li>
<li>&lt;%&#x3D;…%&gt;：内容会放到<strong>out.print()中，作为out.print()的参数</strong></li>
<li>&lt;%!…%&gt;：内容会放到 <strong>_jspService()方法之外，被类直接包含，类的成员</strong></li>
</ul>
<p><strong>代码演示：</strong></p>
<p>在 <code>hello.jsp</code> 中书写</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    System.out.println(<span class="string">&quot;hello,jsp~&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>通过浏览器访问 <code>hello.jsp</code> 后，查看转换的 <code>hello_jsp.java</code> 文件，<strong>i 变量</strong>定义在了 <code>_jspService()</code> 方法中：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818123606231.png" width=80%></div>

<p>在 <code>hello.jsp</code> 中书写</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%=<span class="string">&quot;hello&quot;</span>%&gt;</span><br><span class="line">&lt;%=i%&gt;</span><br></pre></td></tr></table></figure>

<p>通过浏览器访问 <code>hello.jsp</code> 后，查看转换的 <code>hello_jsp.java</code> 文件，该脚本的内容被放在了 <code>out.print()</code> 中，作为参数：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818123820571.png" width=50%></div>

<p>在 <code>hello.jsp</code> 中书写</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">void</span>  <span class="title function_">show</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">	<span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>通过浏览器访问 <code>hello.jsp</code> 后，查看转换的 <code>hello_jsp.java</code> 文件，<strong>该脚本的内容被放在了成员位置(被类包含)</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818123946272.png" width=80%></div>

<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>使用JSP脚本展示品牌数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818125203390.png" width=80%></div>

<p>说明：</p>
<ul>
<li>在该案例中数据<strong>不从数据库中查询，而是在 JSP 页面上写死</strong></li>
</ul>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><ul>
<li><p>Brand.java类，放在com.mxeron.pojo下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Brand</span> &#123;</span><br><span class="line">    <span class="comment">// id 主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">// 品牌名称</span></span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line">    <span class="comment">// 企业名称</span></span><br><span class="line">    <span class="keyword">private</span> String companyName;</span><br><span class="line">    <span class="comment">// 排序字段</span></span><br><span class="line">    <span class="keyword">private</span> Integer ordered;</span><br><span class="line">    <span class="comment">// 描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">// 状态：0：禁用  1：启用</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">(Integer id, String brandName, String companyName, String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">(Integer id, String brandName, String companyName, Integer ordered, String description, Integer status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">        <span class="built_in">this</span>.ordered = ordered;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrandName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBrandName</span><span class="params">(String brandName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCompanyName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompanyName</span><span class="params">(String companyName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getOrdered</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrdered</span><span class="params">(Integer ordered)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ordered = ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(Integer status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Brand&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, brandName=&#x27;&quot;</span> + brandName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, companyName=&#x27;&quot;</span> + companyName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, ordered=&quot;</span> + ordered +</span><br><span class="line">                <span class="string">&quot;, description=&#x27;&quot;</span> + description + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, status=&quot;</span> + status +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在项目的 <code>webapp</code> 中创建 <code>brand.jsp</code> </p>
</li>
<li><p><code>brand.jsp</code> 内容如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;新增&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;800&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;三只松鼠&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;三只松鼠&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">100</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;三只松鼠，好吃不上火&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;启用&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">        &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">2</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;优衣库&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;优衣库&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">10</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;优衣库，服适人生&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;禁用&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">        &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">3</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;小米&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;小米科技有限公司&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">1000</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;为发烧而生&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;启用&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>现在页面中的数据都是假数据</p>
</li>
<li><p>在 <code>brand.jsp</code> 中准备一些数据</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="comment">// 查询数据库</span></span><br><span class="line">    List&lt;Brand&gt; brands = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Brand&gt;();</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">1</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="number">100</span>,<span class="string">&quot;三只松鼠，好吃不上火&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">2</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="number">200</span>,<span class="string">&quot;优衣库，服适人生&quot;</span>,<span class="number">0</span>));</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">3</span>,<span class="string">&quot;小米&quot;</span>,<span class="string">&quot;小米科技有限公司&quot;</span>,<span class="number">1000</span>,<span class="string">&quot;为发烧而生&quot;</span>,<span class="number">1</span>));</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：这里的类是需要导包的</strong></p>
</blockquote>
</li>
<li><p>将 <code>brand.jsp</code> 页面中的 <code>table</code> 标签中的数据改为<strong>动态的</strong></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;800&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;%</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; brands.size(); i++) &#123;</span><br><span class="line">         <span class="comment">//获取集合中的 每一个 Brand 对象</span></span><br><span class="line">         <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> brands.get(i);</span><br><span class="line">     &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">        &lt;td&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;三只松鼠&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;三只松鼠&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;<span class="number">100</span>&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;三只松鼠，好吃不上火&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;启用&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>

<p>上面的for循环需要将 <code>tr</code> 标签包裹起来，这样才能实现循环的效果，代码改进为</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;800&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;%</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; brands.size(); i++) &#123;</span><br><span class="line">         <span class="comment">//获取集合中的 每一个 Brand 对象</span></span><br><span class="line">         <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> brands.get(i);</span><br><span class="line">    %&gt;</span><br><span class="line">    	 &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;三只松鼠&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;三只松鼠&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="number">100</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;三只松鼠，好吃不上火&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;启用&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">     &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">   </span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：&lt;%%&gt; 里面写的是 Java 代码，而外边写的是 HTML 标签</p>
</blockquote>
<p>上面代码中的 <code>td</code> 标签中的数据都需要是动态的，所以还需要改进</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;800&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;%</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; brands.size(); i++) &#123;</span><br><span class="line">         <span class="comment">//获取集合中的 每一个 Brand 对象</span></span><br><span class="line">         <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> brands.get(i);</span><br><span class="line">    %&gt;</span><br><span class="line">    	 &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=brand.getId()%&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=brand.getBrandName()%&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=brand.getCompanyName()%&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=brand.getOrdered()%&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=brand.getDescription()%&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;%=brand.getStatus() == <span class="number">1</span> ? <span class="string">&quot;启用&quot;</span>:<span class="string">&quot;禁用&quot;</span>%&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">     &#125;    </span><br><span class="line">    %&gt;</span><br><span class="line">   </span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="成品代码"><a href="#成品代码" class="headerlink" title="成品代码"></a>成品代码</h4><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;com.itheima.pojo.Brand&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.List&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.ArrayList&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">// 查询数据库</span></span><br><span class="line">    List&lt;Brand&gt; brands = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Brand&gt;();</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">1</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="number">100</span>,<span class="string">&quot;三只松鼠，好吃不上火&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">2</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="number">200</span>,<span class="string">&quot;优衣库，服适人生&quot;</span>,<span class="number">0</span>));</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">3</span>,<span class="string">&quot;小米&quot;</span>,<span class="string">&quot;小米科技有限公司&quot;</span>,<span class="number">1000</span>,<span class="string">&quot;为发烧而生&quot;</span>,<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;新增&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;800&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; brands.size(); i++) &#123;</span><br><span class="line">            <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> brands.get(i);</span><br><span class="line">    %&gt;</span><br><span class="line"></span><br><span class="line">    &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getId()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getBrandName()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getCompanyName()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getOrdered()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getDescription()%&gt;&lt;/td&gt;</span><br><span class="line">		&lt;td&gt;&lt;%=brand.getStatus() == <span class="number">1</span> ? <span class="string">&quot;启用&quot;</span>:<span class="string">&quot;禁用&quot;</span>%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">    &lt;%</span><br><span class="line">        &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h4><p>在浏览器地址栏输入 <code>http://localhost:8080/web-demo2/brand.jsp</code> ，页面展示效果如下</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818145450748.png" width=80%></div>

<h3 id="JSP的缺点"><a href="#JSP的缺点" class="headerlink" title="JSP的缺点"></a>JSP的缺点</h3><p>通过上面的案例，我们可以看到 JSP 的很多缺点：由于 JSP页面内，既可以定义 HTML 标签，又可以定义 Java代码，造成了以下问题：</p>
<ul>
<li><p>书写麻烦：特别是复杂的页面<br>既要写 HTML 标签，还要写 Java 代码</p>
</li>
<li><p>阅读麻烦(例如上面的动态产生表格的案例)</p>
</li>
<li><p>复杂度高：运行需要依赖于各种环境，JRE，JSP容器，JavaEE…</p>
</li>
<li><p>占内存和磁盘：JSP会自动生成.java和.class文件占磁盘，运行的是.class文件占内存</p>
</li>
<li><p>调试困难：出错后，需要找到自动生成的.java文件进行调试</p>
</li>
<li><p>不利于团队协作：前端人员不会 Java，后端人员不精 HTML</p>
<p>如果页面布局发生变化，前端工程师对静态页面进行修改，然后再交给后端工程师，由后端工程师再将该页面改为 JSP 页面</p>
</li>
</ul>
<p>由于上述的问题， JSP 已逐渐退出历史舞台，以后开发更多的是使用 HTML + Ajax 来替代。Ajax是我们后续会重点学习的技术。有个这个技术后，前端工程师负责前端页面开发，而后端工程师只负责前端代码开发。</p>
<p>对技术的发展进行简单的说明：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818150346332.png" width=80%></div>

<ol>
<li><p>第一阶段：使用 <code>servlet</code> 即实现逻辑代码编写，也对页面进行拼接。这种模式我们之前也接触过</p>
</li>
<li><p>第二阶段：随着技术的发展，出现了 <code>JSP</code> ，人们发现 <code>JSP</code> 使用起来比 <code>Servlet</code> 方便很多，但是还是要在 <code>JSP</code> 中嵌套 <code>Java</code> 代码，也不利于后期的维护</p>
</li>
<li><p>第三阶段：使用 <code>Servlet</code> 进行逻辑代码开发，而使用 <code>JSP</code> 进行数据展示</p>
</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818151232955.png" width=80%></div>

<ol start="4">
<li>第四阶段：使用 <code>servlet</code> 进行后端逻辑代码开发，而使用 <code>HTML</code> 进行数据展示。而这里面就存在问题，<code>HTML</code> 是静态页面，怎么进行动态数据展示呢？这就是 <code>ajax</code> 的作用了。</li>
</ol>
<p>那既然 JSP 已经逐渐的退出历史舞台，那我们为什么还要学习 <code>JSP</code> 呢？原因有两点：</p>
<ul>
<li>一些公司可能有些老项目还在用 <code>JSP</code> ，所以要求我们必须动 <code>JSP</code></li>
<li><strong>我们如果不经历这些复杂的过程，就不能体现后面阶段开发的简单</strong></li>
</ul>
<p>接下来我们来学习第三阶段，使用 <code>EL表达式</code> 和 <code>JSTL</code> 标签库替换 <code>JSP</code> 中的 <code>Java</code> 代码。</p>
<h3 id="EL-表达式"><a href="#EL-表达式" class="headerlink" title="EL 表达式"></a>EL 表达式</h3><p>EL（全称Expression Language ）表达式语言，用于简化 JSP 页面内的 Java 代码。</p>
<p>EL 表达式的主要作用是 <strong>获取数据</strong>，其实就是<strong>从域对象中获取数据，然后将数据展示在页面上。</strong></p>
<p>而 EL 表达式的语法也比较简单，<code>$&#123;expression&#125;</code> 。例如：<code>$&#123;brands&#125;</code> 就是获取域中存储的 key 为 brands 的数据。</p>
<h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><ul>
<li><p>定义servlet，在 servlet 中封装一些数据并存储到 request 域对象中并转发到 <code>eLDemo.jsp</code> 页面。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 准备数据</span></span><br><span class="line">        List&lt;Brand&gt; brands = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Brand&gt;();</span><br><span class="line">        brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">1</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="number">100</span>,<span class="string">&quot;三只松鼠，好吃不上火&quot;</span>,<span class="number">1</span>));</span><br><span class="line">        brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">2</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="number">200</span>,<span class="string">&quot;优衣库，服适人生&quot;</span>,<span class="number">0</span>));</span><br><span class="line">        brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">3</span>,<span class="string">&quot;小米&quot;</span>,<span class="string">&quot;小米科技有限公司&quot;</span>,<span class="number">1000</span>,<span class="string">&quot;为发烧而生&quot;</span>,<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 存储到request域中</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;brands&quot;</span>,brands);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 转发到 el-demo.jsp</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/eLDemo.jsp&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：</strong> 此处需要用转发，因为<strong>转发才可以使用 request 对象作为域对象进行数据共享</strong></p>
</blockquote>
</li>
<li><p>在 <code>eLDemo.jsp</code> 中通过 EL表达式 获取数据</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    $&#123;brands&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在浏览器的地址栏输入 <code>http://localhost:8080/web-demo2/demo1</code> ，页面效果如下：</p>
</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818152536484.png" width=80%></div>

<blockquote>
<p><strong>检查一下web.xml中的版本是多少，如果是2.3及以下的版本，需要在jsp页面中增加这个指令&lt;%@ page isELIgnored&#x3D;”false”%&gt;才可以识别EL表达式！！！</strong></p>
</blockquote>
<h3 id="※JavaWeb中的域对象"><a href="#※JavaWeb中的域对象" class="headerlink" title="※JavaWeb中的域对象"></a>※JavaWeb中的域对象</h3><p>JavaWeb中有<strong>四大域对象</strong>，分别是：</p>
<ul>
<li>page：当前页面有效</li>
<li>request：当前请求有效</li>
<li>session：当前会话有效</li>
<li>application：当前应用有效</li>
</ul>
<blockquote>
<p>对于它们的作用范围和含义，可以自行网上搜索</p>
</blockquote>
<p><strong>EL 表达式获取数据，会依次从这4个域中寻找，从page到application依次寻找，直到找到为止，</strong> 而这四个域对象的作用范围如下图所示：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818152857407.png" width=40%></div>

<p>例如： ${brands}，el 表达式获取数据，会先从page域对象中获取数据，如果没有再到 requet 域对象中获取数据，如果再没有再到 session 域对象中获取，如果还没有才会到 application 中获取数据。</p>
<h3 id="JSTL标签"><a href="#JSTL标签" class="headerlink" title="JSTL标签"></a>JSTL标签</h3><p>JSP标准标签库(Jsp Standarded Tag Library) ，使用标签取代JSP页面上的Java代码。如下代码就是JSTL标签：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;flag == 1&#125;&quot;</span>&gt;</span><br><span class="line">    男</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;flag == 2&#125;&quot;</span>&gt;</span><br><span class="line">    女</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br></pre></td></tr></table></figure>

<p>上面代码看起来是不是比 JSP 中嵌套 Java 代码看起来舒服好了。而且前端工程师对标签是特别敏感的，他们看到这段代码是能看懂的。</p>
<p>JSTL 提供了很多标签，如下图：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818153646575.png" width=100%></div>

<p>我们只对两个最常用的标签进行讲解，<code>&lt;c:forEach&gt;</code> 标签和 <code>&lt;c:if&gt;</code> 标签。</p>
<p><strong>JSTL 使用也是比较简单的，分为如下步骤：</strong></p>
<ul>
<li><p>导入坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在JSP页面上引入JSTL标签库</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt; </span><br></pre></td></tr></table></figure>
</li>
<li><p>使用标签</p>
</li>
</ul>
<h4 id="if-标签"><a href="#if-标签" class="headerlink" title="if 标签"></a>if 标签</h4><p><code>&lt;c:if&gt;</code>：相当于 if 判断</p>
<ul>
<li>属性：test，用于定义条件表达式</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;flag == 1&#125;&quot;</span>&gt;</span><br><span class="line">    男</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;flag == 2&#125;&quot;</span>&gt;</span><br><span class="line">    女</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>代码演示：</strong></p>
<ul>
<li><p>定义一个 <code>servlet</code> ，在该 <code>servlet</code> 中向 request 域对象中添加键是 <code>status</code> ，值为 <code>1</code> 的数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 存储数据到request域中</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;status&quot;</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 转发到 jstl-if.jsp</span></span><br><span class="line">        数据request.getRequestDispatcher(<span class="string">&quot;/jstl-if.jsp&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义 <code>jstl-if.jsp</code> 页面，在该页面使用 <code>&lt;c:if&gt;</code> 标签，使用之前的EL表达式来获取request域中的值</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;%--</span><br><span class="line">        c:<span class="keyword">if</span>：来完成逻辑判断，替换java的 <span class="keyword">if</span> <span class="keyword">else</span></span><br><span class="line">    --%&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;status==1&#125;&quot;</span>&gt;</span><br><span class="line">        启用</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;status==0&#125;&quot;</span>&gt;</span><br><span class="line">        禁用</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：在该页面已经引入 JSTL核心标签库<br><code>&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</code></p>
</blockquote>
</li>
</ul>
<h4 id="forEach-标签"><a href="#forEach-标签" class="headerlink" title="forEach 标签"></a>forEach 标签</h4><p><code>&lt;c:forEach&gt;</code>：相当于 for 循环，java中有增强for循环和普通for循环，JSTL 中的 <code>&lt;c:forEach&gt;</code> 也有两种用法</p>
<h5 id="用法一"><a href="#用法一" class="headerlink" title="用法一"></a>用法一</h5><p>类似于 Java 中的增强for循环。涉及到的 <code>&lt;c:forEach&gt;</code> 中的属性如下</p>
<ul>
<li><p>items：被遍历的容器</p>
</li>
<li><p>var：遍历产生的临时变量</p>
</li>
<li><p>varStatus：遍历状态对象</p>
</li>
</ul>
<p>如下代码，是从域对象中获取名为 brands 数据，该数据是一个集合；遍历遍历，并给该集合中的每一个元素起名为 <code>brand</code>，是 Brand对象。在循环里面使用 EL表达式获取每一个Brand对象的属性值</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;brands&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;brand&quot;</span>&gt;</span><br><span class="line">    &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">        &lt;td&gt;$&#123;brand.id&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;brand.brandName&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;brand.companyName&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;brand.description&#125;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p><strong>代码演示：</strong></p>
<ul>
<li><p><code>servlet</code> 还是使用之前的名为 <code>ServletDemo1</code> 。</p>
</li>
<li><p>定义名为 <code>jstl-foreach.jsp</code> 页面，内容如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;新增&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;800&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;brands&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;brand&quot;</span> varStatus=<span class="string">&quot;status&quot;</span>&gt;</span><br><span class="line">        &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">            &lt;%--&lt;td&gt;$&#123;brand.id&#125;&lt;/td&gt;--%&gt;</span><br><span class="line">            &lt;td&gt;$&#123;status.count&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.brandName&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.companyName&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.ordered&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.description&#125;&lt;/td&gt;</span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 1&#125;&quot;</span>&gt;</span><br><span class="line">                &lt;td&gt;启用&lt;/td&gt;</span><br><span class="line">            &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status != 1&#125;&quot;</span>&gt;</span><br><span class="line">                &lt;td&gt;禁用&lt;/td&gt;</span><br><span class="line">            &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="用法二"><a href="#用法二" class="headerlink" title="用法二"></a>用法二</h5><p>类似于 Java 中的普通for循环。涉及到的 <code>&lt;c:forEach&gt;</code> 中的属性如下</p>
<ul>
<li><p>begin：开始数</p>
</li>
<li><p>end：结束数</p>
</li>
<li><p>step：步长</p>
</li>
</ul>
<p>实例代码：</p>
<p>从0循环到10，变量名是 <code>i</code> ，每次自增1</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;c:forEach begin=<span class="string">&quot;0&quot;</span> end=<span class="string">&quot;10&quot;</span> step=<span class="string">&quot;1&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;i&quot;</span>&gt;</span><br><span class="line">    $&#123;i&#125;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<h3 id="MVC模式和三层架构"><a href="#MVC模式和三层架构" class="headerlink" title="MVC模式和三层架构"></a>MVC模式和三层架构</h3><p>MVC模式和三层架构是一些理论的知识，将来使用它们进行代码开发会让我们代码维护性和扩展性更好。</p>
<h4 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h4><p>MVC 是一种<strong>分层开发的模式</strong>，其中：</p>
<ul>
<li><p>M：Model，业务模型，处理业务</p>
</li>
<li><p>V：View，视图，界面展示</p>
</li>
<li><p>C：Controller，控制器，处理请求，调用模型和视图</p>
</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818163348642.png" width=80%></div>

<p>控制器（serlvlet）用来接收浏览器发送过来的请求，控制器调用模型（JavaBean）来获取数据，比如从数据库查询数据；控制器获取到数据后再交由视图（JSP）进行数据展示。</p>
<h4 id="JavaBean"><a href="#JavaBean" class="headerlink" title="JavaBean"></a>JavaBean</h4><p><strong>JavaBean定义：</strong></p>
<p>用户可以使用JavaBean将功能、处理、值、数据库访问和其他任何可以用Java代码创造的对象进行打包，<strong>并且其他的开发者可以通过内部的JSP页面、Servlet、其他JavaBean、applet程序或者应用来使用这些对象，是一种可重用的Java组件</strong>。</p>
<p>一个Java类满足以下2点 ，就可以称为JavaBean：</p>
<ul>
<li>public 修饰的类，public 无参构造</li>
<li>所有属性(如果有) 都是private，并且提供set&#x2F;get (如果boolean 则get 可以替换成is)</li>
</ul>
<p>1、所有属性为private<br>2、提供默认构造方法<br>3、提供getter和setter<br>4、实现serializable接口</p>
<p><strong>MVC 好处：</strong></p>
<ul>
<li><p>职责单一，互不影响。每个角色做它自己的事，各司其职。</p>
</li>
<li><p>有利于分工协作。</p>
</li>
<li><p>有利于组件重用</p>
</li>
</ul>
<h4 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h4><blockquote>
<p>MVC是一种开发模式，是一种宏观的概念，三层架构是一种软件涉及的架构，能够落地实施 </p>
</blockquote>
<p>三层架构是将我们的<strong>项目</strong>分成了三个层面，分别是 <code>表现层</code>、<code>业务逻辑层</code>、<code>数据访问层</code>。</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818164301154.png" width=80%></div>

<p><strong>各层含义：</strong></p>
<ul>
<li>数据访问层：对数据库的CRUD基本操作</li>
<li>业务逻辑层：对业务逻辑进行封装，组合数据访问层层中基本功能，形成复杂的业务逻辑功能。例如 <code>注册业务功能</code> ，我们会先调用 <code>数据访问层</code> 的 <code>selectByName()</code> 方法判断该用户名是否存在，如果不存在再调用 <code>数据访问层</code> 的 <code>insert()</code> 方法进行数据的添加操作</li>
<li>表现层：接收请求，封装数据，调用业务逻辑层，响应数据</li>
</ul>
<p>而整个流程是，浏览器发送请求，表现层的Servlet接收请求并调用业务逻辑层的方法进行业务逻辑处理，而业务逻辑层方法调用数据访问层方法进行数据的操作，依次返回到serlvet，然后servlet将数据交由 JSP 进行展示。</p>
<p><strong>三层架构的每一层都有特有的包名称：</strong></p>
<ul>
<li>表现层： <code>com.xxx.controller</code> 或者 <code>com.xxx.web</code></li>
<li>业务逻辑层：<code>com.xxx.service</code></li>
<li>数据访问层：<code>com.xxx.dao</code> 或者 <code>com.xxx.mapper</code></li>
</ul>
<p><strong>后期我们还会学习一些框架，不同的框架是对不同层进行封装的，SpringMVC、Spring、MyBatis统称：SSM</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818165439826.png" width=80%></div>

<h4 id="MVC-和-三层架构的区别和联系"><a href="#MVC-和-三层架构的区别和联系" class="headerlink" title="MVC 和 三层架构的区别和联系"></a>MVC 和 三层架构的区别和联系</h4><p>通过 MVC 和 三层架构 的学习，有些同学肯定混淆了。那他们有什么区别和联系？</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818165808589.png" width=80%></div>

<p>如上图上半部分是 MVC 模式，上图下半部分是三层架构。 <code>MVC 模式</code> 中的 C（控制器）和 V（视图）就是 <code>三层架构</code> 中的表现层，而 <code>MVC 模式</code> 中的 M（模型）就是 <code>三层架构</code> 中的 业务逻辑层 和 数据访问层。</p>
<p>可以将 <code>MVC 模式</code> 理解成是一个大的概念，而 <code>三层架构</code> 是对 <code>MVC 模式</code> 实现架构的思想。 那么我们以后按照要求将不同层的代码写在不同的包下，每一层里功能职责做到单一，将来如果将表现层的技术换掉，而业务逻辑层和数据访问层的代码不需要发生变化。</p>
<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><p><strong>需求：完成品牌数据的增删改查操作</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818171702401.png" width=80%></div>

<p>这个功能我们之前一直在做，而这个案例是将今天学习的所有的内容（包含 MVC模式 和 三层架构）进行应用，并将整个流程贯穿起来。</p>
<h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><p>环境准备工作，我们分以下步骤实现：</p>
<ul>
<li><p>创建新的模块 brand_demo，引入坐标</p>
</li>
<li><p>创建三层架构的包结构</p>
</li>
<li><p>数据库表 tb_brand</p>
</li>
<li><p>实体类 Brand</p>
</li>
<li><p>MyBatis 基础环境</p>
<ul>
<li><p>Mybatis-config.xml</p>
</li>
<li><p>BrandMapper.xml</p>
</li>
<li><p>BrandMapper接口</p>
</li>
</ul>
</li>
</ul>
<h4 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h4><p>创建新的模块 brand_demo，引入坐标。我们只要分析出要用到哪儿些技术，那么需要哪儿些坐标也就明确了</p>
<ul>
<li>需要操作数据库。mysql的驱动包</li>
<li>要使用mybatis框架。mybaits的依赖包</li>
<li>web项目需要用到servlet和jsp。servlet和jsp的依赖包</li>
<li>需要使用 jstl 进行数据展示。jstl的依赖包</li>
</ul>
<p><code>pom.xml</code> 内容如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>brand-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.34<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--servlet--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jsp--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jstl--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建包"><a href="#创建包" class="headerlink" title="创建包"></a>创建包</h4><p>创建不同的包结构，用来存储不同的类。包结构如下</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818173155335.png" width=40%></div>

<h4 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除tb_brand表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> tb_brand;</span><br><span class="line"><span class="comment">-- 创建tb_brand表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_brand</span><br><span class="line">(</span><br><span class="line">    <span class="comment">-- id 主键</span></span><br><span class="line">    id           <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">    <span class="comment">-- 品牌名称</span></span><br><span class="line">    brand_name   <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="comment">-- 企业名称</span></span><br><span class="line">    company_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="comment">-- 排序字段</span></span><br><span class="line">    ordered      <span class="type">int</span>,</span><br><span class="line">    <span class="comment">-- 描述信息</span></span><br><span class="line">    description  <span class="type">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="comment">-- 状态：0：禁用  1：启用</span></span><br><span class="line">    status       <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 添加数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_brand (brand_name, company_name, ordered, description, status)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;三只松鼠&#x27;</span>, <span class="string">&#x27;三只松鼠股份有限公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;好吃不上火&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;华为致力于把数字世界带入每个人、每个家庭、每个组织，构建万物互联的智能世界&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h4 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h4><p>在 <code>pojo</code> 包下创建名为 <code>Brand</code> 的类。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Brand</span> &#123;</span><br><span class="line">    <span class="comment">// id 主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">// 品牌名称</span></span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line">    <span class="comment">// 企业名称</span></span><br><span class="line">    <span class="keyword">private</span> String companyName;</span><br><span class="line">    <span class="comment">// 排序字段</span></span><br><span class="line">    <span class="keyword">private</span> Integer ordered;</span><br><span class="line">    <span class="comment">// 描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">// 状态：0：禁用  1：启用</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">(Integer id, String brandName, String companyName, String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">(Integer id, String brandName, String companyName, Integer ordered, String description, Integer status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">        <span class="built_in">this</span>.ordered = ordered;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrandName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBrandName</span><span class="params">(String brandName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCompanyName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompanyName</span><span class="params">(String companyName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getOrdered</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrdered</span><span class="params">(Integer ordered)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ordered = ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(Integer status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Brand&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, brandName=&#x27;&quot;</span> + brandName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, companyName=&#x27;&quot;</span> + companyName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, ordered=&quot;</span> + ordered +</span><br><span class="line">                <span class="string">&quot;, description=&#x27;&quot;</span> + description + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, status=&quot;</span> + status +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="准备mybatis环境"><a href="#准备mybatis环境" class="headerlink" title="准备mybatis环境"></a>准备mybatis环境</h4><p>定义核心配置文件 <code>Mybatis-config.xml</code> ，并将该文件放置在 <code>resources</code> 下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--起别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itheima.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///db1?useSSL=false<span class="symbol">&amp;amp;</span>useServerPrepStmts=true&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1234&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--扫描mapper--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itheima.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 <code>resources</code> 下创建放置映射配置文件的目录结构 <code>com/xxx/mapper</code>，并在该目录下创建映射配置文件 <code>BrandMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.BrandMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818174441917.png" width=80%></div>

<p>当我们点击 <code>index.html</code> 页面中的 <code>查询所有</code> 这个超链接时，就能查询到上图右半部分的数据。</p>
<p>对于上述的功能，点击 <code>查询所有</code> 超链接是需要先请后端的 <code>servlet</code> ，由 <code>servlet</code> 跳转到对应的页面进行数据的动态展示。而整个流程如下图：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818174800783.png" width=80%></div>

<h4 id="编写BrandMapper-Dao层"><a href="#编写BrandMapper-Dao层" class="headerlink" title="编写BrandMapper(Dao层)"></a>编写BrandMapper(Dao层)</h4><p>在 <code>mapper</code> 包下创建创建 <code>BrandMapper</code> 接口，在接口中定义 <code>selectAll()</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 查询所有</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tb_brand&quot;)</span></span><br><span class="line">List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<h4 id="编写工具类"><a href="#编写工具类" class="headerlink" title="编写工具类"></a>编写工具类</h4><p>在 <code>com.xxx</code> 包下创建 <code>utils</code> 包，并在该包下创建名为 <code>SqlSessionFactoryUtils</code> 工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionFactoryUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//静态代码块会随着类的加载而自动执行，且只执行一次</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSessionFactory <span class="title function_">getSqlSessionFactory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写BrandService-Service层"><a href="#编写BrandService-Service层" class="headerlink" title="编写BrandService(Service层)"></a>编写BrandService(Service层)</h4><p>在 <code>service</code> 包下创建 <code>BrandService</code> 类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandService</span> &#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//调用BrandMapper.selectAll()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        List&lt;Brand&gt; brands = mapper.selectAll();</span><br><span class="line"></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> brands;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写Servlet-Web层"><a href="#编写Servlet-Web层" class="headerlink" title="编写Servlet(Web层)"></a>编写Servlet(Web层)</h4><blockquote>
<p>注意：Servlet和jsp动态页面都是Web层</p>
</blockquote>
<p>在 <code>web</code> 包下创建名为 <code>SelectAllServlet</code> 的 <code>servlet</code>，该 <code>servlet</code> 的逻辑如下：</p>
<ul>
<li>调用 <code>BrandService</code> 的 <code>selectAll()</code> 方法进行业务逻辑处理，并接收返回的结果</li>
<li>将上一步返回的结果存储到 <code>request</code> 域对象中</li>
<li>跳转到 <code>brand.jsp</code> 页面进行数据的展示</li>
</ul>
<p>具体的代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/selectAllServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectAllServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">BrandService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 调用BrandService完成查询</span></span><br><span class="line">        List&lt;Brand&gt; brands = service.selectAll();</span><br><span class="line">        <span class="comment">//2. 存入request域中</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;brands&quot;</span>,brands);</span><br><span class="line">        <span class="comment">//3. 转发到brand.jsp</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/brand.jsp&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写brand-jsp页面-Web层"><a href="#编写brand-jsp页面-Web层" class="headerlink" title="编写brand.jsp页面(Web层)"></a>编写brand.jsp页面(Web层)</h4><p><code>brand.jsp</code> 页面在表格中使用 <code>JSTL</code> 和 <code>EL表达式</code> 从request域对象中获取名为 <code>brands</code> 的集合数据并展示出来。页面内容如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;80%&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;brands&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;brand&quot;</span> varStatus=<span class="string">&quot;status&quot;</span>&gt;</span><br><span class="line">        &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">            &lt;%--&lt;td&gt;$&#123;brand.id&#125;&lt;/td&gt;--%&gt;</span><br><span class="line">            &lt;td&gt;$&#123;status.count&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.brandName&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.companyName&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.ordered&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;brand.description&#125;&lt;/td&gt;</span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 1&#125;&quot;</span>&gt;</span><br><span class="line">                &lt;td&gt;启用&lt;/td&gt;</span><br><span class="line">            &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status != 1&#125;&quot;</span>&gt;</span><br><span class="line">                &lt;td&gt;禁用&lt;/td&gt;</span><br><span class="line">            &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;/brand-demo/selectByIdServlet?id=$&#123;brand.id&#125;&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>启动服务器，并在浏览器输入 <code>http://localhost:8080/brand-demo/index.html</code>，看到如下 <code>查询所有</code> 的超链接，点击该链接就可以查询出所有的品牌数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818182952394.png" width=80%></div>

<p>为什么出现这个问题呢？是因为查询到的字段名和实体类对象的属性名没有一一对应。</p>
<p>看到这大家一定会解决了，就是在映射配置文件中使用 <code>resultMap</code> 标签**定义映射关系(属于MyBatis中的内容)**。映射配置文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.BrandMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;brandResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;brand_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;brandName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;company_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;companyName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>并且在 <code>BrandMapper</code> 接口中的 <code>selectAll()</code> 上使用 <code>@ResuleMap</code> 注解指定使用该映射</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 查询所有</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tb_brand&quot;)</span></span><br><span class="line"><span class="meta">@ResultMap(&quot;brandResultMap&quot;)</span></span><br><span class="line">List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>重启服务器，再次访问就能看到我们想要的数据了</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819190221889.png" width=80%></div>

<h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819192049571.png" width=80%></div>

<p>上图是做 添加 功能流程。点击 <code>新增</code> 按钮后，会先跳转到 <code>addBrand.jsp</code> 新增页面，在该页面输入要添加的数据，输入完毕后点击 <code>提交</code> 按钮，需要将数据提交到后端，而后端进行数据添加操作，并重新将所有的数据查询出来。整个流程如下：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819192737982.png" width=80%></div>

<p>接下来我们根据流程来实现功能：</p>
<h4 id="编写BrandMapper方法"><a href="#编写BrandMapper方法" class="headerlink" title="编写BrandMapper方法"></a>编写BrandMapper方法</h4><p>在 <code>BrandMapper</code> 接口，在接口中定义 <code>add(Brand brand)</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into tb_brand values(null,#&#123;brandName&#125;,#&#123;companyName&#125;,#&#123;ordered&#125;,#&#123;description&#125;,#&#123;status&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Brand brand)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="编写BrandService方法"><a href="#编写BrandService方法" class="headerlink" title="编写BrandService方法"></a>编写BrandService方法</h4><p>在 <code>BrandService</code> 类中定义添加品牌数据方法 <code>add(Brand brand)</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 添加</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Brand brand)</span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">      <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">      <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">      <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//4. 调用方法</span></span><br><span class="line">      mapper.add(brand);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//提交事务</span></span><br><span class="line">      sqlSession.commit();</span><br><span class="line">      <span class="comment">//释放资源</span></span><br><span class="line">      sqlSession.close();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="改进brand-jsp页面"><a href="#改进brand-jsp页面" class="headerlink" title="改进brand.jsp页面"></a>改进brand.jsp页面</h4><p>我们需要在该页面表格的上面添加 <code>新增</code> 按钮</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;新增&quot;</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>并给该按钮绑定单击事件，当点击了该按钮需要跳转到 <code>brand.jsp</code> 添加品牌数据的页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;add&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        location.<span class="property">href</span> = <span class="string">&quot;/brand-demo/addBrand.jsp&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：该 <code>script</code> 标签建议放在 <code>body</code> 结束标签前面。</p>
</blockquote>
<h4 id="编写addBrand-jsp页面"><a href="#编写addBrand-jsp页面" class="headerlink" title="编写addBrand.jsp页面"></a>编写addBrand.jsp页面</h4><p> <code>addBrand.jsp</code> 动态页面：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;添加品牌&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;添加品牌&lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/brand-demo/addServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    品牌名称：&lt;input name=<span class="string">&quot;brandName&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    企业名称：&lt;input name=<span class="string">&quot;companyName&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    排序：&lt;input name=<span class="string">&quot;ordered&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    描述信息：&lt;textarea rows=<span class="string">&quot;5&quot;</span> cols=<span class="string">&quot;20&quot;</span> name=<span class="string">&quot;description&quot;</span>&gt;&lt;/textarea&gt;&lt;br&gt;</span><br><span class="line">    状态：</span><br><span class="line">    &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;0&quot;</span>&gt;禁用</span><br><span class="line">    &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;1&quot;</span>&gt;启用&lt;br&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="编写servlet"><a href="#编写servlet" class="headerlink" title="编写servlet"></a>编写servlet</h4><p>在 <code>web</code> 包下创建 <code>AddServlet</code> 的 <code>servlet</code>，该 <code>servlet</code> 的逻辑如下:</p>
<ul>
<li>设置处理post请求乱码的字符集</li>
<li>接收客户端提交的数据</li>
<li>将接收到的数据封装到 <code>Brand</code> 对象中</li>
<li>调用 <code>BrandService</code> 的<code>add()</code> 方法进行添加的业务逻辑处理</li>
<li>跳转到 <code>selectAllServlet</code> 资源重新查询数据</li>
</ul>
<p>具体的代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/addServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BrandService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandService</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理POST请求的乱码问题</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 接收表单提交的数据，封装为一个Brand对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">brandName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;brandName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">companyName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;companyName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ordered</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;ordered&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;description&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;status&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装为一个Brand对象</span></span><br><span class="line">        <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Brand</span>();</span><br><span class="line">        brand.setBrandName(brandName);</span><br><span class="line">        brand.setCompanyName(companyName);</span><br><span class="line">        brand.setOrdered(Integer.parseInt(ordered));</span><br><span class="line">        brand.setDescription(description);</span><br><span class="line">        brand.setStatus(Integer.parseInt(status));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service 完成添加</span></span><br><span class="line">        service.add(brand);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 转发到查询所有Servlet</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/selectAllServlet&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><p> 点击 <code>brand.jsp</code> 页面的 <code>新增</code> 按钮，会跳转到 <code>addBrand.jsp</code>页面</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819220701121.png" width=80%></div>

<p>点击 <code>提交</code> 按钮，就能看到如下页面，里面就包含我们刚添加的数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819220738074.png" width=80%></div>

<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819223202473.png" width=80%></div>

<p>点击每条数据后面的 <code>编辑</code> 按钮会跳转到修改页面，如下图：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819223314230.png" width=80%></div>

<p>在该修改页面我们可以看到将 <code>编辑</code> 按钮所在行的数据<strong>回显到表单</strong>，然后需要修改那个数据在表单中进行修改，然后点击 <code>提交</code> 的按钮将数据提交到后端，后端再将数据存储到数据库中。</p>
<p>从上面的例子我们知道 <code>修改</code> 功能需要从两方面进行实现，数据回显和修改操作。</p>
<h4 id="回显数据"><a href="#回显数据" class="headerlink" title="回显数据"></a>回显数据</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819223830713.png" width=80%></div>

<p>上图就是回显数据的效果。要实现这个效果，那当点击 <code>修改</code> 按钮时不能直接跳转到 <code>update.jsp</code> 页面，而是需要先带着当前行数据的 <code>id</code> 请求后端程序，后端程序根据 <code>id</code> 查询数据，将数据存储到域对象中跳转到 <code>update.jsp</code> 页面进行数据展示。整体流程如下</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819224243778.png" width=80%></div>

<h5 id="编写BrandMapper方法-1"><a href="#编写BrandMapper方法-1" class="headerlink" title="编写BrandMapper方法"></a>编写BrandMapper方法</h5><p>在 <code>BrandMapper</code> 接口，在接口中定义 <code>selectById(int id)</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据id查询</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select(&quot;select * from tb_brand where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ResultMap(&quot;brandResultMap&quot;)</span></span><br><span class="line">   Brand <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="编写BrandService方法-1"><a href="#编写BrandService方法-1" class="headerlink" title="编写BrandService方法"></a>编写BrandService方法</h5><p>在 <code>BrandService</code> 类中定义根据id查询数据方法 <code>selectById(int id)</code> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Brand <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">    <span class="comment">//调用BrandMapper.selectAll()</span></span><br><span class="line">    <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">    <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">    <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line">    <span class="comment">//4. 调用方法</span></span><br><span class="line">    <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> mapper.selectById(id);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">    <span class="keyword">return</span> brand;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="编写servlet-1"><a href="#编写servlet-1" class="headerlink" title="编写servlet"></a>编写servlet</h5><p>在 <code>web</code> 包下创建 <code>SelectByIdServlet</code> 的 <code>servlet</code>，该 <code>servlet</code> 的逻辑如下:</p>
<ul>
<li>获取请求数据 <code>id</code></li>
<li>调用 <code>BrandService</code> 的 <code>selectById()</code> 方法进行数据查询的业务逻辑</li>
<li>将查询到的数据存储到 request 域对象中</li>
<li>跳转到 <code>update.jsp</code> 页面进行数据真实</li>
</ul>
<p>具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/selectByIdServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectByIdServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">BrandService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 接收id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 调用service查询</span></span><br><span class="line">        <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> service.selectById(Integer.parseInt(id));</span><br><span class="line">        <span class="comment">//3. 存储到request中</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;brand&quot;</span>,brand);</span><br><span class="line">        <span class="comment">//4. 转发到update.jsp</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/update.jsp&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="编写update-jsp页面"><a href="#编写update-jsp页面" class="headerlink" title="编写update.jsp页面"></a>编写update.jsp页面</h5><p>拷贝 <code>addBrand.jsp</code> 页面，改名为 <code>update.jsp</code> 并做出以下修改：</p>
<ul>
<li><p><code>title</code> 标签内容改为 <code>修改品牌</code></p>
</li>
<li><p><code>form</code> 标签的 <code>action</code> 属性值改为 <code>/brand-demo/updateServlet</code></p>
</li>
<li><p><code>input</code> 标签要进行数据回显，需要设置 <code>value</code> 属性</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">品牌名称：&lt;input name=<span class="string">&quot;brandName&quot;</span> value=<span class="string">&quot;$&#123;brand.brandName&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">企业名称：&lt;input name=<span class="string">&quot;companyName&quot;</span> value=<span class="string">&quot;$&#123;brand.companyName&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">排序：&lt;input name=<span class="string">&quot;ordered&quot;</span> value=<span class="string">&quot;$&#123;brand.ordered&#125;&quot;</span>&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>textarea</code> 标签要进行数据回显，需要在标签体中使用 <code>EL表达式</code></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">描述信息：&lt;textarea rows=<span class="string">&quot;5&quot;</span> cols=<span class="string">&quot;20&quot;</span> name=<span class="string">&quot;description&quot;</span>&gt;$&#123;brand.description&#125; &lt;/textarea&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>单选框使用 <code>if</code> 标签需要判断 <code>brand.status</code> 的值是 1 还是 0 在指定的单选框上使用 <code>checked</code> 属性，表示被选中状态</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">状态：</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 0&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;0&quot;</span> checked&gt;禁用</span><br><span class="line">    &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;1&quot;</span>&gt;启用&lt;br&gt;</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 1&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;0&quot;</span> &gt;禁用</span><br><span class="line">    &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;1&quot;</span> checked&gt;启用&lt;br&gt;</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>综上，<code>update.jsp</code> 代码如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;修改品牌&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;修改品牌&lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/brand-demo/updateServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    品牌名称：&lt;input name=<span class="string">&quot;brandName&quot;</span> value=<span class="string">&quot;$&#123;brand.brandName&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    企业名称：&lt;input name=<span class="string">&quot;companyName&quot;</span> value=<span class="string">&quot;$&#123;brand.companyName&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    排序：&lt;input name=<span class="string">&quot;ordered&quot;</span> value=<span class="string">&quot;$&#123;brand.ordered&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    描述信息：&lt;textarea rows=<span class="string">&quot;5&quot;</span> cols=<span class="string">&quot;20&quot;</span> name=<span class="string">&quot;description&quot;</span>&gt;$&#123;brand.description&#125; &lt;/textarea&gt;&lt;br&gt;</span><br><span class="line">    状态：</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 0&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;0&quot;</span> checked&gt;禁用</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;1&quot;</span>&gt;启用&lt;br&gt;</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 1&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;0&quot;</span> &gt;禁用</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;1&quot;</span> checked&gt;启用&lt;br&gt;</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h4><p>做完回显数据后，接下来我们要做修改数据了，而下图是修改数据的效果：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819225948187.png" width=80%></div>

<p>在修改页面进行数据修改，点击 <code>提交</code> 按钮，会将数据提交到后端程序，后端程序会对表中的数据进行修改操作，然后重新进行数据的查询操作。整体流程如下：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210819230242938.png" width=80%></div>

<h5 id="编写BrandMapper方法-2"><a href="#编写BrandMapper方法-2" class="headerlink" title="编写BrandMapper方法"></a>编写BrandMapper方法</h5><p>在 <code>BrandMapper</code> 接口，在接口中定义 <code>update(Brand brand)</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 修改</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Update(&quot;update tb_brand set brand_name = #&#123;brandName&#125;,company_name = #&#123;companyName&#125;,ordered = #&#123;ordered&#125;,description = #&#123;description&#125;,status = #&#123;status&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Brand brand)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="编写BrandService方法-2"><a href="#编写BrandService方法-2" class="headerlink" title="编写BrandService方法"></a>编写BrandService方法</h5><p>在 <code>BrandService</code> 类中定义根据id查询数据方法 <code>update(Brand brand)</code> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 修改</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Brand brand)</span>&#123;</span><br><span class="line">    <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">    <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">    <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line">    <span class="comment">//4. 调用方法</span></span><br><span class="line">    mapper.update(brand);</span><br><span class="line">    <span class="comment">//提交事务</span></span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    <span class="comment">//释放资源</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="编写servlet-2"><a href="#编写servlet-2" class="headerlink" title="编写servlet"></a>编写servlet</h5><p>在 <code>web</code> 包下创建 <code>AddServlet</code> 的 <code>servlet</code>，该 <code>servlet</code> 的逻辑如下:</p>
<ul>
<li>设置处理post请求乱码的字符集</li>
<li>接收客户端提交的数据</li>
<li>将接收到的数据封装到 <code>Brand</code> 对象中</li>
<li>调用 <code>BrandService</code> 的<code>update()</code> 方法进行添加的业务逻辑处理</li>
<li>跳转到 <code>selectAllServlet</code> 资源重新查询数据</li>
</ul>
<p>具体的代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/updateServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BrandService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理POST请求的乱码问题</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">//1. 接收表单提交的数据，封装为一个Brand对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">brandName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;brandName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">companyName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;companyName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ordered</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;ordered&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;description&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;status&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装为一个Brand对象</span></span><br><span class="line">        <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Brand</span>();</span><br><span class="line">        brand.setId(Integer.parseInt(id));</span><br><span class="line">        brand.setBrandName(brandName);</span><br><span class="line">        brand.setCompanyName(companyName);</span><br><span class="line">        brand.setOrdered(Integer.parseInt(ordered));</span><br><span class="line">        brand.setDescription(description);</span><br><span class="line">        brand.setStatus(Integer.parseInt(status));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service 完成修改</span></span><br><span class="line">        service.update(brand);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 转发到查询所有Servlet</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/selectAllServlet&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>存在问题：update.jsp 页面提交数据时是没有携带主键数据的，而后台修改数据需要根据主键进行修改。</strong></p>
<p>针对这个问题，我们不希望页面将主键id展示给用户看，但是又希望在提交数据时能将主键id提交到后端。</p>
<p>此时我们就想到了在学习 HTML 时学习的<strong>隐藏域</strong>，在 <code>update.jsp</code> 页面的表单中添加如下代码：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%--隐藏域，提交id--%&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;$&#123;brand.id&#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p><code>update.jsp</code> 页面的最终代码如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;修改品牌&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;修改品牌&lt;/h3&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/brand-demo/updateServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;%--隐藏域，提交id--%&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;$&#123;brand.id&#125;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    品牌名称：&lt;input name=<span class="string">&quot;brandName&quot;</span> value=<span class="string">&quot;$&#123;brand.brandName&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    企业名称：&lt;input name=<span class="string">&quot;companyName&quot;</span> value=<span class="string">&quot;$&#123;brand.companyName&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    排序：&lt;input name=<span class="string">&quot;ordered&quot;</span> value=<span class="string">&quot;$&#123;brand.ordered&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    描述信息：&lt;textarea rows=<span class="string">&quot;5&quot;</span> cols=<span class="string">&quot;20&quot;</span> name=<span class="string">&quot;description&quot;</span>&gt;$&#123;brand.description&#125; &lt;/textarea&gt;&lt;br&gt;</span><br><span class="line">    状态：</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 0&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;0&quot;</span> checked&gt;禁用</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;1&quot;</span>&gt;启用&lt;br&gt;</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;brand.status == 1&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;0&quot;</span> &gt;禁用</span><br><span class="line">        &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;status&quot;</span> value=<span class="string">&quot;1&quot;</span> checked&gt;启用&lt;br&gt;</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>JSP</category>
      </categories>
      <tags>
        <tag>JSP</tag>
      </tags>
  </entry>
  <entry>
    <title>Servlet入门</title>
    <url>/2022/08/06/JavaWeb/JSP%E5%92%8CServlet/Servlet%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806202630.png" width=80%></div>

<span id="more"></span>

<p><strong>HTTP-请求数据格式</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806203621.png" width=50%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806203904.png" width=50%></div>

<p><strong>经典面试问题：GET请求和POST请求的区别？</strong></p>
<ul>
<li>GET请求的请求参数在请求行中，没有请求体；POST请求的请求参数在请求体中</li>
<li>GET请求请求参数大小有限制；POST请求没有限制</li>
</ul>
<blockquote>
<p>这里的回答还不够全面，可以去查相关的面经</p>
</blockquote>
<p>请求数据分为三部分：</p>
<ul>
<li>请求行：请求数据的第一行，GET&#x2F;POST表示请求方式，&#x2F;表示请求资源路径，HTTP&#x2F;1.1表示协议版本</li>
<li>请求头：第二行开始，格式为key:value形式</li>
<li>请求体：POST请求的最后一部分，存放请求参数</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806203610.png" width=70%></div>

<p><strong>HTTP-响应数据格式</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806204403.png" width=80%></div>

<p>状态码分类及说明：</p>
<ul>
<li>1xx：响应中，表示请求已经接受，告诉客户端应该继续请求或者如果它已经完成则忽略它</li>
<li>2xx：成功，表示请求已经成功被接收，处理已完成</li>
<li>3xx：重定向，重定向到其它地方，它让客户端再发起一个请求以完成整个处理</li>
<li>4xx：客户端错误，处理发生错误，责任在客户端，eg：客户端请求一个不存在的资源、客户端未被授权、禁止访问等</li>
<li>5xx：服务端错误，处理发生错误，责任在服务端，eg：服务端抛出异常、路由出错、http版本不支持等</li>
</ul>
<blockquote>
<p>这里的响应状态码所对应的信息也是经典面试问题，可以查看相关的面经</p>
</blockquote>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806204442.png" width=70%></div>

<h3 id="使用socket实现网络通信"><a href="#使用socket实现网络通信" class="headerlink" title="使用socket实现网络通信"></a>使用socket实现网络通信</h3><p>服务器代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * socket搭建的服务器端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ServerSocket serverSocket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Server</span><span class="params">(<span class="type">int</span> port)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        serverSocket = <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br><span class="line">        serverSocket.setSoTimeout(<span class="number">10000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;等待远程连接，端口号为：&quot;</span> + serverSocket.getLocalPort() + <span class="string">&quot;...&quot;</span>);</span><br><span class="line">                <span class="comment">// 侦听并接收到此套接字的连接</span></span><br><span class="line">                <span class="type">Socket</span> <span class="variable">server</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">                System.out.println(<span class="string">&quot;远程主机地址：&quot;</span> + server.getRemoteSocketAddress());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 读取客户端向服务器发送的信息</span></span><br><span class="line">                <span class="type">DataInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(server.getInputStream());</span><br><span class="line">                System.out.println(in.readUTF());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 服务器向客户端发送消息</span></span><br><span class="line">                <span class="type">DataOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(server.getOutputStream());</span><br><span class="line">                out.writeUTF(<span class="string">&quot;服务器连接成功！&quot;</span> + server.getLocalSocketAddress() + <span class="string">&quot;\nGoodbye!&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 关闭套接字</span></span><br><span class="line">                server.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SocketTimeoutException s) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Socket timed out!&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> Integer.parseInt(<span class="string">&quot;6666&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Server</span>(port);</span><br><span class="line">            t.run();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * socket网络编程的客户端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serverName</span> <span class="operator">=</span> <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> Integer.parseInt(<span class="string">&quot;6666&quot;</span>);</span><br><span class="line">        <span class="comment">// 远程服务器端口号为6666，并没有指定客户端的端口号</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;连接到主机：&quot;</span> + serverName + <span class="string">&quot;，端口号：&quot;</span> + port);</span><br><span class="line">            <span class="comment">// 创建一个流套接字，并将其连接到指定远程主机上的指定端口号</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(serverName, port);</span><br><span class="line">            System.out.println(<span class="string">&quot;远程主机地址：&quot;</span> + client.getRemoteSocketAddress());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 客户端向服务器发送消息</span></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outToServer</span> <span class="operator">=</span> client.getOutputStream();</span><br><span class="line">            <span class="type">DataOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(outToServer);</span><br><span class="line">            out.writeUTF(<span class="string">&quot;Hello from &quot;</span> + client.getLocalSocketAddress());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 客户端接收服务器发送过来的消息</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inFromServer</span> <span class="operator">=</span> client.getInputStream();</span><br><span class="line">            <span class="type">DataInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(inFromServer);</span><br><span class="line">            System.out.println(<span class="string">&quot;服务器响应：&quot;</span> + in.readUTF());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关闭套接字</span></span><br><span class="line">            client.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>需要先启动服务器，然后再启动客户端，实现服务器和客户端间的信息传递</strong></p>
<p>客户端：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807115728.png" width=50%></div>

<p>服务器：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807115746.png" width=40%></div>

<blockquote>
<p>服务器的端口号是固定的：6666，而客户端的端口号是随机分配的；服务器使用的是：serverSocket，而客户端使用的是：Socket</p>
</blockquote>
<h3 id="使用socket实现HTTP服务器"><a href="#使用socket实现HTTP服务器" class="headerlink" title="使用socket实现HTTP服务器"></a>使用socket实现HTTP服务器</h3><p><strong>使用socket搭建HTTP服务器，java中的socket程序就是web服务器，客户端就是浏览器，通过浏览器向web服务器发起请求，所以只需要写好服务器端的代码即可。搭建的目的是体验没有web服务器，该怎么实现HTTP通信，能够更好地体现web服务器的好处</strong></p>
<p>HTTP服务器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTTP服务器端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">8888</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Socket accept;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ServerSocket socket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BufferedWriter bw;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        socket = <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器开启，等待连接....&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">// 监听客户端连接，获取服务器套接字的输入(其实就是浏览器对服务器的请求)</span></span><br><span class="line">            accept = socket.accept();</span><br><span class="line">            <span class="comment">// getInputStream是获取浏览器的输入，需要向浏览器输出则为getOutputStream</span></span><br><span class="line">            <span class="type">InputStreamReader</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(accept.getInputStream());</span><br><span class="line">            System.out.println(<span class="string">&quot;浏览器请求成功!&quot;</span>);</span><br><span class="line">            <span class="comment">// 读取浏览器的请求内容</span></span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(r);</span><br><span class="line">            <span class="type">String</span> <span class="variable">readLine</span> <span class="operator">=</span> br.readLine();</span><br><span class="line">            System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line">            <span class="comment">// 打印请求消息</span></span><br><span class="line">            String filePath=<span class="string">&quot;log&quot;</span>;</span><br><span class="line">            <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(readLine != <span class="literal">null</span> &amp;&amp; !readLine.equals(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">                System.out.println(readLine);</span><br><span class="line">                <span class="keyword">if</span> (i==<span class="number">0</span>)&#123;</span><br><span class="line">                    String[] split = readLine.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (split[<span class="number">1</span>].endsWith(<span class="string">&quot;html&quot;</span>)) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;html file: &quot;</span> + split[<span class="number">1</span>]);</span><br><span class="line">                        filePath += split[<span class="number">1</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                i++;</span><br><span class="line">                readLine=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;----------------------&quot;</span>);</span><br><span class="line">            <span class="comment">// 响应客户端请求</span></span><br><span class="line">            System.out.println(filePath);</span><br><span class="line">            <span class="comment">// 响应就是把web页面展现在浏览器中</span></span><br><span class="line">            writeHtml(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务器响应浏览器(客户端)请求</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeHtml</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="comment">//拼装http响应的数据格式</span></span><br><span class="line">        sb.append(<span class="string">&quot;http/1.1 200 ok&quot;</span>).append(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        <span class="comment">// 服务器响应浏览器，向浏览器输出内容</span></span><br><span class="line">        bw = <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(accept.getOutputStream()));</span><br><span class="line">        bw.write(sb.toString());</span><br><span class="line">        bw.flush();</span><br><span class="line">        bw.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入浏览器输入：<a href="http://localhost:8888/%EF%BC%8C%E5%90%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%EF%BC%8C%E7%84%B6%E5%90%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%94%B6%E5%88%B0%E8%AF%B7%E6%B1%82%E5%90%8E%E5%AF%B9%E8%AF%B7%E6%B1%82%E8%BF%9B%E8%A1%8C%E5%93%8D%E5%BA%94%EF%BC%9A">http://localhost:8888/，向服务器发送请求，然后服务器收到请求后对请求进行响应：</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">服务器开启，等待连接....</span><br><span class="line">浏览器请求成功!</span><br><span class="line">---------------------</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: localhost:8888</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Microsoft Edge&quot;;v=&quot;103&quot;, &quot;Chromium&quot;;v=&quot;103&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.134 Safari/537.36 Edg/103.0.1264.77</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">Cookie: cookieconsent_status=dismiss; Idea-16111833=2dd6fce1-cbb9-4678-ae5b-57ee076becf9</span><br><span class="line">----------------------</span><br><span class="line">log</span><br><span class="line">浏览器请求成功!</span><br><span class="line">---------------------</span><br><span class="line">GET /favicon.ico HTTP/1.1</span><br><span class="line">Host: localhost:8888</span><br><span class="line">Connection: keep-alive</span><br><span class="line">sec-ch-ua: &quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Microsoft Edge&quot;;v=&quot;103&quot;, &quot;Chromium&quot;;v=&quot;103&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.134 Safari/537.36 Edg/103.0.1264.77</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Accept: image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Referer: http://localhost:8888/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">Cookie: cookieconsent_status=dismiss; Idea-16111833=2dd6fce1-cbb9-4678-ae5b-57ee076becf9</span><br><span class="line">----------------------</span><br><span class="line">log</span><br></pre></td></tr></table></figure>

<h3 id="什么是Web服务器"><a href="#什么是Web服务器" class="headerlink" title="什么是Web服务器"></a>什么是Web服务器</h3><p>Web服务器是一个应用程序（软件），对HTTP协议的操作进行封装，使得程序员不必直接对协议进行操作，让Web开发更加便捷。主要功能是“提供网上信息浏览服务”，把写好的web项目放在服务器软件中，把服务器软件启动之后，写好的web网页就可以通过浏览器进行访问</p>
<h3 id="什么是Tomcat"><a href="#什么是Tomcat" class="headerlink" title="什么是Tomcat"></a>什么是Tomcat</h3><p>Tomcat是Apache软件基金会一个核心项目，是一个<strong>开源免费的轻量级Web服务器</strong>，支持Servlet&#x2F;JSP，少量JavaEE规范，<strong>Tomcat又被称为Web容器、Servlet容器，Servlet需要依赖于Tomcat才能运行</strong></p>
<p>JavaEE：Java Enterprise Edition，Java企业版。指Java企业级开发的技术规范总和，包含13项技术规范：JDBC、JNDI、EJB、RMI、JSP、Servlet、XML、JMS、Java IDL、JTS、JTA、JavaMail、JAF</p>
<h3 id="Tomcat的配置"><a href="#Tomcat的配置" class="headerlink" title="Tomcat的配置"></a>Tomcat的配置</h3><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807123141.png" width=80%></div>

<p>一定要根据自己的jdk版本去选择Tomcat的版本：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807123308.png" width=80%></div>

<p>Tomcat下载地址：<a href="https://tomcat.apache.org/download-80.cgi">https://tomcat.apache.org/download-80.cgi</a></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806200732.png" width=60%></div>

<p>解压到相应的目录，配置环境变量JAVA_HOME，Path里面要添加：%JAVA_HOME%\bin</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806200835.png" width=60%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806200855.png" width=40%></div>

<p><strong>注意，这里只用配置JAVA_HOME，不要配置JRE_HOME否则启动Tomcat要出错！</strong></p>
<p>配置完成后进入tomcat&#x2F;bin点击startup.bat，发现乱码</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806201009.png" width=80%></div>

<p>这时需要修改tomcat&#x2F;conf下的logging.properties中这部分代码的UTF-8为GBK即可</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806201231.png" width=80%></div>

<p>启动完成后，在浏览器输入localhost:8080，就可以看到可爱的小猫</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806201338.png" width=80%></div>

<h4 id="Tomcat目录结构"><a href="#Tomcat目录结构" class="headerlink" title="Tomcat目录结构"></a>Tomcat目录结构</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806201812.png" width=20%></div>


<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220806201742.png" width=80%></div>

<h4 id="Tomcat部署项目"><a href="#Tomcat部署项目" class="headerlink" title="Tomcat部署项目"></a>Tomcat部署项目</h4><p>将项目放置到webapps目录下，即部署完成，一般JavaWeb项目会被打包成war包，将war包放到webapps目录下，Tomcat会自动解压缩war文件</p>
<h4 id="Idea中创建Maven-Web项目"><a href="#Idea中创建Maven-Web项目" class="headerlink" title="Idea中创建Maven Web项目"></a>Idea中创建Maven Web项目</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807124551.png" width=90%></div>

<p>打包完成后的JavaWeb项目中，除了网页所需的资源文件外，WEB-INF中的classes用于存放编译后的Java字节码文件，lib存放项目依赖的jar包，web.xml是Web项目配置文件</p>
<p><strong>使用骨架：</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807124849.png" width=80%></div>

<p>创建完成后修改pom.xml文件（就是删除一些不需要的内容）：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-demo1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  &lt;packaging&gt;打包方式：</span></span><br><span class="line"><span class="comment">  * jar包：默认值</span></span><br><span class="line"><span class="comment">  * war包：web项目</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>原始目录结构如下，需要添加java和resources文件夹：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807125347.png" width=30%></div>

<p>修改后：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807125509.png" width=30%></div>


<p><strong>不使用骨架：</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807125851.png" width=100%></div>


<h4 id="在Idea中使用Tomcat"><a href="#在Idea中使用Tomcat" class="headerlink" title="在Idea中使用Tomcat"></a>在Idea中使用Tomcat</h4><p>每次部署项目都需要将项目打包成war包，放到tomcat的webapps目录中，再进行启动，十分不方便，可以在idea中更方便地启动！</p>
<p><strong>将本地Tomcat集成到Idea中，然后再进行项目的部署：</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807130240.png" width=100%></div>

<p><strong>使用Tomcat Maven插件：</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807130752.png" width=100%></div>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-demo1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  &lt;packaging&gt;打包方式：</span></span><br><span class="line"><span class="comment">  * jar包：默认值</span></span><br><span class="line"><span class="comment">  * war包：web项目</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--tomcat 插件--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--插件配置--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">          &lt;port&gt;8080&lt;/port&gt;</span></span><br><span class="line"><span class="comment">          &lt;path&gt;/&lt;/path&gt;</span></span><br><span class="line"><span class="comment">        &lt;/configuration&gt;--&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>注意，目前tomcat插件只支持tomcat7</strong></p>
<h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><p><strong>Servlet是Java提供的一门动态web资源开发技术，意思是指，不同用户访问，或访问的参数不同时，展示的页面也不同</strong></p>
<p>Servlet是JavaEE 规范之一，是一个接口，将来需要定义Servlet类实现Servlet接口，并由web服务器运行Servlet</p>
<h4 id="Servlet快速入门"><a href="#Servlet快速入门" class="headerlink" title="Servlet快速入门"></a>Servlet快速入门</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807133149.png" width=80%></div>

<p>Servlet依赖中，scope指定其作用范围：provided，在编译环境和测试环境中有效，在运行环境无效，也就是说在将项目打包成war包时，里面是没有servlet依赖的，因为Tomcat自带了servlet的jar包，如果不这样做会报错</p>
<p>pom.xml内容：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-demo1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--一定要添加作用范围--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Servlet接口的实现类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一定要加上访问路径</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo1</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="comment">// 使用ctrl + i重写需要实现的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 当servlet被访问时，service会自动被执行</span></span><br><span class="line">        System.out.println(<span class="string">&quot;servlet hello world~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用tomcat启动web项目，进入浏览器输入：<a href="http://localhost:8080/web-demo1/demo1">http://localhost:8080/web-demo1/demo1</a></p>
<p>&#x2F;demo1就是servlet实现类中配置的访问路径，访问对应路径后，即可看到控制台：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807134426.png" width=80%></div>

<h4 id="Servlet执行流程"><a href="#Servlet执行流程" class="headerlink" title="Servlet执行流程"></a>Servlet执行流程</h4><p><strong>我们没有创建servlet对象，也没有去执行方法，那这个service方法是怎么被执行的？</strong></p>
<p>这是我们之前的访问路径：<a href="http://localhost:8080/web-demo1/demo1">http://localhost:8080/web-demo1/demo1</a></p>
<p><a href="http://localhost:8080用来访问tomcat服务器">http://localhost:8080用来访问tomcat服务器</a></p>
<p>&#x2F;web-demo1用来访问响应的web项目</p>
<p>&#x2F;demo1访问servlet，访问servlet后，自动执行service方法，<strong>这个servlet对象是由tomcat服务器(web服务器)创建的，service方法也是由tomcat(web服务器)调用的</strong></p>
<p><strong>服务器怎么知道servlet中一定有service方法？</strong></p>
<p>因为我们必须要去定义实现类去实现servlet接口并重写其中的方法，这些方法中就包含service方法</p>
<h4 id="Servlet生命周期"><a href="#Servlet生命周期" class="headerlink" title="Servlet生命周期"></a>Servlet生命周期</h4><p><strong>执行流程明白了，那tomcat什么时候创建servlet对象？</strong></p>
<p>对象的生命周期是指一个对象从被创建到被销毁的整个过程，servlet也是一个对象，也有相应的生命周期</p>
<p><strong>Servlet运行在Servlet容器（web服务器）中，其生命周期由容器来管理，分为四个阶段：</strong></p>
<ol>
<li>加载和实例化：默认情况下，当Servlet<strong>第一次被访问</strong>时，由容器创建Servlet对象<ul>
<li><strong>非默认情况下，使用@WebServlet(urlPatterns&#x3D;”&#x2F;demo”,loadOnStartup&#x3D;0)，来指定创建对象的时机</strong><ol>
<li>取值为负整数：第一次被访问时创建Servlet对象</li>
<li>0或正整数：服务器启动时创建Servlet对象，数字越小优先级越高(用户访问servlet更快)</li>
<li>默认值：-1</li>
</ol>
</li>
</ul>
</li>
<li>初始化：在Servlet实例化后(修改servlet创建的时机，也就修改了init()被调用的时机)，容器将调用Servlet的init()方法，初始化这个对象，完成：加载配置文件、创建连接等初始化的工作。<strong>该方法只调用一次</strong></li>
<li>请求处理：<strong>每次请求Servlet时</strong>，Servlet容器都会调用Servlet的service()方法对请求进行处理</li>
<li>服务终止：当需要释放内存或者容器关闭时，容器就会调用Servlet实例的destroy()方法完成资源的释放。在destroy()方法调用之后，容器会释放这个Servlet实例，该实例随后会被Java的垃圾收集器所回收</li>
</ol>
<p>在idea中点击红色方块终止tomcat服务器，不会调用destroy()方法，需要在终端中使用mvn tomcat7:run方法启动tomcat服务器：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807142550.png" width=80%></div>

<p>然后再用ctrl+c正常终止tomcat服务器：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807142909.png" width=80%></div>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一定要加上访问路径</span></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/demo2&quot;, loadOnStartup = 0)</span>  <span class="comment">// 启动服务器时实例化，这样不需要访问浏览器就可以创建servlet对象</span></span><br><span class="line"><span class="comment">//@WebServlet(urlPatterns = &quot;/demo2&quot;, loadOnStartup = -1)  // 默认</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo2</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="comment">// 使用ctrl + i重写需要实现的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化方法：</span></span><br><span class="line"><span class="comment">     * 1. 调用时机：默认情况下，Servlet被第一次访问时，调用</span></span><br><span class="line"><span class="comment">     *      * loadOnStartup: 修改servlet创建的时机，也就修改了init()被调用的时机</span></span><br><span class="line"><span class="comment">     * 2. 调用次数：1次</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * service方法：每次访问servlet都会执行，每次刷新网页都会执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> res</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 当servlet被访问时，service会自动被执行</span></span><br><span class="line">        System.out.println(<span class="string">&quot;servlet hello world~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销毁方法：servlet被销毁时调用</span></span><br><span class="line"><span class="comment">     * 销毁时机：内存释放或服务器关闭时，servlet对象被销毁(强制关闭无法执行)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Servlet体系结构"><a href="#Servlet体系结构" class="headerlink" title="Servlet体系结构"></a>Servlet体系结构</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807173847.png" width=100%></div>

<blockquote>
<p><strong>为了更好地理解Servlet的体系结构，一定要将继承、实现等关系理解清楚，哪些变量、方法能继承、重写等等</strong></p>
</blockquote>
<p><strong>更好的Web服务器端代码：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;get...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;post...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不按照上述方法，则需要在之前servlet中的service方法中，判断浏览器的请求是Get还是Post：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * service方法：每次访问servlet都会执行，每次刷新网页都会执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> res</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 根据请求方式的不同，进行不同的处理</span></span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) req;</span><br><span class="line">    <span class="comment">// 1. 获取请求方式</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">    <span class="comment">// 2. 判断</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;GET&quot;</span>.equals(method)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Get...&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(method)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Post...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>上面这种通过实现Servlet接口，并重写内部方法的做法太麻烦了，因为我们的类非抽象类，必须重写接口中的所有方法，十分笨重，所以才会有HttpServlet类的存在</strong></p>
</blockquote>
<p><strong>在HttpServlet类的内部，实际上就是做了上面类似的事情：</strong> HttpServlet类继承自GenericServlet抽象类，GenericServlet抽象类又实现了Servlet接口。HttpServlet内部对service方法进行了重写，将ServletRequest、ServletResponse强转为HttpServletRequest、HttpServletResponse，强转的前提是：<strong>Servlet的Request和Response都是HTTP协议下的</strong>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">&#123;</span><br><span class="line">    HttpServletRequest  request;</span><br><span class="line">    HttpServletResponse response;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!(req <span class="keyword">instanceof</span> HttpServletRequest &amp;&amp;</span><br><span class="line">            res <span class="keyword">instanceof</span> HttpServletResponse)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;non-HTTP request or response&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request = (HttpServletRequest) req;</span><br><span class="line">    response = (HttpServletResponse) res;</span><br><span class="line"></span><br><span class="line">    service(request, response);  <span class="comment">// 虽然方法名相同，但参数值类型不同</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service方法的最后又调用了另一个service方法，<strong>注意这个service方法是由protected修饰的，由无修饰符的实例方法、protected修饰的实例方法都可以被子类继承，这样，我们在开发项目时，就可以写一个自己定义的类，继承HttpServlet类，就可以继承其service方法，然后再根据需要重写doGet()、doPost()等方法(这些方法都是HttpServlet类提供的，子类继承后进行重写)，一定要记得service方法是tomcat调用的，是每次访问servlet对象时，都会执行的</strong>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> req.getMethod();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.equals(METHOD_GET)) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">        <span class="keyword">if</span> (lastModified == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// servlet doesn&#x27;t support if-modified-since, no reason</span></span><br><span class="line">            <span class="comment">// to go through further expensive logic</span></span><br><span class="line">            doGet(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ifModifiedSince</span> <span class="operator">=</span> req.getDateHeader(HEADER_IFMODSINCE);</span><br><span class="line">            <span class="keyword">if</span> (ifModifiedSince &lt; lastModified) &#123;</span><br><span class="line">                <span class="comment">// If the servlet mod time is later, call doGet()</span></span><br><span class="line">                <span class="comment">// Round down to the nearest second for a proper compare</span></span><br><span class="line">                <span class="comment">// A ifModifiedSince of -1 will always be less</span></span><br><span class="line">                maybeSetLastModified(resp, lastModified);</span><br><span class="line">                doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_HEAD)) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">        maybeSetLastModified(resp, lastModified);</span><br><span class="line">        doHead(req, resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_POST)) &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_PUT)) &#123;</span><br><span class="line">        doPut(req, resp);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_DELETE)) &#123;</span><br><span class="line">        doDelete(req, resp);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_OPTIONS)) &#123;</span><br><span class="line">        doOptions(req,resp);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_TRACE)) &#123;</span><br><span class="line">        doTrace(req,resp);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Note that this means NO servlet supports whatever</span></span><br><span class="line">        <span class="comment">// method was requested, anywhere on this server.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">errMsg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_not_implemented&quot;</span>);</span><br><span class="line">        Object[] errArgs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">1</span>];</span><br><span class="line">        errArgs[<span class="number">0</span>] = method;</span><br><span class="line">        errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line">        </span><br><span class="line">        resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">protocol</span> <span class="operator">=</span> req.getProtocol();</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_get_not_supported&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (protocol.endsWith(<span class="string">&quot;1.1&quot;</span>)) &#123;</span><br><span class="line">        resp.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resp.sendError(HttpServletResponse.SC_BAD_REQUEST, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">protocol</span> <span class="operator">=</span> req.getProtocol();</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_post_not_supported&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (protocol.endsWith(<span class="string">&quot;1.1&quot;</span>)) &#123;</span><br><span class="line">        resp.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resp.sendError(HttpServletResponse.SC_BAD_REQUEST, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继承HttpServlet类后，根据请求方法的不同，重写不同的响应函数，不用再重写所有方法(这也是继承相比于接口的好处)</p>
<blockquote>
<p>最好的理解方式是去用Servlet接口和HttpServlet类去定义自己的servlet类，对于不懂的方法通过查阅源码，搞清楚里面的原理</p>
</blockquote>
<h4 id="Servlet-urlPattern配置"><a href="#Servlet-urlPattern配置" class="headerlink" title="Servlet urlPattern配置"></a>Servlet urlPattern配置</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807210623.png" width=80%></div>

<ol>
<li>精确匹配：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/user/select&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doGet...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doPost...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问路径：localhost:8080&#x2F;web-demo1&#x2F;user&#x2F;select</p>
<ol start="2">
<li>目录匹配：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/user/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doGet...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doPost...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问路径：localhost:8080&#x2F;web-demo1&#x2F;user&#x2F;aaa(或&#x2F;bbb、或&#x2F;ccc…)</p>
<ol start="3">
<li>扩展名匹配：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doGet...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doPost...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问路径：localhost:8080&#x2F;web-demo1&#x2F;aaa.do(或&#x2F;bbb.do)，主要是对扩展名有要求</p>
<ol start="4">
<li>任意匹配：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 下面两种都可以</span></span><br><span class="line"><span class="comment">// @WebServlet(urlPatterns = &quot;/&quot;)</span></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns=&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doGet...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doPost...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&#x2F; 和 &#x2F;* 的区别:</p>
<ul>
<li>当项目中的Servlet配置了”&#x2F;“，会覆盖掉tomcat中的DefaultServlet，当其他的url-pattern都匹配不上时，才会选择这个Servlet。tomcat中DefaultServlet为”&#x2F;“，它用于<strong>访问web项目中的静态资源</strong>，例如有一个a.html，直接&#x2F;a.html就可以在浏览器上进行访问，但是如果项目中的Servlet配置了”&#x2F;“，则会覆盖掉tomcat中DefaultServlet访问静态资源的功能！</li>
<li>当项目中配置了”&#x2F;*”，意味着匹配任意访问路径</li>
</ul>
<p>访问路径：localhost:8080&#x2F;web-demo1&#x2F;hehe(或者&#x2F;haha或者&#x2F;xxx)</p>
<blockquote>
<p>优先级顺序：精确匹配 &gt; 目录匹配 &gt; 扩展名匹配 &gt; &#x2F;* &gt; &#x2F;</p>
</blockquote>
<h4 id="XML配置方式编写Servlet"><a href="#XML配置方式编写Servlet" class="headerlink" title="XML配置方式编写Servlet"></a>XML配置方式编写Servlet</h4><p>Servlet从3.0版本后开始支持使用注解配置，3.0版本之前只能通过XML配置文件进行配置</p>
<p><strong>配置方法：</strong></p>
<ol>
<li>编写Servlet类(实现接口或继承父类)</li>
<li>在web.xml中配置该Servlet</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      Servlet的全类名</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo6<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.mxeron.web.ServletDemo6<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      Servlet的访问路径</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo6<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo6<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Request-请求-和-Response-响应"><a href="#Request-请求-和-Response-响应" class="headerlink" title="Request(请求) 和 Response(响应)"></a>Request(请求) 和 Response(响应)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 当servlet被访问时，service会自动被执行</span></span><br><span class="line">    System.out.println(<span class="string">&quot;servlet hello world~&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ServletRequest：</strong></p>
<p>浏览器向服务器发送请求，请求数据就是一些字符串：请求行、请求头、请求体，这些请求数据会被tomcat解析，然后被放到ServletRequest中，代表浏览器的请求数据，<strong>通过ServletRequest获取请求数据</strong></p>
<p><strong>ServletResponse：</strong></p>
<p>服务器向浏览器进行响应，响应的数据封装到ServletResponse中，设置响应数据</p>
<h4 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h4><h4 id="Request继承体系"><a href="#Request继承体系" class="headerlink" title="Request继承体系"></a>Request继承体系</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807213328.png" width=80%></div>

<blockquote>
<p>注意：ServletRequest和HttpServletRequest都是接口，<strong>RequestFacade是Tomcat定义的实现类，由于是普通类实现接口，所以这个类中会实现接口中的所有方法</strong>。Service方法也是由Tomcat调用的，所以Service方法中所需的request、response对象都由Tomcat创建</p>
</blockquote>
<p><strong>注意，这里是利用接口变量调用其实现类的对象的方法 [接口回调对象]，接口回调对象只能访问接口的抽象方法，实际上是访问子类重写以后的抽象方法，不能访问子类新增的方法！(除非强转为子类对象)</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="comment">// 接口不能new，如果需要访问抽象方法需要借助接口子类</span></span><br><span class="line">		<span class="comment">//接口回调对象--接口的子类对象赋值给接口变量</span></span><br><span class="line">		TestInterface tin=<span class="keyword">new</span> <span class="title class_">TestSonClass</span>();</span><br><span class="line">		tin.info();</span><br><span class="line">		<span class="comment">//接口回调对象只能访问接口的抽象方法，实际上访问子类重写以后的抽象方法</span></span><br><span class="line">		<span class="comment">//接口回调对象不能访问子类本身的方法，如果要访问就需要强制类型转换</span></span><br><span class="line">		TestSonClass tc=(TestSonClass)tin;</span><br><span class="line">		tc.test1();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>Tomcat需要解析浏览器的请求数据，封装成request对象，并且创建request对象传递到service方法中</li>
<li>使用request对象，只需要查阅HttpServletRequest接口中的方法即可</li>
</ol>
<p>可以看到request对象的地址：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220807214000.png" width=50%></div>

<h4 id="Request获取请求数据"><a href="#Request获取请求数据" class="headerlink" title="Request获取请求数据"></a>Request获取请求数据</h4><p>这里是说HttpServletRequest</p>
<p>请求数据分为三部分：</p>
<ol>
<li>请求行</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809153642.png" width=60%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809133340.png" width=80%></div>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/req1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo6</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取请求方式</span></span><br><span class="line">        System.out.println(req.getMethod());</span><br><span class="line">        <span class="comment">// 获取虚拟目录(项目访问路径):/request-demo</span></span><br><span class="line">        System.out.println(req.getContextPath());</span><br><span class="line">        <span class="comment">// 获取URL(统一资源定位符):http://localhost:8080/web-demo1/req1</span></span><br><span class="line">        System.out.println(req.getRequestURL());</span><br><span class="line">        <span class="comment">// 获取URI(统一资源标识符):/web-demo1/req1</span></span><br><span class="line">        System.out.println(req.getRequestURI());</span><br><span class="line">        <span class="comment">// 获取请求参数(Get方式):username=zhangsan</span></span><br><span class="line">        System.out.println(req.getQueryString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://localhost:8080/web-demo1/req1?username=zhngsan">http://localhost:8080/web-demo1/req1?username=zhngsan</a></p>
<ol start="2">
<li>请求头</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809153713.png" width=60%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809153741.png" width=80%></div>
 

<ol start="3">
<li>请求体(只有Post请求才有请求体)</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809153826.png" width=60%></div>

<p>以字符流的形式进行获取，如果上传图片、文件、视频就用字节流输入</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809153849.png" width=80%></div>

<h4 id="Request通用方式获取请求参数"><a href="#Request通用方式获取请求参数" class="headerlink" title="Request通用方式获取请求参数"></a>Request通用方式获取请求参数</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809202029.png" width=50%></div>

<p><strong>思考：GET请求方式和POST请求方式，区别主要在于获取请求参数的方式不同，是否可以提供一种统一获取请求参数的方法，从而统一doGet和doPost方法内的代码？</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809202712.png" width=80%></div>

<p><strong>上面的方式是get、post请求方法通用的，需要这么做是因为get、post所进行的操作一样</strong></p>
<p><strong>使用Servlet模板创建Servlet：</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809204013.png" width=80%></div>

<p>按照下面的方法就可以很容易地创建Servlet！</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809204503.png" width=80%></div>

<h4 id="Request请求参数中文乱码处理"><a href="#Request请求参数中文乱码处理" class="headerlink" title="Request请求参数中文乱码处理"></a>Request请求参数中文乱码处理</h4><p>请求参数中有中文会乱码！</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809204953.png" width=10%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220809212012.png" width=100%></div>

<p>首先要明白utf-8的编码方式，我们现在写的是Servlet的代码，是在tomcat中运行的，所以拿到的request的请求参数的编码方式是：ISO-8859-1，拿到后，我们参数使用ISO-8859-1进行解码，获得相应的字节数据(字节数组，每个元素就是一个字节)，然后再将字节数组按照utf-8的方式转换为字符串。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中文乱码解决</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo7&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo7</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 解决乱码：Post，getReader()，通过字符流获取，只需要设置字符流的编码为：UTF-8</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解决乱码：Get，getQueryString()，获取的是字符串，不是流</span></span><br><span class="line">        <span class="comment">// 乱码原因：浏览器对URL编码采用UTF-8，而tomcat对URL解码采用ISO-8859-1，编解码的方式不同导致乱码</span></span><br><span class="line">        <span class="comment">// 这种处理方式，Post也适用！</span></span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bytes = username.getBytes(StandardCharsets.ISO_8859_1);</span><br><span class="line">        username = <span class="keyword">new</span> <span class="title class_">String</span>(bytes, StandardCharsets.UTF_8);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tomcat8.0之后，已经解决了GET请求乱码问题，设置了默认的解码方式为：UTF-8</p>
</blockquote>
<h4 id="Request请求转发"><a href="#Request请求转发" class="headerlink" title="Request请求转发"></a>Request请求转发</h4><p>请求转发forward：一种在服务器内部的资源跳转方式</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810113345.png" width=50%></div>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810113704.png" width=50%></div>

<p>目的是在转发过程中增加新的数据，<strong>资源B的路径不需要添加虚拟目录</strong></p>
<p><strong>请求转发的特点：</strong></p>
<ol>
<li>浏览器地址栏路径不会发生变化</li>
<li>只能转发到当前服务器的<strong>内部资源</strong></li>
<li><strong>转发只有一次请求，可以在转发的资源间使用request共享数据</strong></li>
</ol>
<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><p>用于设置响应数据，响应数据也分为三部分：响应行、响应头、响应体</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810114051.png" width=80%></div>

<p>和Request一样的体系结构，<strong>并且同样使用接口回调对象来调用对象重写接口中的方法</strong></p>
<h4 id="Response设置响应数据功能介绍"><a href="#Response设置响应数据功能介绍" class="headerlink" title="Response设置响应数据功能介绍"></a>Response设置响应数据功能介绍</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810114600.png" width=60%></div>

<h4 id="Response重定向"><a href="#Response重定向" class="headerlink" title="Response重定向"></a>Response重定向</h4><p><strong>resp1 跳转到 resp2</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RespsonseDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp1...&quot;</span>);</span><br><span class="line"><span class="comment">//        // 重定向</span></span><br><span class="line"><span class="comment">//        // 1. 设置响应状态码 302</span></span><br><span class="line"><span class="comment">//        response.setStatus(302);</span></span><br><span class="line"><span class="comment">//        // 2. 设置响应头 Location, value为重定向的资源路径，注意这里要加上项目的目录</span></span><br><span class="line"><span class="comment">//        response.setHeader(&quot;Location&quot;, &quot;/web-demo1/resp2&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 简化重定向</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;/web-demo1/resp2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RespsonseDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp2...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>重定向的特点：</strong></p>
<ol>
<li>浏览器地址栏路径发生变化</li>
<li>可以重定向到任意位置的资源（服务器内部、外部都可以，<a href="https://www.baidu.com)/">https://www.baidu.com）</a></li>
<li>整个过程涉及<strong>两次</strong>请求，<strong>不能</strong>在多个资源使用request共享数据</li>
</ol>
<p>重定向的过程浏览器会发起两次请求，<strong>两次请求将来就会有两个request域，就不能够进行资源共享！</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810115732.png" width=80%></div>


<h4 id="路径问题"><a href="#路径问题" class="headerlink" title="路径问题"></a>路径问题</h4><p>在request进行请求转发时，<strong>转发的路径是没有添加虚拟目录的：&#x2F;req2</strong>；而在response进行重定向时，<strong>重定向的路径是添加了虚拟目录的：&#x2F;web-demo1&#x2F;resp2</strong>，这是为什么？</p>
<p><strong>明确路径给谁使用？</strong></p>
<ul>
<li>给浏览器使用：需要添加虚拟目录（项目访问路径）（<strong>重定向是浏览器完成的，需要加上虚拟目录</strong>）</li>
<li>服务器端使用：不需要添加虚拟目录（<strong>请求转发是在服务器内部完成的，不需要添加虚拟目录</strong>）</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810120447.png" width=40%></div>

<p>&lt;a href&#x3D;”路径”、&lt;form action&#x3D;”路径”，<strong>都需要添加虚拟目录，因为它们都是浏览器的行为，是浏览器做出的动作</strong></p>
<p><strong>重定向中动态获取虚拟目录，降低代码的耦合度</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RespsonseDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp1...&quot;</span>);</span><br><span class="line"><span class="comment">//        // 重定向</span></span><br><span class="line"><span class="comment">//        // 1. 设置响应状态码 302</span></span><br><span class="line"><span class="comment">//        response.setStatus(302);</span></span><br><span class="line"><span class="comment">//        // 2. 设置响应头 Location, value为重定向的资源路径，注意这里要加上项目的目录</span></span><br><span class="line"><span class="comment">//        response.setHeader(&quot;Location&quot;, &quot;/web-demo1/resp2&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 简化版重定向</span></span><br><span class="line">        <span class="comment">// 动态获取虚拟目录</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">        response.sendRedirect(contextPath + <span class="string">&quot;/resp2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Response响应字符数据"><a href="#Response响应字符数据" class="headerlink" title="Response响应字符数据"></a>Response响应字符数据</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应字符数据：设置字符数据的响应体</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/resp3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RespsonseDemo3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 简化content-type设置写法，一定要在获取流之前设置字符格式</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// text/html是让浏览器按照html文件解析，charset=utf-8是为了解决中文乱码问题</span></span><br><span class="line">        <span class="comment">// 获取字符输出流</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="comment">// response是服务器向浏览器输出数据</span></span><br><span class="line">        <span class="comment">// content-type</span></span><br><span class="line"><span class="comment">//        response.setHeader(&quot;content-type&quot;, &quot;text/html&quot;);</span></span><br><span class="line">        <span class="comment">// 设置content-type告诉浏览器响应的数据类型是html格式的，浏览器才能按照html进行解析</span></span><br><span class="line">        <span class="comment">// 如果不设置，浏览器只会按照纯文本进行解析</span></span><br><span class="line">        writer.write(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        writer.write(<span class="string">&quot;&lt;h1&gt;aaa&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 中文乱码问题：通过Response获取的字符输出流默认编码为：ISO-8859-1</span></span><br><span class="line">        writer.write(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 细节：字符流writer不要关闭，因为这个writer流是由response对象产生的</span></span><br><span class="line">        <span class="comment">// 随着响应结束，当response对象被销毁后，writer流也会被服务器关闭</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Response响应字节数据"><a href="#Response响应字节数据" class="headerlink" title="Response响应字节数据"></a>Response响应字节数据</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应字节数据：设置字节数据的响应体，字节数据：图片、视频、音频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/resp4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RespsonseDemo4</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 读取文件</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;./a.jpg&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. 获取response字节输出流</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line"><span class="comment">//        // 3. 完成流的copy</span></span><br><span class="line"><span class="comment">//        byte[] buff = new byte[1024];</span></span><br><span class="line"><span class="comment">//        int len = 0;</span></span><br><span class="line"><span class="comment">//        while ((len = fis.read(buff)) != -1) &#123;</span></span><br><span class="line"><span class="comment">//            os.write(buff, 0, len);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用IOUtils工具类，简化流的操作，在pom.xml中添加commons-io依赖</span></span><br><span class="line">        IOUtils.copy(fis, os);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 只用关闭文件流，response字节输出流待响应完成后，response对象被销毁，由服务器关闭</span></span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pom.xml配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="案例-用户登录-amp-用户注册"><a href="#案例-用户登录-amp-用户注册" class="headerlink" title="案例-用户登录 &amp; 用户注册"></a>案例-用户登录 &amp; 用户注册</h3><h4 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h4><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>用户在登录页面输入用户名和密码，提交请求给LoginServlet</li>
<li>在LoginServlet中接收请求和数据[用户名和密码]</li>
<li>在LoginServlt中通过Mybatis实现调用UserMapper来根据用户名和密码查询数据库表</li>
<li>将查询的结果封装到User对象中进行返回</li>
<li>在LoginServlet中判断返回的User对象是否为null</li>
<li>如果为nul，说明根据用户名和密码没有查询到用户，则登录失败，返回”登录失败”数据给前端</li>
<li>如果不为null,则说明用户存在并且密码正确，则登录成功，返回”登录成功”数据给前端</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1628865728305.png" width=100%></div>

<h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><ol>
<li>将静态页面拷贝到项目的webapp目录下</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810125623.png" width=30%></div>

<ol start="2">
<li>创建db1数据库，创建tb_user表，创建User实体类</li>
</ol>
<p>tb_user表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建用户表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> tb_user;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb_user(</span><br><span class="line">                        id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">                        username <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">unique</span>,</span><br><span class="line">                        password <span class="type">varchar</span>(<span class="number">32</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_user(username,password) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;123&#x27;</span>),(<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;234&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_user;</span><br></pre></td></tr></table></figure>

<p>User实体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mxeron.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在项目的pom.xml导入Mybatis和Mysql驱动坐标</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-demo1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--一定要添加作用范围--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>创建mybatis-config.xml核心配置文件，UserMapper.xml映射文件，UserMapper接口(忘了的话可以看之前的Mybatis教程)</li>
</ol>
<p>mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--起别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--包扫描方式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mxeron.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useServerPrepStmts=true&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--%amp是&amp;的转义字符，单独的&amp;，在xml环境下是不被识别的--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;801299&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加载sql的映射文件--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource=&quot;com/mxeron/mapper/UserMapper.xml&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--和sql映射文件同一目录，可以直接导入--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Mapper代理方式，使用包扫描更方便加载，扫描包后自动识别出里面的映射文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mxeron.mapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用前提：Mapper接口名和SQL映射文件名相同，且在同一目录下--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>UserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--namespace：名称空间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mxeron.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220810132059.png" width=40%></div>

<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><ol>
<li>在UserMapper接口中提供一个根据用户名和密码查询用户对象的方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为方便这里使用注解进行sql语句的设置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名和密码查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">select</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username, <span class="meta">@Param(&quot;password&quot;)</span> String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>改造login.html登录页面，填上相应的Servlet地址：</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/login.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;loginDiv&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--action后写servlet地址，form表单是浏览器操作的行为，所以要添加虚拟目录--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--现在是html静态页面，不能动态获取虚拟目录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/web-demo1/loginServlet&quot;</span> <span class="attr">id</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;loginMsg&quot;</span>&gt;</span>LOGIN IN<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Password:<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;subDiv&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login up&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;reset&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;register.html&quot;</span>&gt;</span>没有账号？点击注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写LoginServlet.java</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/loginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 接收用户名和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 调用mybatis完成查询</span></span><br><span class="line">        <span class="comment">// 2.1 获取SqlSessionFactory对象</span></span><br><span class="line">        <span class="comment">// 2.2 获取SqlSession对象</span></span><br><span class="line">        <span class="comment">// 2.3 获取Mappper</span></span><br><span class="line">        <span class="comment">// 2.4 调用方法</span></span><br><span class="line">        <span class="comment">// 2.5 释放资源</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;  <span class="comment">// 就放在resources中</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行sql，传入名称空间+sql的id名</span></span><br><span class="line">        <span class="comment">// List&lt;User&gt; users = sqlSession.selectList(&quot;test.selectAll&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新：代理开发，获取UserMapper接口的代理对象</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.select(username, password);</span><br><span class="line"><span class="comment">//        System.out.println(user);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取字符输出流，并设置content-type，解决中文乱码问题</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="comment">// 3. 判断user是否为null</span></span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 登录成功</span></span><br><span class="line">            writer.write(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 登陆失败</span></span><br><span class="line">            writer.write(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h4><h4 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h4><ol>
<li>用户填写用户名、密码等信息，点击注册按钮，提交到RegisterServlet</li>
<li>在RegisterServlet中使用MyBatis保存数据</li>
<li>保存前，需要判断用户名是否已经存在（根据用户名查询数据库）</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1628867904783.png" width=100%></div>

<ol>
<li>用户在注册页面输入用户名和密码，提交请求给RegisterServlet</li>
<li>在RegisterServlet中接收请求和数据[用户名和密码]</li>
<li>在RegisterServlet中通过Mybatis实现调用UserMapper来根据用户名查询数据库表</li>
<li>将查询的结果封装到User对象中进行返回</li>
<li>在RegisterServlet中判断返回的User对象是否为null</li>
<li>如果为nul，说明根据用户名可用，则调用UserMapper来实现添加用户</li>
<li>如果不为null,则说明用户不可以，返回”用户名已存在”数据给前端</li>
</ol>
<h4 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h4><ol>
<li>编写UserMapper提供根据用户名查询用户数据方法和添加用户方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据用户名查询用户对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">selectByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加用户</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into tb_user values(null,#&#123;username&#125;,#&#123;password&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改register.html</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/register.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-div&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;reg-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎注册<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>已有帐号？<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;login.html&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;reg-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/request-demo/registerServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;inputs&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;username_err&quot;</span> <span class="attr">class</span>=<span class="string">&quot;err_msg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>用户名不太受欢迎<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;inputs&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;password_err&quot;</span> <span class="attr">class</span>=<span class="string">&quot;err_msg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>密码格式有误<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;buttons&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;注 册&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg_btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> <span class="attr">class</span>=<span class="string">&quot;clear&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建RegisterServlet类</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/registerServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 接收用户数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装用户对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用mapper 根据用户名查询用户对象</span></span><br><span class="line">        <span class="comment">//2.1 获取SqlSessionFactory对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        <span class="comment">//2.2 获取SqlSession对象</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//2.3 获取Mapper</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.4 调用方法</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> userMapper.selectByUsername(username);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 判断用户对象释放为null</span></span><br><span class="line">        <span class="keyword">if</span>( u == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 用户名不存在，添加用户</span></span><br><span class="line">            userMapper.add(user);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 提交事务</span></span><br><span class="line">            sqlSession.commit();</span><br><span class="line">            <span class="comment">// 释放资源</span></span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 用户名存在，给出提示信息</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">            response.getWriter().write(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动服务器进行测试</li>
</ol>
<h4 id="SqlSessionFactory工具类抽取"><a href="#SqlSessionFactory工具类抽取" class="headerlink" title="SqlSessionFactory工具类抽取"></a>SqlSessionFactory工具类抽取</h4><p>上面两个功能已经实现，但是在写Servlet的时候，因为需要使用Mybatis来完成数据库的操作，所以对于Mybatis的基础操作就出现了些重复代码，如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br></pre></td></tr></table></figure>

<p>有了这些重复代码就会造成一些问题:</p>
<ul>
<li>重复代码不利于后期的维护</li>
<li>SqlSessionFactory工厂进行重复创建<ul>
<li>就相当于每次买手机都需要重新创建一个手机生产工厂来给你制造一个手机一样，资源消耗非常大但性能却非常低，所以这么做是不允许的</li>
</ul>
</li>
</ul>
<p><strong>那如何来优化呢？</strong></p>
<ul>
<li>代码重复可以抽取工具类</li>
<li>对指定代码只需要执行一次可以使用静态代码块(只创建一次工厂)，静态代码块随着类的加载执行，且只执行一次</li>
</ul>
<p><strong>有了这两个方向后，代码具体该如何编写?</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionFactoryUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 静态代码块会随着类的加载而自动执行，且只执行一次</span></span><br><span class="line">        <span class="comment">// 静态代码块内不能抛出异常，只能catch</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSessionFactory <span class="title function_">getSqlSessionFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/loginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 接收用户名和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 调用mybatis完成查询</span></span><br><span class="line">        <span class="comment">// 2.1 获取SqlSessionFactory对象</span></span><br><span class="line">        <span class="comment">// 2.2 获取SqlSession对象</span></span><br><span class="line">        <span class="comment">// 2.3 获取Mappper</span></span><br><span class="line">        <span class="comment">// 2.4 调用方法</span></span><br><span class="line">        <span class="comment">// 2.5 释放资源</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        // 加载mybatis的核心配置文件，获取SqlSessionFactory</span></span><br><span class="line"><span class="comment">//        String resource = &quot;mybatis-config.xml&quot;;  // 就放在resources中</span></span><br><span class="line"><span class="comment">//        InputStream inputStream = Resources.getResourceAsStream(resource);</span></span><br><span class="line"><span class="comment">//        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用SqlSessionFactory工具类来加载SqlSessionFactory</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取SqlSession对象，用来执行sql</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行sql，传入名称空间+sql的id名</span></span><br><span class="line">        <span class="comment">// List&lt;User&gt; users = sqlSession.selectList(&quot;test.selectAll&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新：代理开发，获取UserMapper接口的代理对象</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.select(username, password);</span><br><span class="line"><span class="comment">//        System.out.println(user);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取字符输出流，并设置content-type，解决中文乱码问题</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="comment">// 3. 判断user是否为null</span></span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 登录成功</span></span><br><span class="line">            writer.write(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 登陆失败</span></span><br><span class="line">            writer.write(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>工具类抽取以后，以后在对Mybatis的SqlSession进行操作的时候，就可以直接使用</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br></pre></td></tr></table></figure>

<p>这样就可以很好的解决上面所说的代码重复和重复创建工厂导致性能低的问题了。</p>
<p><strong>注意，sqlSession对象是用户与数据库的连接，不能够像sqlSessionFactory抽象成工具类，因为不可能多个功能都使用同一个连接！</strong></p>
<ol>
<li>SqlSession是MyBatis的关键对象,是执行持久化操作的独享,类似于JDBC中的Connection</li>
<li>它是应用程序与持久层之间执行交互操作的一个单线程对象,也是MyBatis执行持久化操作的关键对象</li>
<li>SqlSession对象完全包含以数据库为背景的所有执行SQL操作的方法,它的底层封装了JDBC连接,可以用SqlSession实例来直接执行被映射的SQL语句</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取SqlSession对象，用来执行sql</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>Servlet</category>
      </categories>
      <tags>
        <tag>Servlet</tag>
      </tags>
  </entry>
  <entry>
    <title>会话技术</title>
    <url>/2022/08/16/JavaWeb/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/</url>
    <content><![CDATA[<h3 id="会话技术"><a href="#会话技术" class="headerlink" title="会话技术"></a>会话技术</h3><ul>
<li>理解什么是会话跟踪技术</li>
<li>掌握Cookie的使用</li>
<li>掌握Session的使用</li>
<li>完善用户登录注册案例的功能</li>
</ul>
<span id="more"></span>

<h4 id="会话跟踪技术的概述"><a href="#会话跟踪技术的概述" class="headerlink" title="会话跟踪技术的概述"></a>会话跟踪技术的概述</h4><p>对于<code>会话跟踪</code>这四个词，我们需要拆开来进行解释，首先要理解什么是<code>会话</code>，然后再去理解什么是<code>会话跟踪</code>:</p>
<ul>
<li><p>会话:用户打开浏览器，访问web服务器的资源，会话建立，直到有一方断开连接，会话结束。在一次会话中可以包含<strong>多次请求和响应</strong>：</p>
<ul>
<li>从浏览器发出请求到服务端响应数据给前端之后，一次会话(在浏览器和服务器之间)就被建立了</li>
<li>会话被建立后，<strong>如果浏览器或服务端都没有被关闭，则会话就会持续建立着</strong></li>
<li><strong>浏览器和服务器就可以继续使用该会话进行请求发送和响应，上述的整个过程就被称之为会话</strong></li>
</ul>
<p>用实际场景来理解下会话，比如在我们访问京东的时候，当打开浏览器进入京东首页后，浏览器和京东的服务器之间就建立了一次会话，后面的搜索商品,查看商品的详情,加入购物车等都是在这一次会话中完成。</p>
<p><strong>思考:下图中总共建立了几个会话?</strong></p>
</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629382713180.png" width=80%></div>

<p>  每个浏览器都会与服务端建立了一个会话，加起来总共是<strong>3个会话</strong>。</p>
<ul>
<li><p>会话跟踪:一种维护浏览器状态的方法，<strong>服务器需要识别多次请求是否来自于同一浏览器(服务器自身并不知道请求是否来自同意浏览器)<strong>，以便在同一次会话的多次请求间</strong>共享数据</strong>。</p>
<ul>
<li>服务器会收到多个请求，这多个请求可能来自多个浏览器，如上图中的6个请求来自3个浏览器</li>
<li>服务器需要用来识别请求是否来自同一个浏览器</li>
<li><strong>服务器用来识别浏览器的过程，这个过程就是会话跟踪</strong></li>
<li>服务器识别浏览器后就可以在同一个会话中多次请求之间来共享数据</li>
</ul>
<p>那么我们又有一个问题需要思考，一个会话中的多次请求<strong>为什么要共享数据呢?</strong> 有了这个数据共享功能后能实现哪些功能呢?</p>
<ul>
<li><p>购物车: <code>加入购物车</code>和<code>去购物车结算</code>是两次请求，但是后面这次请求要想展示前一次请求所添加的商品，就需要用到数据共享。</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629383655260.png" width=80%></div>
</li>
<li><p>页面展示用户登录信息:很多网站，登录后访问多个功能发送多次请求后，浏览器上都会有当前登录用户的信息[用户名]，比如百度、京东、码云等。</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629383767654.png" width=60%></div>
</li>
<li><p>网站登录页面的<code>记住我</code>功能:当用户登录成功后，勾选<code>记住我</code>按钮后下次再登录的时候，网站就会自动填充用户名和密码，简化用户的登录操作，多次登录就会有多次请求，他们之间也涉及到共享数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629383921990.png" width=60%></div>
</li>
<li><p>登录页面的验证码功能:生成验证码和输入验证码点击注册这也是两次请求，这两次请求的数据之间要进行对比，相同则允许注册，不同则拒绝注册，该功能的实现也需要在同一次会话中共享数据。</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629384004179.png" width=40%></div></li>
</ul>
</li>
</ul>
<p>通过这几个例子的讲解，相信大家对<code>会话追踪</code>技术已经有了一定的理解，该技术在实际开发中也非常重要。那么接下来我们就需要去学习下<code>会话跟踪</code>技术，在学习这些技术之前，<strong>我们需要思考：为什么现在浏览器和服务器不支持数据共享呢?</strong></p>
<ul>
<li>浏览器和服务器之间使用的是HTTP请求来进行数据传输</li>
<li>HTTP协议是<strong>无状态</strong>的，<strong>每次浏览器向服务器请求时，服务器都会将该请求视为新的请求</strong></li>
<li>HTTP协议设计成无状态的目的是让<strong>每次请求之间相互独立，互不影响</strong></li>
<li>请求与请求之间独立后，就无法实现多次请求之间的数据共享</li>
</ul>
<p>分析完具体的原因后，那么该<strong>如何实现会话跟踪技术呢?</strong> 具体的实现方式有:</p>
<p>(1)<strong>客户端会话跟踪技术：Cookie</strong></p>
<p>(2)<strong>服务端会话跟踪技术：Session</strong></p>
<p>这两个技术都可以实现会话跟踪，<strong>它们之间最大的区别：Cookie是存储在浏览器端而Session是存储在服务器端</strong></p>
<p>需要注意的是：</p>
<ul>
<li>HTTP协议是无状态的，靠HTTP协议是无法实现会话跟踪</li>
<li><strong>想要实现会话跟踪，就需要用到Cookie和Session</strong></li>
</ul>
<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><ul>
<li>什么是Cookie?</li>
<li>Cookie如何来使用?</li>
<li>Cookie是如何实现的?</li>
<li>Cookie的使用注意事项有哪些?</li>
</ul>
<h4 id="Cookie的基本使用"><a href="#Cookie的基本使用" class="headerlink" title="Cookie的基本使用"></a>Cookie的基本使用</h4><p><strong>1.概念</strong></p>
<p><strong>Cookie</strong>：<strong>客户端会话技术</strong>，将数据保存到客户端，以后每次请求都携带Cookie数据进行访问。</p>
<blockquote>
<p><strong>一定要注意，数据是保存到客户端的！</strong></p>
</blockquote>
<p><strong>2.Cookie的工作流程</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629386230207.png" width=80%></div>

<ul>
<li>服务端提供了两个Servlet，分别是ServletA和ServletB</li>
<li>浏览器发送HTTP请求1给服务端，服务端ServletA接收请求并进行业务处理</li>
<li><strong>服务端ServletA在处理的过程中可以创建一个Cookie对象</strong>并将<code>name=zs</code>的数据存入Cookie</li>
<li>服务端ServletA在响应数据的时候，<strong>会把Cookie对象响应给浏览器</strong></li>
<li>浏览器接收到响应数据，<strong>会把Cookie对象中的数据存储在浏览器内存中</strong>，此时浏览器和服务端就<strong>建立了一次会话</strong></li>
<li><strong>在同一次会话</strong>中浏览器再次发送HTTP请求2给服务端ServletB，<strong>浏览器会携带Cookie对象中的所有数据</strong></li>
<li>ServletB接收到请求和数据后，就可以获取到存储在Cookie对象中的数据，这样同一个会话中的多次请求之间就实现了<strong>数据共享</strong></li>
</ul>
<p><strong>3.Cookie的基本使用</strong></p>
<p>对于Cookie的使用，我们更关注的应该是后台代码如何操作Cookie，对于Cookie的操作主要分<strong>两大类</strong>，本别是<strong>发送Cookie</strong>和<strong>获取Cookie</strong>，对于上面这两块内容，该如何实现呢?</p>
<p><strong>3.1 发送Cookie</strong></p>
<ul>
<li>创建Cookie对象，并使用键值对的方式设置值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cookie cookie = new Cookie(&quot;key&quot;,&quot;value&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>发送Cookie到客户端：<strong>使用response对象</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p>介绍完发送Cookie对应的步骤后，接下面<strong>通过一个案例来完成Cookie的发送</strong>，具体实现步骤为:</p>
<blockquote>
<p>需求：在Servlet中生成Cookie对象并存入数据，然后将数据发送给浏览器</p>
<p>1.创建Maven项目,项目名称为cookie-demo，并在pom.xml添加依赖</p>
<p>2.编写Servlet类，名称为AServlet</p>
<p>3.在AServlet中创建Cookie对象，存入数据，发送给前端</p>
<p>4.启动测试，在浏览器查看Cookie对象中的值</p>
</blockquote>
<p>(1)创建Maven项目cookie-demo，并在pom.xml添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jsp--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jstl--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>(2)编写Servlet类，名称为AServlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3)在Servlet(服务器端)中创建Cookie对象，存入数据，发送给前端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="comment">//1. 创建Cookie对象</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）启动测试，在浏览器查看Cookie对象中的值</p>
<p>访问<code>http://localhost:8080/cookie-demo/aServlet</code></p>
<p><strong>chrome浏览器查看Cookie的值，有两种方式：</strong></p>
<p>方式一：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629389317463.png" width=80%></div>

<p>方式二：选中打开开发者工具或者 使用快捷键F12 或者 Ctrl+Shift+I</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629390237936.png" width=80%></div>

<p><strong>3.2 获取Cookie</strong></p>
<ul>
<li>获取客户端携带的<strong>所有Cookie</strong>，使用<strong>request对象</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cookie[] cookies = request.getCookies();</span><br></pre></td></tr></table></figure>

<ul>
<li>遍历数组，获取每一个Cookie对象：for</li>
<li>使用Cookie对象方法获取数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cookie.getName();</span><br><span class="line">cookie.getValue();</span><br></pre></td></tr></table></figure>

<p>介绍完获取Cookie对应的步骤后，接下面再通过一个案例来完成Cookie的获取，具体实现步骤为:</p>
<blockquote>
<p>需求:在Servlet中获取前一个案例存入在Cookie对象中的数据</p>
<p>1.编写一个新Servlet类，名称为BServlet</p>
<p>2.在BServlet中使用request对象获取Cookie数组，遍历数组，从数据中获取指定名称对应的值</p>
<p>3.启动测试，在控制台打印出获取的值</p>
</blockquote>
<p>（1）编写一个新Servlet类，名称为BServlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/bServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）在BServlet中使用request对象获取Cookie数组，遍历数组，从数据中获取指定名称对应的值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/bServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取Cookie</span></span><br><span class="line">        <span class="comment">//1. 获取Cookie数组</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="comment">//2. 遍历数组</span></span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="comment">//3. 获取数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cookie.getName();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;username&quot;</span>.equals(name))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cookie.getValue();</span><br><span class="line">                System.out.println(name+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）启动测试，在控制台打印出获取的值</p>
<p>访问<code>http://localhost:8080/cookie-demo/bServlet</code></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629391020081.png" width=80%></div>

<p>在IDEA控制台就能看到输出的结果:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629391061140.png" width=80%></div>

<p><strong>思考：测试的时候</strong></p>
<p><strong>在访问AServlet和BServlet的中间把关闭浏览器，重启浏览器后访问BServlet能否获取到Cookie中的数据？</strong></p>
<p>在这节中，我们主要讲解了Cookie的基本使用，包含两部分内容</p>
<ul>
<li>发送Cookie:<ul>
<li>创建Cookie对象，并设置值:Cookie cookie &#x3D; new Cookie(“key”,”value”);</li>
<li>发送Cookie到客户端使用的是Reponse对象:response.addCookie(cookie);</li>
</ul>
</li>
<li>获取Cookie:<ul>
<li>使用Request对象获取Cookie数组:Cookie[] cookies &#x3D; request.getCookies();</li>
<li>遍历数组</li>
<li>获取数组中每个Cookie对象的值:cookie.getName()和cookie.getValue()</li>
</ul>
</li>
</ul>
<p><strong>介绍完Cookie的基本使用之后，那么Cookie的底层到底是如何实现一次会话两次请求之间的数据共享呢?</strong></p>
<h4 id="Cookie的原理分析"><a href="#Cookie的原理分析" class="headerlink" title="Cookie的原理分析"></a>Cookie的原理分析</h4><p>对于Cookie的实现原理是基于HTTP协议的，其中涉及到HTTP协议中的两个请求头信息:</p>
<ul>
<li>响应头: set-cookie</li>
<li>请求头: cookie</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629393289338.png" width=80%></div>

<ul>
<li>前面的案例中已经能够实现，AServlet给前端发送Cookie，BServlet从request中获取Cookie的功能</li>
<li>对于AServlet响应数据的时候，Tomcat服务器都是基于HTTP协议来响应数据</li>
<li>当Tomcat发现后端要返回的是一个Cookie对象之后，<strong>Tomcat就会在响应头中</strong>添加一行数据<code>Set-Cookie:username=zs</code></li>
<li>浏览器获取到响应结果后，从响应头中就可以获取到<code>Set-Cookie</code>对应值<code>username=zs</code>，并<strong>将数据存储在浏览器的内存中</strong></li>
<li>浏览器再次发送请求给BServlet的时候，<strong>浏览器会自动在请求头中</strong>添加<code>Cookie:username=zs</code>发送给服务端BServlet</li>
<li>Request对象会把请求头中cookie对应的值封装成一个个Cookie对象，最终形成一个数组</li>
<li>BServlet通过Request对象获取到Cookie[]后，就可以从中获取自己需要的数据</li>
</ul>
<p><strong>接下来，使用刚才的案例，把上述结论验证下:</strong></p>
<p>（1）访问AServlet对应的地址<code>http://localhost:8080/cookie-demo/aServlet</code></p>
<p>使用Chrom浏览器打开开发者工具(F12或Crtl+Shift+I)进行查看<strong>响应头</strong>中的数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629393428733.png" width=80%></div>

<p>（2）访问BServlet对应的地址&#96;<a href="http://localhost:8080/cookie-demo/bServlet">http://localhost:8080/cookie-demo/bServlet</a></p>
<p>使用Chrom浏览器打开开发者工具(F12或Crtl+Shift+I)进行查看<strong>请求头</strong>中的数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629393578667.png" width=80%></div>

<h4 id="Cookie的使用细节"><a href="#Cookie的使用细节" class="headerlink" title="Cookie的使用细节"></a>Cookie的使用细节</h4><p>两个知识，第一个是Cookie的存活时间，第二个是Cookie如何存储中文，首先来学习下Cookie的存活时间。</p>
<h4 id="Cookie的存活时间"><a href="#Cookie的存活时间" class="headerlink" title="Cookie的存活时间"></a>Cookie的存活时间</h4><p>前面让大家思考过一个问题:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629423321737.png" width=80%></div>

<p>(1)浏览器发送请求给AServlet，AServlet会响应一个存有<code>usernanme=zs</code>的Cookie对象给浏览器</p>
<p>(2)浏览器接收到响应数据将cookie存入到浏览器内存中</p>
<p>(3)当浏览器再次发送请求给BServlet，BServlet就可以使用Request对象获取到Cookie数据</p>
<p>(4)<strong>在发送请求到BServlet之前，如果把浏览器关闭再打开进行访问，BServlet能否获取到Cookie数据?</strong></p>
<p>&#x3D;&#x3D;注意：浏览器关闭再打开不是指打开一个新的选项卡，而且必须是先关闭再打开，顺序不能变。&#x3D;&#x3D;</p>
<p><strong>针对上面这个问题，通过演示，会发现，BServlet中无法再获取到Cookie数据，这是为什么呢？</strong></p>
<ul>
<li><strong>默认情况下，Cookie存储在浏览器内存中，当浏览器关闭，内存释放，则Cookie被销毁</strong></li>
</ul>
<p>这个结论就印证了上面的演示效果，但是如果使用这种默认情况下的Cookie,有些需求就无法实现，比如:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629423629887.png" width=80%></div>

<p>上面这个网站的登录页面上有一个<code>记住我</code>的功能，这个功能大家都比较熟悉</p>
<ul>
<li>第一次输入用户名和密码并勾选<code>记住我</code>然后进行登录</li>
<li>下次再登陆的时候，用户名和密码就会被自动填充，不需要再重新输入登录</li>
<li>比如<code>记住我</code>这个功能需要记住用户名和密码一个星期，那么使用默认情况下的Cookie就会出现问题</li>
<li>因为默认情况，浏览器一关，Cookie就会从浏览器内存中删除，对于<code>记住我</code>功能就无法实现</li>
</ul>
<p><strong>所以我们现在就遇到一个难题是如何将Cookie持久化存储?</strong></p>
<h4 id="设置Cookie的存活时间"><a href="#设置Cookie的存活时间" class="headerlink" title="设置Cookie的存活时间"></a>设置Cookie的存活时间</h4><p>Cookie其实已经为我们提供好了对应的API来完成这件事，这个API就是<strong>setMaxAge</strong>：</p>
<ul>
<li>设置Cookie存活时间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setMaxAge(int seconds)</span><br></pre></td></tr></table></figure>

<p>参数值为:</p>
<p>1.正数：将Cookie写入浏览器所在电脑的<strong>硬盘</strong>，持久化存储。到时间自动删除</p>
<p>2.负数：默认值，Cookie在当前浏览器内存中，当浏览器关闭，则Cookie被销毁</p>
<p>3.零：删除对应Cookie</p>
<p>接下来，咱们就在AServlet中去设置Cookie的存活时间。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="comment">//1. 创建Cookie对象</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        <span class="comment">//设置存活时间   ，1周 7天</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>); <span class="comment">//易阅读，需程序计算</span></span><br><span class="line">		<span class="comment">//cookie.setMaxAge(604800); //不易阅读(可以使用注解弥补)，程序少进行一次计算</span></span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改完代码后，启动测试，访问<code>http://localhost:8080/cookie-demo/aServlet</code></p>
<ul>
<li>访问一个AServlet后，把浏览器关闭重启后，再去访问<code>http://localhost:8080/cookie-demo/bServet</code>，能在控制台打印出<code>username:zs</code>，<strong>说明Cookie没有随着浏览器关闭而被销毁</strong></li>
<li>通过浏览器查看Cookie的内容，会发现Cookie的相关信息</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629424844041.png" width=80%></div>

<h4 id="Cookie存储中文"><a href="#Cookie存储中文" class="headerlink" title="Cookie存储中文"></a>Cookie存储中文</h4><p>首先，先来演示一个效果，将之前<code>username=zs</code>的值改成<code>username=张三</code>，把汉字<code>张三</code>存入到Cookie中，看是什么效果:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"> 		<span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,value);</span><br><span class="line">        <span class="comment">//设置存活时间   ，1周 7天</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动访问测试，访问<code>http://localhost:8080/cookie-demo/aServlet</code>会发现浏览器会提示错误信息</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629425945465.png" width=80%></div>

<p>通过上面的案例演示，我们得到一个结论:</p>
<ul>
<li><strong>Cookie不能直接存储中文</strong></li>
</ul>
<p>Cookie不能存储中文，但是如果有这方面的需求，这个时候该如何解决呢?</p>
<p>这个时候，我们可以使用之前学过的一个知识点叫<code>URL编码</code>，<strong>所以如果需要存储中文，就需要进行转码</strong>，具体的实现思路为:</p>
<blockquote>
<p>1.在AServlet中对中文进行URL编码，采用URLEncoder.encode()，将编码后的值存入Cookie中</p>
<p>2.在BServlet中获取Cookie中的值,获取的值为URL编码后的值</p>
<p>3.将获取的值在进行URL解码,采用URLDecoder.decode()，就可以获取到对应的中文值</p>
</blockquote>
<p>（1）在AServlet中对中文进行URL编码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        <span class="comment">//对中文进行URL编码</span></span><br><span class="line">        value = URLEncoder.encode(value, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;存储数据：&quot;</span>+value);</span><br><span class="line">        <span class="comment">//将编码后的值存入Cookie中</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,value);</span><br><span class="line">        <span class="comment">//设置存活时间   ，1周 7天</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）在BServlet中获取值，并对值进行解码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/bServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取Cookie</span></span><br><span class="line">        <span class="comment">//1. 获取Cookie数组</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="comment">//2. 遍历数组</span></span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="comment">//3. 获取数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cookie.getName();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;username&quot;</span>.equals(name))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cookie.getValue();<span class="comment">//获取的是URL编码后的值 %E5%BC%A0%E4%B8%89</span></span><br><span class="line">                <span class="comment">//URL解码</span></span><br><span class="line">                value = URLDecoder.decode(value,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">                System.out.println(name+<span class="string">&quot;:&quot;</span>+value);<span class="comment">//value解码后为 张三</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，我们就可以将中文存入Cookie中进行使用。</p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>Cookie已经能完成一次会话多次请求之间的数据共享，之前我们还提到过Session也可以实现，那么:</p>
<ul>
<li>什么是Session?</li>
<li>Session如何来使用?</li>
<li>Session是如何实现的?</li>
<li>Session的使用注意事项有哪些?</li>
</ul>
<h4 id="Session的基本使用"><a href="#Session的基本使用" class="headerlink" title="Session的基本使用"></a>Session的基本使用</h4><p><strong>1.概念</strong></p>
<p><strong>Session：服务端会话跟踪技术：将数据保存到服务端</strong></p>
<ul>
<li><strong>Session是存储在服务端而Cookie是存储在客户端</strong></li>
<li><strong>存储在客户端的数据容易被窃取和截获，存在很多不安全的因素</strong></li>
<li>存储在服务端的数据相比于客户端来说就更安全</li>
</ul>
<p><strong>2.Session的工作流程</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629427173389.png" width=80%></div>

<ul>
<li>在服务端的AServlet获取一个Session对象，把数据存入其中</li>
<li>在服务端的BServlet获取到相同的Session对象，从中取出数据</li>
<li>就可以实现一次会话中多次请求之间的数据共享了</li>
<li>现在最大的问题是<strong>如何保证AServlet和BServlet使用的是同一个Session对象</strong>(在原理分析会讲解)?</li>
</ul>
<p><strong>3.Session的基本使用</strong></p>
<p>在JavaEE中提供了HttpSession接口，来实现<strong>一次会话的多次请求之间数据共享功能</strong>，具体的使用步骤为:</p>
<ul>
<li>获取Session对象,使用的是request对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Session对象提供的功能:</p>
<ul>
<li><p>存储数据到 session 域中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void setAttribute(String name, Object o)</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据 key，获取值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Object getAttribute(String name)</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据 key，删除该键值对</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void removeAttribute(String name)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>介绍完Session相关的API后，接下来通过一个案例来完成对Session的使用，具体实现步骤为:</p>
<blockquote>
<p>需求:在一个Servlet中往Session中存入数据，在另一个Servlet中获取Session中存入的数据</p>
<p>1.创建名为SessionDemo1的Servlet类</p>
<p>2.创建名为SessionDemo2的Servlet类</p>
<p>3.在SessionDemo1的方法中:获取Session对象、存储数据</p>
<p>4.在SessionDemo2的方法中:获取Session对象、获取数据</p>
<p>5.启动测试</p>
</blockquote>
<p>(1)创建名为SessionDemo1的Servlet类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2)创建名为SessionDemo2的Servlet类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3)SessionDemo1：获取Session对象、存储数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    	<span class="comment">//存储到Session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//2. 存储数据</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Cookie和Session的创建方式：</strong><br>Cookie:response.addCookie(cookie);<br>Session:request.getSession();<br><strong>可见，cookie是添加在服务器对浏览器的响应中；而session是从浏览器对服务器的请求中获取的</strong></p>
<p><strong>Cookie和Session的获取方式：</strong><br>Cookie:request.getCookies();<br>Session:request.getSession();<br><strong>它们都是从浏览器对服务器的响应中获取！</strong></p>
</blockquote>
<p>(4)SessionDemo2：获取Session对象、获取数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取数据，从session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//2. 获取数据</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(5)启动测试，</p>
<ul>
<li>先访问<code>http://localhost:8080/cookie-demo/demo1</code>，将数据存入Session</li>
<li>在访问<code>http://localhost:8080/cookie-demo/demo2</code>，从Session中获取数据</li>
<li>查看控制台</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629428292373.png" width=80%></div>

<p><strong>通过案例的效果，能看到Session是能够在一次会话中两次请求之间共享数据。</strong></p>
<p>至此Session的基本使用就已经完成了，重点要掌握的是:</p>
<ul>
<li><p>Session的获取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Session常用方法的使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void setAttribute(String name, Object o)</span><br><span class="line">Object getAttribute(String name)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>注意:</strong> Session中可以存储的是一个Object类型的数据，也就是说Session中可以存储任意数据类型。</p>
<p>Session的底层到底是如何实现一次会话两次请求之间的数据共享呢?</p>
<h4 id="Session的原理分析"><a href="#Session的原理分析" class="headerlink" title="Session的原理分析"></a>Session的原理分析</h4><ul>
<li>Session是基于Cookie实现的</li>
</ul>
<p>这句话其实不太能详细的说明Session的底层实现，接下来，咱们一步步来分析下Session的具体实现原理:</p>
<p>(1)前提条件</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629429063101.png" width=80%></div>

<p>Session要想实现一次会话多次请求之间的数据共享，就必须要保证多次请求获取Session的对象是同一个。</p>
<p>那么它们是一个对象么？要验证这个结论也很简单，只需要在上面案例中的两个Servlet中分别打印下Session对象</p>
<p>SessionDemo1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    	<span class="comment">//存储到Session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        System.out.println(session);</span><br><span class="line">        <span class="comment">//2. 存储数据</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SessionDemo2</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取数据，从session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        System.out.println(session);</span><br><span class="line">        <span class="comment">//2. 获取数据</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动测试，分别访问</p>
<p><code>http://localhost:8080/cookie-demo/demo1</code></p>
<p><code>http://localhost:8080/cookie-demo/demo2</code></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629429239409.png" width=80%></div>

<p>通过打印可以得到如下结论:</p>
<ul>
<li>两个Servlet类中<strong>获取的Session对象是同一个</strong></li>
<li>把demo1和demo2请求刷新多次，控制台最终打印的结果都是同一个</li>
</ul>
<p>那么问题又来了，<strong>如果新开一个浏览器，访问demo1或者demo2，打印在控制台的Session还是同一个对象么?</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629429788264.png" width=80%></div>

<p>&#x3D;&#x3D;注意:在一台电脑上演示的时候，如果是相同的浏览器必须要把浏览器全部关掉重新打开，才算新开的一个浏览器。&#x3D;&#x3D;</p>
<blockquote>
<p>当然也可以使用不同的浏览器进行测试，就不需要把之前的浏览器全部关闭。</p>
</blockquote>
<p><strong>测试的结果：如果是不同浏览器或者重新打开浏览器后，打印的Session就不一样了。所以Session实现的也是一次会话中的多次请求之间的数据共享。</strong></p>
<p><strong>那么最主要的问题就来了，Session是如何保证在一次会话中获取的Session对象是同一个呢？</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629430754825.png" width=80%></div>

<p>(1)demo1在第一次获取session对象的时候，session对象会有一个唯一的标识，假如是<code>id:10</code></p>
<p>(2)demo1在session中存入其他数据并处理完成所有业务后，需要通过Tomcat服务器响应结果给浏览器</p>
<p>(3)Tomcat服务器发现业务处理中使用了session对象，<strong>就会把session的唯一标识<code>id:10</code>当做一个cookie，添加<code>Set-Cookie:JESSIONID=10</code>到响应头中，并响应给浏览器</strong></p>
<p>(4)浏览器接收到响应结果后，<strong>会把响应头中的cookie数据存储到浏览器的内存中，cookie就是存储到浏览器中的</strong></p>
<p>(5)浏览器在同一会话中访问demo2的时候，<strong>会把cookie中的数据按照<code>cookie: JESSIONID=10</code>的格式添加到请求头中并发送给服务器Tomcat</strong></p>
<p>(6)demo2获取到请求后，从请求头中就读取cookie中的JSESSIONID值为10，然后就会到服务器内存中寻找<code>id:10</code>的session对象，<strong>如果找到了，就直接返回该对象，如果没有则新创建一个session对象</strong></p>
<p>(7)<strong>关闭打开浏览器后，因为浏览器的cookie已被销毁，所以就没有JESSIONID的数据，服务端获取到的session就是一个全新的session对象</strong></p>
<p>至此，<code>Session是基于Cookie来实现的</code>这就话，我们就解释完了，接下来通过实例来演示下:</p>
<p>(1)使用chrome浏览器访问<code>http://localhost:8080/cookie-demo/demo1</code>，打开开发者模式(F12或Ctrl+Shift+I)，<strong>查看响应头(Response Headers)数据:</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629430891071.png" width=80%></div>

<p>(2)使用chrome浏览器再次访问<code>http://localhost:8080/cookie-demo/demo2</code>，<strong>查看请求头(Request Headers)数据</strong>:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629431299195.png" width=80%></div>

<p>介绍完Session的原理，我们只需要记住：<strong>Session是基于Cookie来实现的</strong></p>
<h4 id="Session的使用细节"><a href="#Session的使用细节" class="headerlink" title="Session的使用细节"></a>Session的使用细节</h4><h4 id="Session的钝化与活化"><a href="#Session的钝化与活化" class="headerlink" title="Session的钝化与活化"></a>Session的钝化与活化</h4><ul>
<li>服务器重启后，Session中的数据是否还在?</li>
</ul>
<p>要想回答这个问题，我们可以先看下下面这幅图，</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629438984314.png" width=80%></div>

<p>(1)服务器端AServlet和BServlet共用的session对象应该是存储在服务器的内存中</p>
<p>(2)<strong>服务器重新启动后，内存中的数据应该是已经被释放，对象也应该都销毁了</strong></p>
<p>所以session数据应该也已经不存在了。但是如果session不存在会引发什么问题呢?</p>
<p><strong>举个例子说明下：</strong></p>
<p>(1)用户把需要购买的商品添加到购物车，因为要实现同一个会话多次请求数据共享，所以假设把数据存入Session对象中</p>
<p>(2)用户正要付钱的时候接到一个电话，付钱的动作就搁浅了</p>
<p>(3)正在用户打电话的时候，购物网站因为某些原因需要重启</p>
<p>(4)重启后session数据被销毁，购物车中的商品信息也就会随之而消失</p>
<p>(5)用户想再次发起支付，就会出为问题</p>
<p>所以说对于session的数据，我们应该做到就算服务器重启了，也应该能把数据保存下来才对。</p>
<p><strong>分析了这么多，那么Tomcat服务器在重启的时候，session数据到底会不会保存以及是如何保存的</strong>，我们可以通过实际案例来演示下:</p>
<p>&#x3D;&#x3D;注意:这里所说的关闭和启动应该要确保是正常的关闭和启动。&#x3D;&#x3D;</p>
<p>那如何才是正常关闭Tomcat服务器呢?</p>
<p>需要使用命令行的方式来启动和停止Tomcat服务器:</p>
<p>启动：进入到项目pom.xml所在目录，执行<code>tomcat7:run</code></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629439800328.png" width=80%></div>

<p>停止：在启动的命令行界面，输入<code>ctrl+c</code></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629439879596.png" width=80%></div>

<p>有了上述两个正常启动和关闭的方式后，接下来的测试流程是:</p>
<p>(1)先启动Tomcat服务器</p>
<p>(2)访问<code>http://localhost:8080/cookie-demo/demo1</code>将数据存入session中</p>
<p>(3)正确停止Tomcat服务器</p>
<p>(4)再次重新启动Tomcat服务器</p>
<p>(5)访问<code>http://localhost:8080/cookie-demo/demo2</code> 查看是否能获取到session中的数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629440018238.png" width=80%></div>

<blockquote>
<p><strong>经过测试，会发现只要服务器是正常关闭和启动，session中的数据是可以被保存下来的。</strong></p>
</blockquote>
<p>那么Tomcat服务器到底是如何做到的呢，具体的原因就是：<strong>Session的钝化和活化:</strong></p>
<ul>
<li><p><strong>钝化：在服务器正常关闭后，Tomcat会自动将Session数据写入硬盘的文件中</strong></p>
<ul>
<li><p>钝化的数据路径为:<code>项目目录\target\tomcat\work\Tomcat\localhost\项目名称\SESSIONS.ser</code></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629440576828.png" width=80%></div></li>
</ul>
</li>
<li><p><strong>活化：再次启动服务器后，从文件中加载数据到Session中</strong></p>
<ul>
<li>数据加载到Session中后，路径中的<code>SESSIONS.ser</code>文件<strong>会被删除掉</strong></li>
</ul>
</li>
</ul>
<p>对于上述的整个过程，大家只需要了解下即可，<strong>因为所有的过程都是Tomcat自己完成的</strong>，不需要我们参与。</p>
<p><strong>小结</strong></p>
<p>Session的钝化和活化介绍完后，需要我们注意的是：</p>
<ul>
<li><p>session数据存储在服务端，服务器重启后，session数据会被保存</p>
</li>
<li><p>浏览器被关闭启动后，重新建立的连接就已经是一个全新的会话，获取的session数据也是一个新的对象</p>
</li>
<li><p>session的数据要想共享，浏览器不能关闭，所以session数据不能长期保存数据</p>
</li>
<li><p>cookie是存储在客户端，是可以长期保存</p>
</li>
</ul>
<h4 id="Session销毁"><a href="#Session销毁" class="headerlink" title="Session销毁"></a>Session销毁</h4><p>session的销毁会有两种方式:</p>
<ul>
<li><p>默认情况下，无操作，<strong>30分钟自动销毁</strong></p>
<ul>
<li><p>对于这个失效时间，是可以通过配置进行修改的</p>
<ul>
<li><p>在项目的web.xml中配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>100<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果没有配置，默认是30分钟，默认值是在Tomcat的web.xml配置文件中写死的</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629441687613.png" width=80%></div></li>
</ul>
</li>
</ul>
</li>
<li><p>调用Session对象的invalidate()进行销毁</p>
<ul>
<li><p>在SessionDemo2类中添加session销毁的方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取数据，从session中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        System.out.println(session);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 销毁</span></span><br><span class="line">        session.invalidate();</span><br><span class="line">        <span class="comment">//2. 获取数据</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动访问测试，先访问demo1将数据存入到session，再次访问demo2从session中获取数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629441900843.png" width=80%></div>
</li>
<li><p>该销毁方法一般会在用户退出的时候，需要将session销毁掉。</p>
</li>
</ul>
</li>
</ul>
<p><strong>Cookie和Session小结</strong></p>
<ul>
<li>Cookie 和 Session 都是来完成一次会话内多次请求间&#x3D;&#x3D;数据共享&#x3D;&#x3D;的。</li>
</ul>
<p>所需两个对象放在一块，就需要思考:</p>
<p><strong>Cookie和Session的区别是什么?</strong></p>
<p><strong>Cookie和Session的应用场景分别是什么?</strong></p>
<ul>
<li>区别:<ul>
<li>存储位置：Cookie 是将数据存储在客户端，Session 将数据存储在服务端</li>
<li>安全性：Cookie不安全，Session安全</li>
<li>数据大小：Cookie最大3KB，Session无大小限制</li>
<li>存储时间：Cookie可以通过setMaxAge()长期存储，Session默认30分钟</li>
<li>服务器性能：Cookie不占服务器资源，Session占用服务器资源</li>
</ul>
</li>
<li>应用场景:<ul>
<li>购物车:使用Cookie来存储，因为数据存储在哪里都可以，安全也无所谓，并且Cookie是需要长期存储的(之前JD无需登录就可以添加物品到购物车)</li>
<li>以登录用户的名称展示:使用Session来存储，因为用户信息需要安全保存，要用Session</li>
<li>记住我功能:使用Cookie来存储，虽然密码需要安全保存，但是Session不能长期存储，使用cookie可以长期存储更加方便用户(现在有一些浏览器：edge，会通过登录浏览器账号，才能启用自动填补密码的功能，这其实是存储在Session中的)</li>
<li>验证码:使用session来存储，用验证码就是为了避免机器多次注册，所以不能存储到cookie中</li>
</ul>
</li>
<li>结论<ul>
<li>Cookie是用来保证用户在未登录情况下的身份识别</li>
<li>Session是用来保存用户登录后的数据</li>
</ul>
</li>
</ul>
<p>介绍完Cookie和Session以后，具体用哪个还是需要根据具体的业务进行具体分析。</p>
<h3 id="用户登录注册案例"><a href="#用户登录注册案例" class="headerlink" title="用户登录注册案例"></a>用户登录注册案例</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p><strong>需求说明：</strong></p>
<ol>
<li><p>完成用户登录功能，如果用户勾选“记住用户” ，则下次访问登录页面<strong>自动填充用户名密码</strong></p>
</li>
<li><p>完成注册功能，并实现<strong>验证码功能</strong></p>
</li>
</ol>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629442826981.png" width=80%></div>

<h4 id="用户登录功能"><a href="#用户登录功能" class="headerlink" title="用户登录功能"></a>用户登录功能</h4><p><strong>需求：</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629443152010.png" width=80%></div>

<ul>
<li>用户登录成功后，跳转到列表页面，并在页面上展示当前登录的用户名称</li>
<li>用户登录失败后，跳转回登录页面，并在页面上展示对应的错误信息</li>
</ul>
<p><strong>实现流程分析：</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629443379531.png" width=100%></div>

<p>(1)前端通过表单发送请求和数据给Web层的LoginServlet</p>
<p>(2)在LoginServlet中接收请求和数据[用户名和密码]</p>
<p>(3)LoginServlet接收到请求和数据后，调用Service层完成根据用户名和密码查询用户对象</p>
<p>(4)在Service层需要编写UserService类，在类中实现login方法，方法中调用Dao层的UserMapper</p>
<p>(5)在UserMapper接口中，声明一个根据用户名和密码查询用户信息的方法</p>
<p>(6)Dao层把数据查询出来以后，将返回数据封装到User对象，将对象交给Service层</p>
<p>(7)Service层将数据返回给Web层</p>
<p>(8)Web层获取到User对象后，判断User对象，如果为Null,则将错误信息响应给登录页面，如果不为Null，则跳转到列表页面，并把当前登录用户的信息存入Session携带到列表页面。</p>
<p><strong>具体实现：</strong></p>
<p><strong>(1)完成Dao层的代码编写</strong></p>
<p>(1.1)UserMapper.java放到<code>com.itheima.mapper</code>包下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名和密码查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">select</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username,<span class="meta">@Param(&quot;password&quot;)</span>  String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into tb_user values(null,#&#123;username&#125;,#&#123;password&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(1.2)User.java放到<code>com.itheima.pojo</code>包下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(1.3)将UserMapper.xml放入到<code>resources/com/itheima/mapper</code>目录下:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mxeron<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-demo3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis 依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--一定要添加作用范围--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- jsp依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--起别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--包扫描方式，为相应的实体类取别名，别名就是实体类的类名，不区分大小写，别名可以用于后续resultMap的使用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mxeron.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useServerPrepStmts=true&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--%amp是&amp;的转义字符，单独的&amp;，在xml环境下是不被识别的--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;801299&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加载sql的映射文件--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource=&quot;com/mxeron/mapper/UserMapper.xml&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--和sql映射文件同一目录，可以直接导入--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Mapper代理方式，使用包扫描更方便加载，扫描包后自动识别出里面的映射文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.mxeron.mapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用前提：Mapper接口名和SQL映射文件(mapper文件)名相同，且在同一目录下--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>(2)完成Service层的代码编写</strong></p>
<p>(2.1)在<code>com.itheima.service</code>包下，创建UserService类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">//1.使用工具类获取SqlSessionFactory</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String username,String password)</span>&#123;</span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取UserMapper</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.select(username, password);</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>(3)完成页面和Web层的代码编写</strong></p>
<blockquote>
<p>资源是黑马程序员的资源，可以网上找一下</p>
</blockquote>
<p>(3.1)静态页面拷贝到项目的<code>webapp</code>目录下:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629444649629.png" width=40%></div>

<p>(3.2)将login.html内容修改成<code>login.jsp</code>，一定要注意设置UTF-8编码方式 + EL表达式生效</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%--XML低版本，需要添加这句后EL表达式才能生效！--%&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span>%&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;login&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/login.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;loginDiv&quot;</span> style=<span class="string">&quot;height: 350px&quot;</span>&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/web-demo3/loginServlet&quot;</span> method=<span class="string">&quot;post&quot;</span> id=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">&quot;loginMsg&quot;</span>&gt;LOGIN IN&lt;/h1&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br><span class="line">        &lt;p&gt;Username:&lt;input id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> type=<span class="string">&quot;text&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Password:&lt;input id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> type=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Remember:&lt;input id=<span class="string">&quot;remember&quot;</span> name=<span class="string">&quot;remember&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;subDiv&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;login up&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;reset&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;reset&quot;</span>&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">            &lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>(3.3)创建LoginServlet类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/loginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 获取用户名和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service查询</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> service.login(username, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 判断</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 登录成功，跳转到查询所有的selectAllServlet</span></span><br><span class="line">            <span class="comment">// 将登陆成功后的user对象，存储到session</span></span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">            <span class="comment">// 动态虚拟目录</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">            <span class="comment">// 重定向：跳转到selectAllServlet，可以跳转到服务器内、外部资源，不能进行数据共享</span></span><br><span class="line">            response.sendRedirect(contextPath+<span class="string">&quot;/selectAllServlet&quot;</span>);</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 这里其实可以直接在request域中添加数据，然后请求转发到selectAllServlet，再从request域中拿数据</span></span><br><span class="line"><span class="comment">             * 这里用重定向是为了巩固Session的使用，存储到Session是为了保证用户数据安全</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 登录失败，存储错误信息到request</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;login_msg&quot;</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">            <span class="comment">// 请求转发：跳转到login.jsp，只能跳转到服务器内部资源，可以在转发的资源间使用request共享数据</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一定要理清楚登陆的逻辑：成功登录 + 登录失败</p>
</blockquote>
<p>(3.4)在<code>brand.jsp</code>中<code>&lt;body&gt;</code>标签下添加欢迎当前用户的提示信息:</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;h1&gt;$&#123;user.username&#125;,欢迎您&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p><strong>brand.jsp，其它商品内容不重要，重要的是EL表达式获取值</strong></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;com.mxeron.pojo.Brand&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%--XML低版本，需要添加这句后EL表达式才能生效！--%&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;$&#123;user.username&#125;,欢迎您&lt;/h1&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;新增&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">// 查询数据库</span></span><br><span class="line">    List&lt;Brand&gt; brands = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Brand&gt;();</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">1</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="string">&quot;三只松鼠&quot;</span>,<span class="number">100</span>,<span class="string">&quot;三只松鼠，好吃不上火&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">2</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="string">&quot;优衣库&quot;</span>,<span class="number">200</span>,<span class="string">&quot;优衣库，服适人生&quot;</span>,<span class="number">0</span>));</span><br><span class="line">    brands.add(<span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">3</span>,<span class="string">&quot;小米&quot;</span>,<span class="string">&quot;小米科技有限公司&quot;</span>,<span class="number">1000</span>,<span class="string">&quot;为发烧而生&quot;</span>,<span class="number">1</span>));</span><br><span class="line">%&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span> width=<span class="string">&quot;800&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;企业名称&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;排序&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;品牌介绍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;状态&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; brands.size(); i++) &#123;</span><br><span class="line">            <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> brands.get(i);</span><br><span class="line">    %&gt;</span><br><span class="line"></span><br><span class="line">    &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getId()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getBrandName()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getCompanyName()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getOrdered()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getDescription()%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;%=brand.getStatus() == <span class="number">1</span> ? <span class="string">&quot;启用&quot;</span>:<span class="string">&quot;禁用&quot;</span>%&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;修改&lt;/a&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">    &lt;%</span><br><span class="line">        &#125;</span><br><span class="line">    %&gt;</span><br><span class="line"></span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>JavaWeb中有<strong>四大域对象</strong>，分别是：</p>
<ul>
<li>page：当前页面有效</li>
<li>request：当前请求有效</li>
<li>session：当前会话有效</li>
<li>application：当前应用有效</li>
</ul>
<p><strong>EL 表达式获取数据，会依次从这4个域中寻找，从page开始到application，直到找到为止，</strong> 而这四个域对象的作用范围如下图所示：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/image-20210818152857407.png" width=40%></div>

<p>例如： ${brands}，el 表达式获取数据，会先从page域对象中获取数据，如果没有再到 requet 域对象中获取数据，如果再没有再到 session 域对象中获取，如果还没有才会到 application 中获取数据。</p>
<p>(3.5)修改<code>login.jsp</code>，将<code>错误信息使用EL表达式来获取</code></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">修改前内容:&lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;用户名或密码不正确&lt;/div&gt;</span><br><span class="line">修改后内容:&lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>(4)启动，访问测试</p>
<p>(4.1) 进入登录页面，输入错误的用户名或密码</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629445376407.png" width=80%></div>

<p>(4.2)输入正确的用户和密码信息</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629445415216.png" width=80%></div>

<p><strong>小结</strong></p>
<ul>
<li>在LoginServlet中，将登录成功的用户数据存入session中，方法在列表页面中获取当前登录用户信息进行展示</li>
<li>在LoginServlet中，将登录失败的错误信息存入到request中，如果存入到session中就会出现这次会话的所有请求都有登录失败的错误信息，这个是不需要的，所以不用存入到session中</li>
</ul>
<p><strong>相关资源补充</strong></p>
<p>Brand.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Brand</span> &#123;</span><br><span class="line">    <span class="comment">// id 主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">// 品牌名称</span></span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line">    <span class="comment">// 企业名称</span></span><br><span class="line">    <span class="keyword">private</span> String companyName;</span><br><span class="line">    <span class="comment">// 排序字段</span></span><br><span class="line">    <span class="keyword">private</span> Integer ordered;</span><br><span class="line">    <span class="comment">// 描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">// 状态：0：禁用  1：启用</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">(Integer id, String brandName, String companyName, String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Brand</span><span class="params">(Integer id, String brandName, String companyName, Integer ordered, String description, Integer status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">        <span class="built_in">this</span>.ordered = ordered;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrandName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBrandName</span><span class="params">(String brandName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brandName = brandName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCompanyName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompanyName</span><span class="params">(String companyName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getOrdered</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrdered</span><span class="params">(Integer ordered)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ordered = ordered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(String description)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(Integer status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Brand&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, brandName=&#x27;&quot;</span> + brandName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, companyName=&#x27;&quot;</span> + companyName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, ordered=&quot;</span> + ordered +</span><br><span class="line">                <span class="string">&quot;, description=&#x27;&quot;</span> + description + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, status=&quot;</span> + status +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BrandService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandService</span> &#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//调用BrandMapper.selectAll()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        List&lt;Brand&gt; brands = mapper.selectAll();</span><br><span class="line"></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> brands;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Brand brand)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        mapper.add(brand);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Brand <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">        <span class="comment">//调用BrandMapper.selectAll()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> mapper.selectById(id);</span><br><span class="line"></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Brand brand)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">        <span class="type">BrandMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        mapper.update(brand);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BrandMapper.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BrandMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_brand&quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;brandResultMap&quot;)</span></span><br><span class="line">    List&lt;Brand&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into tb_brand values(null,#&#123;brandName&#125;,#&#123;companyName&#125;,#&#123;ordered&#125;,#&#123;description&#125;,#&#123;status&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Brand brand)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_brand where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;brandResultMap&quot;)</span></span><br><span class="line">    Brand <span class="title function_">selectById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;update tb_brand set brand_name = #&#123;brandName&#125;,company_name = #&#123;companyName&#125;,ordered = #&#123;ordered&#125;,description = #&#123;description&#125;,status = #&#123;status&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Brand brand)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BrandMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mxeron.mapper.BrandMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;brandResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 完成数据库列名到java实体类属性名的映射，不论是使用注解sql，还是在xml下编写sql语句都需要完成名字的映射（如果名字不相同时需要） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;brand_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;brandName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;company_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;companyName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>selectAllServlet.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/selectAllServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectAllServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BrandService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        //1. 调用BrandService完成查询</span></span><br><span class="line"><span class="comment">//        List&lt;Brand&gt; brands = service.selectAll();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 存入request域中</span></span><br><span class="line"><span class="comment">//        request.setAttribute(&quot;brands&quot;,brands);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 为了简便，brand.jsp的数据是写死的</span></span><br><span class="line">        <span class="comment">//3. 请求转发到brand.jsp</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 只考虑传递user值的话，由于其存储在session中，所以请求转发和重定向都可以</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/brand.jsp&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>请求转发可以在转发的资源间使用request共享数据，是将数据存储在request域中</li>
<li>session完成一次会话多次请求之间的数据共享，是将数据存储在session域中</li>
</ul>
<blockquote>
<p>同时还需要知道四个域的含义和作用范围</p>
</blockquote>
<h4 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h4><div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220817171011.png" width=80%></div>

<ul>
<li>当出现上面的错误时，需要看下sql映射文件中是否将数据库中列名映射为了相应java实体类的属性名</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220817173827.png" width=40%></div>

<ul>
<li>当出现上面的错误时，说明没有识别出EL表达式，<strong>检查一下web.xml中的版本是多少，如果是2.3及以下的版本，需要在jsp页面中增加这个指令&lt;%@ page isELIgnored&#x3D;”false”%&gt;才可以识别EL表达式</strong></li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/20220817175344.png" width=80%></div>

<ul>
<li>上面这个错误和上上个错误一样，都是因为EL表达式没有被识别，解决方法也是一样的</li>
</ul>
<blockquote>
<p>注意：对于EL表达式获取值，在查找完所有域空间后都没找到相应的属性值时，则<strong>不会显示该值(为空白)</strong></p>
</blockquote>
<h4 id="记住我-设置Cookie"><a href="#记住我-设置Cookie" class="headerlink" title="记住我-设置Cookie"></a>记住我-设置Cookie</h4><p><strong>1. 需求</strong></p>
<p>如果用户勾选”记住用户”，则下次访问登陆页面自动填充用户名密码，这样可以提升用户的体验：</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629445835281.png" width=80%></div>

<p><strong>对应上面这个需求，最大的问题就是: 如何自动填充用户名和密码？</strong></p>
<p><strong>2. 实现流程分析</strong></p>
<p>因为<code>记住我</code>功能要实现的效果是，就算用户把浏览器<strong>关闭过几天再来访问也能自动填充</strong>，所以需要将登陆信息存入一个可以长久保存，并且能够在浏览器关闭重新启动后依然有效的地方，就是前面讲的<strong>Cookie，利用Cookie可以持久化存储的特性</strong>，所以:</p>
<ul>
<li><p>将用户名和密码写入Cookie中，并且持久化存储Cookie，下次访问浏览器会自动携带Cookie</p>
</li>
<li><p>在页面获取Cookie数据后，设置到用户名和密码框中</p>
</li>
<li><p><strong>何时写入Cookie?</strong></p>
<ul>
<li>用户必须登陆成功后才需要写</li>
<li>用户必须在登录页面勾选了<code>记住我</code>的复选框</li>
<li>以上两个同时满足时才将用户名+密码写入Cookie</li>
</ul>
</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629446248511.png" width=60%></div>

<p>(1)前端需要在发送请求和数据的时候，多携带一个用户是否勾选<code>Remember</code>的数据</p>
<p>(2)LoginServlet获取到数据后，调用Service完成用户名和密码的判定</p>
<p>(3)登录成功，并且用户在前端勾选了<code>记住我</code>，需要往Cookie中写入用户名和密码的数据，并设置Cookie存活时间</p>
<p>(4)设置成功后，将数据响应给前端</p>
<p><strong>3. 具体实现</strong></p>
<p>(1)在login.jsp为复选框设置值</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;login&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/login.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;loginDiv&quot;</span> style=<span class="string">&quot;height: 350px&quot;</span>&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/brand-demo/loginServlet&quot;</span> method=<span class="string">&quot;post&quot;</span> id=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">&quot;loginMsg&quot;</span>&gt;LOGIN IN&lt;/h1&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br><span class="line">        &lt;p&gt;Username:&lt;input id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> type=<span class="string">&quot;text&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Password:&lt;input id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> type=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Remember:&lt;input id=<span class="string">&quot;remember&quot;</span> name=<span class="string">&quot;remember&quot;</span> value=<span class="string">&quot;1&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;!-- 记住我的复选框 --&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;subDiv&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;login up&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;reset&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;reset&quot;</span>&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">            &lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>(2)在LoginServlet获取复选框的值并在登录成功后进行设置Cookie</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/loginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 获取用户名和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取复选框数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">remember</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remember&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service查询</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> service.login(username, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 判断</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//登录成功，跳转到查询所有的BrandServlet</span></span><br><span class="line">            <span class="comment">//判断用户是否勾选记住我，字符串写前面是为了避免出现空指针异常</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;on&quot;</span>.equals(remember))&#123;</span><br><span class="line">                <span class="comment">//勾选了，发送Cookie</span></span><br><span class="line">                <span class="comment">//1. 创建Cookie对象</span></span><br><span class="line">                <span class="type">Cookie</span> <span class="variable">c_username</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">                <span class="type">Cookie</span> <span class="variable">c_password</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;password&quot;</span>,password);</span><br><span class="line">                <span class="comment">// 设置Cookie的存活时间</span></span><br><span class="line">                c_username.setMaxAge( <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>);</span><br><span class="line">                c_password.setMaxAge( <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>);</span><br><span class="line">                <span class="comment">//2. 发送</span></span><br><span class="line">                response.addCookie(c_username);</span><br><span class="line">                response.addCookie(c_password);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将登陆成功后的user对象，存储到session</span></span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">            response.sendRedirect(contextPath+<span class="string">&quot;/selectAllServlet&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 登录失败，存储错误信息到request</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;login_msg&quot;</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 跳转到login.jsp</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3)启动访问测试</p>
<p>只有当前用户名和密码输入正确，并且勾选了Remeber的复选框，在响应头中才可以看得cookie的相关数据</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629447232217.png" width=80%></div>

<h4 id="记住我-获取Cookie"><a href="#记住我-获取Cookie" class="headerlink" title="记住我-获取Cookie"></a>记住我-获取Cookie</h4><p><strong>1. 需求分析</strong></p>
<p>登录成功并勾选了Remeber后，后端返回给前端的Cookie数据就已经存储好了，接下来就需要在页面获取Cookie中的数据，并把数据设置到登录页面的用户名和密码框中。</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629449100282.png" width=50%></div>

<p>如何在页面直接获取Cookie中的值呢?</p>
<p><strong>2. 实现流程分析</strong></p>
<p>在页面可以使用EL表达式，${cookie.key.value}，cookie特指浏览器中存储的cookie</p>
<p>key:指的是存储在cookie中的键名称</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629449234735.png" width=80%></div>

<p>(1)在login.jsp用户名的表单输入框使用value值给表单元素添加默认值，value可以使用<code>$&#123;cookie.username.value&#125;</code></p>
<p>(2)在login.jsp密码的表单输入框使用value值给表单元素添加默认值，value可以使用<code>$&#123;cookie.password.value&#125;</code></p>
<p><strong>3. 具体实现</strong></p>
<p>(1)修改login.jsp页面</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;login&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/login.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;loginDiv&quot;</span> style=<span class="string">&quot;height: 350px&quot;</span>&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/brand-demo/loginServlet&quot;</span> method=<span class="string">&quot;post&quot;</span> id=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">&quot;loginMsg&quot;</span>&gt;LOGIN IN&lt;/h1&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br><span class="line">        &lt;p&gt;Username:&lt;input id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;$&#123;cookie.username.value&#125;&quot;</span> type=<span class="string">&quot;text&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;Password:&lt;input id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;$&#123;cookie.password.value&#125;&quot;</span> type=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Remember:&lt;input id=<span class="string">&quot;remember&quot;</span> name=<span class="string">&quot;remember&quot;</span> value=<span class="string">&quot;1&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;subDiv&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;login up&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;reset&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;reset&quot;</span>&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">            &lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>4. 访问测试，重新访问登录页面，就可以看得用户和密码已经被填充</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629449530886.png" width=80%></div>

<h4 id="用户注册功能"><a href="#用户注册功能" class="headerlink" title="用户注册功能"></a>用户注册功能</h4><p><strong>1. 需求</strong></p>
<ul>
<li>注册功能：保存用户信息到数据库</li>
<li>验证码功能<ul>
<li>展示验证码：展示验证码图片，并可以点击切换</li>
<li>校验验证码：验证码填写不正确，则注册失败</li>
</ul>
</li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629449648793.png" width=30%></div>

<p><strong>2. 实现流程分析</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629449720005.png" width=80%></div>

<p>(1)前端通过表单发送请求和数据给Web层的RegisterServlet</p>
<p>(2)在RegisterServlet中接收请求和数据[用户名和密码]</p>
<p>(3)RegisterServlet接收到请求和数据后，调用Service层完成用户信息的保存</p>
<p>(4)在Service层需要编写UserService类，在类中实现register方法，需要判断用户是否已经存在，如果不存在，则完成用户数据的保存</p>
<p>(5)在UserMapper接口中，声明两个方法，一个是根据用户名查询用户信息方法，另一个是保存用户信息方法</p>
<p>(6)在UserService类中保存成功则返回true，失败则返回false,将数据返回给Web层</p>
<p>(7)Web层获取到结果后，如果返回的是true,则提示<code>注册成功</code>，并转发到登录页面，如果返回false则提示<code>用户名已存在</code>并转发到注册页面</p>
<p><strong>3. 具体实现</strong></p>
<p>(1)Dao层代码参考资料中的内容完成</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名和密码查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">select</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username, <span class="meta">@Param(&quot;password&quot;)</span>  String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into tb_user values(null,#&#123;username&#125;,#&#123;password&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2)编写Service层代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">//1.使用工具类获取SqlSessionFactory</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">register</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取UserMapper</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//4. 判断用户名是否存在</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> mapper.selectByUsername(user.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(u == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 用户名不存在，注册</span></span><br><span class="line">            mapper.add(user);</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125;</span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> u == <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3)完成页面和Web层的代码编写</p>
<p>(3.1)将register.html内容修改成register.jsp</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;欢迎注册&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/register.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=<span class="string">&quot;form-div&quot;</span>&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;reg-content&quot;</span>&gt;</span><br><span class="line">        &lt;h1&gt;欢迎注册&lt;/h1&gt;</span><br><span class="line">        &lt;span&gt;已有帐号？&lt;/span&gt; &lt;a href=<span class="string">&quot;login.html&quot;</span>&gt;登录&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 关键是这里的action！ --&gt;</span><br><span class="line">    &lt;form id=<span class="string">&quot;reg-form&quot;</span> action=<span class="string">&quot;/brand-demo/registerServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;table&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">                &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">                    &lt;input name=<span class="string">&quot;username&quot;</span> type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">                    &lt;br&gt;</span><br><span class="line">                    &lt;span id=<span class="string">&quot;username_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span> style=<span class="string">&quot;display:none&quot;</span>&gt;用户名不太受欢迎&lt;/span&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;密码&lt;/td&gt;</span><br><span class="line">                &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">                    &lt;input name=<span class="string">&quot;password&quot;</span> type=<span class="string">&quot;password&quot;</span> id=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">                    &lt;br&gt;</span><br><span class="line">                    &lt;span id=<span class="string">&quot;password_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span> style=<span class="string">&quot;display:none&quot;</span>&gt;密码格式有误&lt;/span&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;验证码&lt;/td&gt;</span><br><span class="line">                &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">                    &lt;input name=<span class="string">&quot;checkCode&quot;</span> type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;checkCode&quot;</span>&gt;</span><br><span class="line">                    &lt;img src=<span class="string">&quot;imgs/a.jpg&quot;</span>&gt;</span><br><span class="line">                    &lt;a href=<span class="string">&quot;#&quot;</span> id=<span class="string">&quot;changeImg&quot;</span>&gt;看不清？&lt;/a&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;buttons&quot;</span>&gt;</span><br><span class="line">            &lt;input value=<span class="string">&quot;注 册&quot;</span> type=<span class="string">&quot;submit&quot;</span> id=<span class="string">&quot;reg_btn&quot;</span>&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;br class=<span class="string">&quot;clear&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>(3.2)编写RegisterServlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/registerServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">       <span class="comment">//1. 获取用户名和密码数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service 注册</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> service.register(user);</span><br><span class="line">        <span class="comment">//3. 判断注册成功与否</span></span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">             <span class="comment">//注册功能，跳转登陆页面</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;注册成功，请登录&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//注册失败，跳转到注册页面</span></span><br><span class="line"></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3.3)需要在页面上展示后台返回的错误信息，需要修改register.jsp</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">修改前:&lt;span id=<span class="string">&quot;username_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span> style=<span class="string">&quot;display:none&quot;</span>&gt;用户名不太受欢迎&lt;/span&gt;</span><br><span class="line">修改后:&lt;span id=<span class="string">&quot;username_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span>&gt;$&#123;register_msg&#125;&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>(3.4)如果注册成功，需要把成功信息展示在登录页面，所以也需要修改login.jsp</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">修改前:&lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br><span class="line">修改后:&lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125; $&#123;register_msg&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>(3.5)修改login.jsp，将注册跳转地址修改为register.jsp</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">修改前：&lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">修改后: &lt;a href=<span class="string">&quot;register.jsp&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>(3.6)启动测试，</p>
<p>如果是注册的用户信息已经存在:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629451535605.png" width=50%></div>

<p>如果注册的用户信息不存在，注册成功:</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629451567428.png" width=70%></div>

<h4 id="验证码-展示"><a href="#验证码-展示" class="headerlink" title="验证码-展示"></a>验证码-展示</h4><p><strong>1. 需求分析</strong></p>
<p>展示验证码：展示验证码图片，并可以点击切换</p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629451646831.png" width=80%></div>

<h4 id="验证码工具类"><a href="#验证码工具类" class="headerlink" title="验证码工具类"></a>验证码工具类</h4><p>验证码的生成是通过工具类来实现的，具体的工具类参考：<code>CheckCodeUtil.java</code></p>
<p>CheckCodeUtil.java：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.geom.AffineTransform;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成验证码工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckCodeUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VERIFY_CODES</span> <span class="operator">=</span> <span class="string">&quot;123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出随机验证码图片流,并返回验证码值（一般传入输出流，响应response页面端，Web项目用的较多）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">outputVerifyImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, OutputStream os, <span class="type">int</span> verifySize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> generateVerifyCode(verifySize);</span><br><span class="line">        outputImage(w, h, os, verifyCode);</span><br><span class="line">        <span class="keyword">return</span> verifyCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用系统默认字符源生成验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize 验证码长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateVerifyCode</span><span class="params">(<span class="type">int</span> verifySize)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> generateVerifyCode(verifySize, VERIFY_CODES);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用指定源生成验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize 验证码长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sources    验证码字符源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateVerifyCode</span><span class="params">(<span class="type">int</span> verifySize, String sources)</span> &#123;</span><br><span class="line">        <span class="comment">// 未设定展示源的字码，赋默认值大写字母+数字</span></span><br><span class="line">        <span class="keyword">if</span> (sources == <span class="literal">null</span> || sources.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            sources = VERIFY_CODES;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">codesLen</span> <span class="operator">=</span> sources.length();</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>(System.currentTimeMillis());</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">verifyCode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(verifySize);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; verifySize; i++) &#123;</span><br><span class="line">            verifyCode.append(sources.charAt(rand.nextInt(codesLen - <span class="number">1</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> verifyCode.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机验证码文件,并返回验证码值 (生成图片形式，用的较少)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">outputVerifyImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, File outputFile, <span class="type">int</span> verifySize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> generateVerifyCode(verifySize);</span><br><span class="line">        outputImage(w, h, outputFile, verifyCode);</span><br><span class="line">        <span class="keyword">return</span> verifyCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成指定验证码图像文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">outputImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, File outputFile, String code)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (outputFile == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> outputFile.getParentFile();</span><br><span class="line">        <span class="comment">//文件不存在</span></span><br><span class="line">        <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">            <span class="comment">//创建</span></span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            outputFile.createNewFile();</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outputFile);</span><br><span class="line">            outputImage(w, h, fos, code);</span><br><span class="line">            fos.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出指定验证码图片流</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">outputImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, OutputStream os, String code)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">verifySize</span> <span class="operator">=</span> code.length();</span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedImage</span>(w, h, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2</span> <span class="operator">=</span> image.createGraphics();</span><br><span class="line">        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建颜色集合，使用java.awt包下的类</span></span><br><span class="line">        Color[] colors = <span class="keyword">new</span> <span class="title class_">Color</span>[<span class="number">5</span>];</span><br><span class="line">        Color[] colorSpaces = <span class="keyword">new</span> <span class="title class_">Color</span>[]&#123;Color.WHITE, Color.CYAN,</span><br><span class="line">                Color.GRAY, Color.LIGHT_GRAY, Color.MAGENTA, Color.ORANGE,</span><br><span class="line">                Color.PINK, Color.YELLOW&#125;;</span><br><span class="line">        <span class="type">float</span>[] fractions = <span class="keyword">new</span> <span class="title class_">float</span>[colors.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; colors.length; i++) &#123;</span><br><span class="line">            colors[i] = colorSpaces[rand.nextInt(colorSpaces.length)];</span><br><span class="line">            fractions[i] = rand.nextFloat();</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.sort(fractions);</span><br><span class="line">        <span class="comment">// 设置边框色</span></span><br><span class="line">        g2.setColor(Color.GRAY);</span><br><span class="line">        g2.fillRect(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">        <span class="type">Color</span> <span class="variable">c</span> <span class="operator">=</span> getRandColor(<span class="number">200</span>, <span class="number">250</span>);</span><br><span class="line">        <span class="comment">// 设置背景色</span></span><br><span class="line">        g2.setColor(c);</span><br><span class="line">        g2.fillRect(<span class="number">0</span>, <span class="number">2</span>, w, h - <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制干扰线</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="comment">// 设置线条的颜色</span></span><br><span class="line">        g2.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(w - <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(h - <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">xl</span> <span class="operator">=</span> random.nextInt(<span class="number">6</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">yl</span> <span class="operator">=</span> random.nextInt(<span class="number">12</span>) + <span class="number">1</span>;</span><br><span class="line">            g2.drawLine(x, y, x + xl + <span class="number">40</span>, y + yl + <span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加噪点</span></span><br><span class="line">        <span class="comment">// 噪声率</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">yawpRate</span> <span class="operator">=</span> <span class="number">0.05f</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">area</span> <span class="operator">=</span> (<span class="type">int</span>) (yawpRate * w * h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; area; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(w);</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(h);</span><br><span class="line">            <span class="comment">// 获取随机颜色</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rgb</span> <span class="operator">=</span> getRandomIntColor();</span><br><span class="line">            image.setRGB(x, y, rgb);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加图片扭曲</span></span><br><span class="line">        shear(g2, w, h, c);</span><br><span class="line"></span><br><span class="line">        g2.setColor(getRandColor(<span class="number">100</span>, <span class="number">160</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">fontSize</span> <span class="operator">=</span> h - <span class="number">4</span>;</span><br><span class="line">        <span class="type">Font</span> <span class="variable">font</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;Algerian&quot;</span>, Font.ITALIC, fontSize);</span><br><span class="line">        g2.setFont(font);</span><br><span class="line">        <span class="type">char</span>[] chars = code.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; verifySize; i++) &#123;</span><br><span class="line">            <span class="type">AffineTransform</span> <span class="variable">affine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AffineTransform</span>();</span><br><span class="line">            affine.setToRotation(Math.PI / <span class="number">4</span> * rand.nextDouble() * (rand.nextBoolean() ? <span class="number">1</span> : -<span class="number">1</span>), (w / verifySize) * i + fontSize / <span class="number">2</span>, h / <span class="number">2</span>);</span><br><span class="line">            g2.setTransform(affine);</span><br><span class="line">            g2.drawChars(chars, i, <span class="number">1</span>, ((w - <span class="number">10</span>) / verifySize) * i + <span class="number">5</span>, h / <span class="number">2</span> + fontSize / <span class="number">2</span> - <span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        g2.dispose();</span><br><span class="line">        ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, os);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机颜色</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fc</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bc</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Color <span class="title function_">getRandColor</span><span class="params">(<span class="type">int</span> fc, <span class="type">int</span> bc)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">            fc = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">            bc = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="type">int</span> <span class="variable">g</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>(r, g, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getRandomIntColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] rgb = getRandomRgb();</span><br><span class="line">        <span class="type">int</span> <span class="variable">color</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> c : rgb) &#123;</span><br><span class="line">            color = color &lt;&lt; <span class="number">8</span>;</span><br><span class="line">            color = color | c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] getRandomRgb() &#123;</span><br><span class="line">        <span class="type">int</span>[] rgb = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            rgb[i] = random.nextInt(<span class="number">255</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rgb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shear</span><span class="params">(Graphics g, <span class="type">int</span> w1, <span class="type">int</span> h1, Color color)</span> &#123;</span><br><span class="line">        shearX(g, w1, h1, color);</span><br><span class="line">        shearY(g, w1, h1, color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shearX</span><span class="params">(Graphics g, <span class="type">int</span> w1, <span class="type">int</span> h1, Color color)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">period</span> <span class="operator">=</span> random.nextInt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">borderGap</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">frames</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">phase</span> <span class="operator">=</span> random.nextInt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; h1; i++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> (<span class="type">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    * Math.sin((<span class="type">double</span>) i / (<span class="type">double</span>) period</span><br><span class="line">                    + (<span class="number">6.2831853071795862D</span> * (<span class="type">double</span>) phase)</span><br><span class="line">                    / (<span class="type">double</span>) frames);</span><br><span class="line">            g.copyArea(<span class="number">0</span>, i, w1, <span class="number">1</span>, (<span class="type">int</span>) d, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine((<span class="type">int</span>) d, i, <span class="number">0</span>, i);</span><br><span class="line">                g.drawLine((<span class="type">int</span>) d + w1, i, w1, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shearY</span><span class="params">(Graphics g, <span class="type">int</span> w1, <span class="type">int</span> h1, Color color)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">period</span> <span class="operator">=</span> random.nextInt(<span class="number">40</span>) + <span class="number">10</span>; <span class="comment">// 50;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">borderGap</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">frames</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">phase</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; w1; i++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> (<span class="type">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    * Math.sin((<span class="type">double</span>) i / (<span class="type">double</span>) period</span><br><span class="line">                    + (<span class="number">6.2831853071795862D</span> * (<span class="type">double</span>) phase)</span><br><span class="line">                    / (<span class="type">double</span>) frames);</span><br><span class="line">            g.copyArea(i, <span class="number">0</span>, <span class="number">1</span>, h1, <span class="number">0</span>, (<span class="type">int</span>) d);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine(i, (<span class="type">int</span>) d, i, <span class="number">0</span>);</span><br><span class="line">                g.drawLine(i, (<span class="type">int</span>) d + h1, i, h1);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在该工具类中编写main方法进行测试:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//生成验证码的图片位置</span></span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;d://a.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//checkCode为最终验证码的数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> CheckCodeUtil.outputVerifyImage(<span class="number">100</span>, <span class="number">50</span>, fos, <span class="number">4</span>);</span><br><span class="line">    System.out.println(checkCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>生成完验证码以后，我们就可以知晓:</p>
<ul>
<li>验证码就是使用Java代码生成的一张图片</li>
<li>验证码的作用:防止机器自动注册，攻击服务器</li>
</ul>
<p><strong>2. 实现流程分析</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629452623289.png" width=60%></div>

<p>(1)前端发送请求给CheckCodeServlet</p>
<p>(2)CheckCodeServlet接收到请求后，<strong>生成验证码图片，将图片用Reponse对象的输出流写回到前端</strong></p>
<p><strong>思考:如何将图片写回到前端浏览器呢?</strong></p>
<p>(1)Java中已经有工具类生成验证码图片，测试类中只是把图片生成到磁盘上<br>(2)<strong>生成磁盘的过程中使用的是OutputStream流，如何把这个图片生成在页面呢?</strong><br>(3)前面在将Reponse对象的时候，它有一个方法<strong>可以获取其字节输出流，getOutputStream()</strong><br>(4)综上所述，我们<strong>可以把写往磁盘的流对象更换成Response的字节流，即可完成图片响应给前端</strong></p>
<p><strong>3. 具体实现</strong></p>
<p>(1)修改Register.jsp页面，将验证码的图片从后台获取</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;验证码&lt;/td&gt;</span><br><span class="line">        &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">        &lt;input name=<span class="string">&quot;checkCode&quot;</span> type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;checkCode&quot;</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">&quot;checkCodeImg&quot;</span> src=<span class="string">&quot;/brand-demo/checkCodeServlet&quot;</span>&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;#&quot;</span> id=<span class="string">&quot;changeImg&quot;</span> &gt;看不清？&lt;/a&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    document.getElementById(<span class="string">&quot;changeImg&quot;</span>).onclick = function () &#123;</span><br><span class="line">       	<span class="comment">// 路径后面添加时间戳的目的是避免浏览器进行缓存静态资源</span></span><br><span class="line">        <span class="comment">// 如果路径固定，会因为浏览器缓存验证码，而导致无法更换验证码</span></span><br><span class="line">        document.getElementById(<span class="string">&quot;checkCodeImg&quot;</span>).src = <span class="string">&quot;/brand-demo/checkCodeServlet?&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>().getMilliseconds();</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>(2)编写CheckCodeServlet类，用来接收请求生成验证码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/checkCodeServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> CheckCodeUtil.outputVerifyImage(<span class="number">100</span>, <span class="number">50</span>, os, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="验证码-校验"><a href="#验证码-校验" class="headerlink" title="验证码-校验"></a>验证码-校验</h4><p><strong>1. 需求分析</strong></p>
<ul>
<li>判断程序生成的验证码 和 用户输入的验证码 是否一样，如果不一样，则阻止注册</li>
<li><strong>验证码图片访问和提交注册表单是两次请求(获取图片一次 + 提交注册表单进行比对一次)，所以要将程序生成的验证码存入Session中</strong></li>
</ul>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629452835571.png" width=80%></div>

<p><strong>思考:为什么要把验证码数据存入到Session中呢?</strong></p>
<ul>
<li><strong>生成验证码和校验验证码是两次请求，此处就需要在一个会话的两次请求之间共享数据</strong></li>
<li>验证码属于<strong>安全数据类</strong>的，所以我们选中Session来存储验证码数据。</li>
</ul>
<p><strong>2. 实现流程分析</strong></p>
<div align="center"><img src="https://for-my-picgo.oss-cn-chengdu.aliyuncs.com/blogs/pictures/1629452966499.png" width=80%></div>

<p>(1)在CheckCodeServlet中生成验证码的时候，将验证码数据存入Session对象</p>
<p>(2)前端将验证码和注册数据提交到后台，交给RegisterServlet类</p>
<p>(3)RegisterServlet类接收到请求和数据后，其中就有验证码，和Session中的验证码进行对比</p>
<p>(4)如果一致，则完成注册，如果不一致，则提示错误信息</p>
<p><strong>3. 具体实现</strong></p>
<p>(1)修改CheckCodeServlet类，将验证码存入Session对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/checkCodeServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 浏览器每次请求servlet时，都会执行一次service方法</span></span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> CheckCodeUtil.outputVerifyImage(<span class="number">100</span>, <span class="number">50</span>, os, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 存入Session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;checkCodeGen&quot;</span>,checkCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2)在RegisterServlet中，获取页面的和session对象中的验证码，进行对比</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/registerServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">       <span class="comment">//1. 获取用户名和密码数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取用户输入的验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;checkCode&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 程序生成的验证码，从Session获取</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCodeGen</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;checkCodeGen&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 比对验证码的值</span></span><br><span class="line">        <span class="keyword">if</span>(!checkCodeGen.equalsIgnoreCase(checkCode))&#123;</span><br><span class="line">            <span class="comment">// equalsIgnoreCase() 方法用于将字符串与指定的对象比较，不考虑大小写</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(request,response);</span><br><span class="line">            <span class="comment">// 不允许注册</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2. 调用service 注册</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> service.register(user);</span><br><span class="line">        <span class="comment">//3. 判断注册成功与否</span></span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">             <span class="comment">//注册功能，跳转登陆页面</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;注册成功，请登录&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//注册失败，跳转到注册页面</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>验证码功能的实现需要明白如何通过访问servlet将图片回显到浏览器上</p>
]]></content>
      <categories>
        <category>JavaWeb</category>
        <category>会话</category>
      </categories>
      <tags>
        <tag>会话</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/2022/08/17/JavaWeb/Filter&amp;Listener&amp;Ajax/</url>
    <content><![CDATA[<h3 id="Filter-amp-Listener-amp-Ajax"><a href="#Filter-amp-Listener-amp-Ajax" class="headerlink" title="Filter&amp;Listener&amp;Ajax"></a>Filter&amp;Listener&amp;Ajax</h3><ul>
<li>能够使用 Filter 完成登陆状态校验功能</li>
<li>能够使用 axios 发送 ajax 请求</li>
<li>熟悉 json 格式，并能使用 Fastjson 完成 java 对象和 json 串的相互转换</li>
<li>使用 axios + json 完成综合案例</li>
</ul>
<h2 id="1，Filter"><a href="#1，Filter" class="headerlink" title="1，Filter"></a>1，Filter</h2><h3 id="1-1-Filter概述"><a href="#1-1-Filter概述" class="headerlink" title="1.1  Filter概述"></a>1.1  Filter概述</h3><p>Filter 表示过滤器，是 JavaWeb 三大组件(Servlet、Filter、Listener)之一。Servlet 我们之前都已经学习过了，Filter和Listener 我们今天都会进行学习。</p>
<p>过滤器可以把对资源的请求&#x3D;&#x3D;拦截&#x3D;&#x3D;下来，从而实现一些特殊的功能。</p>
<p>如下图所示，浏览器可以访问服务器上的所有的资源（servlet、jsp、html等）</p>
<img src="assets/image-20210823184519509.png" alt="image-20210823184519509" style="zoom:50%;" />

<p>而在访问到这些资源之前可以使过滤器拦截来下，也就是说在访问资源之前会先经过 Filter，如下图</p>
<img src="assets/image-20210823184657328.png" alt="image-20210823184657328" style="zoom:57%;" />

<p>拦截器拦截到后可以做什么功能呢？</p>
<p>&#x3D;&#x3D;过滤器一般完成一些通用的操作。&#x3D;&#x3D;比如每个资源都要写一些代码完成某个功能，我们总不能在每个资源中写这样的代码吧，而此时我们可以将这些代码写在过滤器中，因为请求每一个资源都要经过过滤器。</p>
<p>我们之前做的品牌数据管理的案例中就已经做了登陆的功能，而如果我们不登录能不能访问到数据呢？我们可以在浏览器直接访问首页 ，可以看到 <code>查询所有</code> 的超链接</p>
<img src="assets/image-20210823185720197.png" alt="image-20210823185720197" style="zoom:70%;" />

<p>当我点击该按钮，居然可以看到品牌的数据</p>
<img src="assets/image-20210823185932418.png" alt="image-20210823185932418" style="zoom:70%;" />

<p>这显然和我们的要求不符。我们希望实现的效果是用户如果登陆过了就跳转到品牌数据展示的页面；如果没有登陆就跳转到登陆页面让用户进行登陆，要实现这个效果需要在每一个资源中都写上这段逻辑，而像这种通用的操作，我们就可以放在过滤器中进行实现。这个就是&#x3D;&#x3D;权限控制&#x3D;&#x3D;，以后我们还会进行细粒度权限控制。过滤器还可以做 <code>统一编码处理</code>、 <code>敏感字符处理</code> 等等…</p>
<h3 id="1-2-Filter快速入门"><a href="#1-2-Filter快速入门" class="headerlink" title="1.2  Filter快速入门"></a>1.2  Filter快速入门</h3><h4 id="1-2-1-开发步骤"><a href="#1-2-1-开发步骤" class="headerlink" title="1.2.1  开发步骤"></a>1.2.1  开发步骤</h4><p>进行 <code>Filter</code> 开发分成以下三步实现</p>
<ul>
<li><p>定义类，实现 Filter接口，并重写其所有方法</p>
<img src="assets/image-20210823191006878.png" alt="image-20210823191006878" style="zoom:60%;" />
</li>
<li><p>配置Filter拦截资源的路径：在类上定义 <code>@WebFilter</code> 注解。而注解的 <code>value</code> 属性值 <code>/*</code> 表示拦截所有的资源</p>
<img src="assets/image-20210823191037163.png" alt="image-20210823191037163" style="zoom:67%;" />
</li>
<li><p>在doFilter方法中输出一句话，并放行</p>
<img src="assets/image-20210823191200201.png" alt="image-20210823191200201" style="zoom:60%;" />

<blockquote>
<p>上述代码中的 <code>chain.doFilter(request,response);</code> 就是放行，也就是让其访问本该访问的资源。</p>
</blockquote>
</li>
</ul>
<h4 id="1-2-2-代码演示"><a href="#1-2-2-代码演示" class="headerlink" title="1.2.2  代码演示"></a>1.2.2  代码演示</h4><p>创建一个项目，项目下有一个 <code>hello.jsp</code> 页面，项目结构如下：</p>
<img src="assets/image-20210823191855765.png" alt="image-20210823191855765" style="zoom:80%;" />

<p><code>pom.xml</code> 配置文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>filter-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>80<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>hello.jsp</code> 页面内容如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;hello JSP~&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>我们现在在浏览器输入 <code>http://localhost/filter-demo/hello.jsp</code> 访问 <code>hello.jsp</code> 页面，这里是可以访问到 <code>hello.jsp</code> 页面内容的。</p>
<img src="assets/image-20210823192353031.png" alt="image-20210823192353031" style="zoom:67%;" />

<p>接下来编写过滤器。过滤器是 Web 三大组件之一，所以我们将 <code>filter</code> 创建在 <code>com.itheima.web.filter</code> 包下，起名为 <code>FilterDemo</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterDemo</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;FilterDemo...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>重启启动服务器，再次重新访问 <code>hello.jsp</code> 页面，这次发现页面没有任何效果，但是在 <code>idea</code> 的控制台可以看到如下内容</p>
<img src="assets/image-20210823193759365.png" alt="image-20210823193759365" style="zoom:70%;" />

<p>上述效果说明 <code>FilterDemo</code> 这个过滤器的 <code>doFilter()</code> 方法执行了，但是为什么在浏览器上看不到 <code>hello.jsp</code> 页面的内容呢？这是因为在 <code>doFilter()</code> 方法中添加放行的方法才能访问到 <code>hello.jsp</code> 页面。那就在 <code>doFilter()</code> 方法中添加放行的代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//放行</span></span><br><span class="line"> chain.doFilter(request,response);</span><br></pre></td></tr></table></figure>

<p>再次重启服务器并访问 <code>hello.jsp</code> 页面，发现这次就可以在浏览器上看到页面效果。</p>
<p><strong><code>FilterDemo</code> 过滤器完整代码如下：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterDemo</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1.FilterDemo...&quot;</span>);</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        chain.doFilter(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-3-Filter执行流程"><a href="#1-3-Filter执行流程" class="headerlink" title="1.3  Filter执行流程"></a>1.3  Filter执行流程</h3><img src="assets/image-20210823194830074.png" alt="image-20210823194830074" style="zoom:70%;" />

<p>如上图是使用过滤器的流程，我们通过以下问题来研究过滤器的执行流程：</p>
<ul>
<li><p>放行后访问对应资源，资源访问完成后，还会回到Filter中吗？</p>
<p>从上图就可以看出肯定 &#x3D;&#x3D;会&#x3D;&#x3D; 回到Filter中</p>
</li>
<li><p>如果回到Filter中，是重头执行还是执行放行后的逻辑呢？</p>
<p>如果是重头执行的话，就意味着 <code>放行前逻辑</code> 会被执行两次，肯定不会这样设计了；所以访问完资源后，会回到 <code>放行后逻辑</code>，执行该部分代码。</p>
</li>
</ul>
<p>通过上述的说明，我们就可以总结Filter的执行流程如下：</p>
<img src="assets/image-20210823195434581.png" alt="image-20210823195434581" style="zoom:70%;" />

<p>接下来我们通过代码验证一下，在 <code>doFilter()</code> 方法前后都加上输出语句，如下</p>
<img src="assets/image-20210823195828596.png" alt="image-20210823195828596" style="zoom:70%;" />

<p>同时在 <code>hello.jsp</code> 页面加上输出语句，如下</p>
<img src="assets/image-20210823200028284.png" alt="image-20210823200028284" style="zoom:70%;" />

<p>执行访问该资源打印的顺序是按照我们标记的标号进行打印的话，说明我们上边总结出来的流程是没有问题的。启动服务器访问 <code>hello.jsp</code> 页面，在控制台打印的内容如下：</p>
<img src="assets/image-20210823200202153.png" alt="image-20210823200202153" style="zoom:80%;" />

<p>以后我们可以将对请求进行处理的代码放在放行之前进行处理，而如果请求完资源后还要对响应的数据进行处理时可以在放行后进行逻辑处理。</p>
<h3 id="1-4-Filter拦截路径配置"><a href="#1-4-Filter拦截路径配置" class="headerlink" title="1.4  Filter拦截路径配置"></a>1.4  Filter拦截路径配置</h3><p>拦截路径表示 Filter 会对请求的哪些资源进行拦截，使用 <code>@WebFilter</code> 注解进行配置。如：<code>@WebFilter(&quot;拦截路径&quot;)</code> </p>
<p>拦截路径有如下四种配置方式：</p>
<ul>
<li>拦截具体的资源：&#x2F;index.jsp：只有访问index.jsp时才会被拦截</li>
<li>目录拦截：&#x2F;user&#x2F;*：访问&#x2F;user下的所有资源，都会被拦截</li>
<li>后缀名拦截：*.jsp：访问后缀名为jsp的资源，都会被拦截</li>
<li>拦截所有：&#x2F;*：访问所有资源，都会被拦截</li>
</ul>
<p>通过上面拦截路径的学习，大家会发现拦截路径的配置方式和 <code>Servlet</code> 的请求资源路径配置方式一样，但是表示的含义不同。</p>
<h3 id="1-5-过滤器链"><a href="#1-5-过滤器链" class="headerlink" title="1.5  过滤器链"></a>1.5  过滤器链</h3><h4 id="1-5-1-概述"><a href="#1-5-1-概述" class="headerlink" title="1.5.1  概述"></a>1.5.1  概述</h4><p>过滤器链是指在一个Web应用，可以配置多个过滤器，这多个过滤器称为过滤器链。</p>
<p>如下图就是一个过滤器链，我们学习过滤器链主要是学习过滤器链执行的流程</p>
<img src="assets/image-20210823215835812.png" alt="image-20210823215835812" style="zoom:70%;" />

<p>上图中的过滤器链执行是按照以下流程执行：</p>
<ol>
<li>执行 <code>Filter1</code> 的放行前逻辑代码</li>
<li>执行 <code>Filter1</code> 的放行代码</li>
<li>执行 <code>Filter2</code> 的放行前逻辑代码</li>
<li>执行 <code>Filter2</code> 的放行代码</li>
<li>访问到资源</li>
<li>执行 <code>Filter2</code> 的放行后逻辑代码</li>
<li>执行 <code>Filter1</code> 的放行后逻辑代码</li>
</ol>
<p>以上流程串起来就像一条链子，故称之为过滤器链。</p>
<h4 id="1-5-2-代码演示"><a href="#1-5-2-代码演示" class="headerlink" title="1.5.2  代码演示"></a>1.5.2  代码演示</h4><ul>
<li><p>编写第一个过滤器 <code>FilterDemo</code> ，配置成拦截所有资源</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterDemo</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 放行前，对 request数据进行处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1.FilterDemo...&quot;</span>);</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        chain.doFilter(request,response);</span><br><span class="line">        <span class="comment">//2. 放行后，对Response 数据进行处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;3.FilterDemo...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写第二个过滤器 <code>FilterDemo2</code> ，配置炒年糕拦截所有资源</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterDemo2</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 放行前，对 request数据进行处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;2.FilterDemo...&quot;</span>);</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        chain.doFilter(request,response);</span><br><span class="line">        <span class="comment">//2. 放行后，对Response 数据进行处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;4.FilterDemo...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 <code>hello.jsp</code> 页面中脚本的输出语句</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;hello JSP~&lt;/h1&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        System.out.println(<span class="string">&quot;3.hello jsp&quot;</span>);</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务器，在浏览器输入 <code>http://localhost/filter-demo/hello.jsp</code> 进行测试，在控制台打印内容如下</p>
<img src="assets/image-20210823221222468.png" alt="image-20210823221222468" style="zoom:70%;" />



<p>从结果可以看到确实是按照我们之前说的执行流程进行执行的。</p>
</li>
</ul>
<h4 id="1-5-3-问题"><a href="#1-5-3-问题" class="headerlink" title="1.5.3  问题"></a>1.5.3  问题</h4><p>上面代码中为什么是先执行 <code>FilterDemo</code> ，后执行 <code>FilterDemo2</code> 呢？</p>
<p>我们现在使用的是注解配置Filter，而这种配置方式的优先级是按照过滤器类名(字符串)的自然排序。</p>
<p>比如有如下两个名称的过滤器 ： <code>BFilterDemo</code> 和 <code>AFilterDemo</code> 。那一定是 <code>AFilterDemo</code> 过滤器先执行。</p>
<h3 id="1-6-案例"><a href="#1-6-案例" class="headerlink" title="1.6  案例"></a>1.6  案例</h3><h4 id="1-6-1-需求"><a href="#1-6-1-需求" class="headerlink" title="1.6.1  需求"></a>1.6.1  需求</h4><p>访问服务器资源时，需要先进行登录验证，如果没有登录，则自动跳转到登录页面</p>
<h4 id="1-6-2-分析"><a href="#1-6-2-分析" class="headerlink" title="1.6.2  分析"></a>1.6.2  分析</h4><p>我们要实现该功能是在每一个资源里加入登陆状态校验的代码吗？显然是不需要的，只需要写一个 <code>Filter</code> ，在该过滤器中进行登陆状态校验即可。而在该 <code>Filter</code> 中逻辑如下：</p>
<img src="assets/image-20210823223214525.png" alt="image-20210823223214525" style="zoom:70%;" />

<h4 id="1-6-3-代码实现"><a href="#1-6-3-代码实现" class="headerlink" title="1.6.3  代码实现"></a>1.6.3  代码实现</h4><h5 id="1-6-3-1-创建Filter"><a href="#1-6-3-1-创建Filter" class="headerlink" title="1.6.3.1  创建Filter"></a>1.6.3.1  创建Filter</h5><p>在 <code>brand-demo</code> 工程创建 <code>com.itheima.web.filter</code>  包，在该下创建名为 <code>LoginFilter</code> 的过滤器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-6-3-2-编写逻辑代码"><a href="#1-6-3-2-编写逻辑代码" class="headerlink" title="1.6.3.2  编写逻辑代码"></a>1.6.3.2  编写逻辑代码</h5><p>在 <code>doFilter()</code> 方法中编写登陆状态校验的逻辑代码。</p>
<p>我们首先需要从 <code>session</code> 对象中获取用户信息，但是 <code>ServletRequest</code> 类型的 requset 对象没有获取 session 对象的方法，所以此时需要将 request对象强转成 <code>HttpServletRequest</code> 对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br></pre></td></tr></table></figure>

<p>然后完成以下逻辑</p>
<ul>
<li>获取Session对象</li>
<li>从Session对象中获取名为 <code>user</code> 的数据</li>
<li>判断获取到的数据是否是 null<ul>
<li>如果不是，说明已经登陆，放行</li>
<li>如果是，说明尚未登陆，将提示信息存储到域对象中并跳转到登陆页面</li>
</ul>
</li>
</ul>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">   </span><br><span class="line">        <span class="comment">//1. 判断session中是否有user</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 判断user是否为null</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 登录过了</span></span><br><span class="line">            <span class="comment">//放行</span></span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 没有登陆，存储提示信息，跳转到登录页面</span></span><br><span class="line"></span><br><span class="line">            req.setAttribute(<span class="string">&quot;login_msg&quot;</span>,<span class="string">&quot;您尚未登陆！&quot;</span>);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(req,response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-6-3-3-测试并抛出问题"><a href="#1-6-3-3-测试并抛出问题" class="headerlink" title="1.6.3.3  测试并抛出问题"></a>1.6.3.3  测试并抛出问题</h5><p>在浏览器上输入 <code>http://localhost:8080/brand-demo/</code> ，可以看到如下页面效果</p>
<img src="assets/image-20210823224843179.png" alt="image-20210823224843179" style="zoom:60%;" />

<p>从上面效果可以看出没有登陆确实是跳转到登陆页面了，但是登陆页面为什么展示成这种效果了呢？</p>
<h5 id="1-6-3-4-问题分析及解决"><a href="#1-6-3-4-问题分析及解决" class="headerlink" title="1.6.3.4  问题分析及解决"></a>1.6.3.4  问题分析及解决</h5><p>因为登陆页面需要 <code>css/login.css</code> 这个文件进行样式的渲染，下图是登陆页面引入的css文件图解</p>
<img src="assets/image-20210823225411925.png" alt="image-20210823225411925" style="zoom:70%;" />

<p>而在请求这个css资源时被过滤器拦截，就相当于没有加载到样式文件导致的。解决这个问题，只需要对所以的登陆相关的资源进行放行即可。还有一种情况就是当我没有用户信息时需要进行注册，而注册时也希望被过滤器放行。</p>
<p>综上，我们需要在判断session中是否包含用户信息之前，应该加上对登陆及注册相关资源放行的逻辑处理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//判断访问资源路径是否和登录注册相关</span></span><br><span class="line"><span class="comment">//1,在数组中存储登陆和注册相关的资源路径</span></span><br><span class="line">String[] urls = &#123;<span class="string">&quot;/login.jsp&quot;</span>,<span class="string">&quot;/imgs/&quot;</span>,<span class="string">&quot;/css/&quot;</span>,<span class="string">&quot;/loginServlet&quot;</span>,<span class="string">&quot;/register.jsp&quot;</span>,<span class="string">&quot;/registerServlet&quot;</span>,<span class="string">&quot;/checkCodeServlet&quot;</span>&#125;;</span><br><span class="line"><span class="comment">//2,获取当前访问的资源路径</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURL().toString(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//3,遍历数组，获取到每一个需要放行的资源路径</span></span><br><span class="line"><span class="keyword">for</span> (String u : urls) &#123;</span><br><span class="line">    <span class="comment">//4,判断当前访问的资源路径字符串是否包含要放行的的资源路径字符串</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	比如当前访问的资源路径是  /brand-demo/login.jsp</span></span><br><span class="line"><span class="comment">    	而字符串 /brand-demo/login.jsp 包含了  字符串 /login.jsp ，所以这个字符串就需要放行</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span>(url.contains(u))&#123;</span><br><span class="line">        <span class="comment">//找到了，放行</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">        <span class="comment">//break;</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-6-3-5-过滤器完整代码"><a href="#1-6-3-5-过滤器完整代码" class="headerlink" title="1.6.3.5  过滤器完整代码"></a>1.6.3.5  过滤器完整代码</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//判断访问资源路径是否和登录注册相关</span></span><br><span class="line">        <span class="comment">//1,在数组中存储登陆和注册相关的资源路径</span></span><br><span class="line">        String[] urls = &#123;<span class="string">&quot;/login.jsp&quot;</span>,<span class="string">&quot;/imgs/&quot;</span>,<span class="string">&quot;/css/&quot;</span>,<span class="string">&quot;/loginServlet&quot;</span>,<span class="string">&quot;/register.jsp&quot;</span>,<span class="string">&quot;/registerServlet&quot;</span>,<span class="string">&quot;/checkCodeServlet&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">//2,获取当前访问的资源路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURL().toString(); </span><br><span class="line"></span><br><span class="line">        <span class="comment">//3,遍历数组，获取到每一个需要放行的资源路径</span></span><br><span class="line">        <span class="keyword">for</span> (String u : urls) &#123;</span><br><span class="line">            <span class="comment">//4,判断当前访问的资源路径字符串是否包含要放行的的资源路径字符串</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                比如当前访问的资源路径是  /brand-demo/login.jsp</span></span><br><span class="line"><span class="comment">                而字符串 /brand-demo/login.jsp 包含了  字符串 /login.jsp ，所以这个字符串就需要放行</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">if</span>(url.contains(u))&#123;</span><br><span class="line">                <span class="comment">//找到了，放行</span></span><br><span class="line">                chain.doFilter(request, response);</span><br><span class="line">                <span class="comment">//break;</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">        <span class="comment">//1. 判断session中是否有user</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 判断user是否为null</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 登录过了</span></span><br><span class="line">            <span class="comment">//放行</span></span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 没有登陆，存储提示信息，跳转到登录页面</span></span><br><span class="line"></span><br><span class="line">            req.setAttribute(<span class="string">&quot;login_msg&quot;</span>,<span class="string">&quot;您尚未登陆！&quot;</span>);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(req,response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2，Listener"><a href="#2，Listener" class="headerlink" title="2，Listener"></a>2，Listener</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1  概述"></a>2.1  概述</h3><ul>
<li><p>Listener 表示监听器，是 JavaWeb 三大组件(Servlet、Filter、Listener)之一。</p>
</li>
<li><p>监听器可以监听就是在 <code>application</code>，<code>session</code>，<code>request</code> 三个对象创建、销毁或者往其中添加修改删除属性时自动执行代码的功能组件。</p>
<p>request 和 session 我们学习过。而 <code>application</code> 是 <code>ServletContext</code> 类型的对象。</p>
<p><code>ServletContext</code> 代表整个web应用，在服务器启动的时候，tomcat会自动创建该对象。在服务器关闭时会自动销毁该对象。</p>
</li>
</ul>
<h3 id="2-2-分类"><a href="#2-2-分类" class="headerlink" title="2.2  分类"></a>2.2  分类</h3><p>JavaWeb 提供了8个监听器：</p>
<img src="assets/image-20210823230820586.png" alt="image-20210823230820586" style="zoom:80%;" />

<p>这里面只有 <code>ServletContextListener</code> 这个监听器后期我们会接触到，<code>ServletContextListener</code> 是用来监听 <code>ServletContext</code> 对象的创建和销毁。</p>
<p><code>ServletContextListener</code> 接口中有以下两个方法</p>
<ul>
<li><code>void contextInitialized(ServletContextEvent sce)</code>：<code>ServletContext</code> 对象被创建了会自动执行的方法</li>
<li><code>void contextDestroyed(ServletContextEvent sce)</code>：<code>ServletContext</code> 对象被销毁时会自动执行的方法</li>
</ul>
<h3 id="2-3-代码演示"><a href="#2-3-代码演示" class="headerlink" title="2.3  代码演示"></a>2.3  代码演示</h3><p>我们只演示一下 <code>ServletContextListener</code> 监听器</p>
<ul>
<li>定义一个类，实现<code>ServletContextListener</code> 接口</li>
<li>重写所有的抽象方法</li>
<li>使用 <code>@WebListener</code> 进行配置</li>
</ul>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextLoaderListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        <span class="comment">//加载资源</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ContextLoaderListener...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动服务器，就可以在启动的日志信息中看到 <code>contextInitialized()</code> 方法输出的内容，同时也说明了 <code>ServletContext</code> 对象在服务器启动的时候被创建了。</p>
<h2 id="3，Ajax"><a href="#3，Ajax" class="headerlink" title="3，Ajax"></a>3，Ajax</h2><h3 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1  概述"></a>3.1  概述</h3><p>&#x3D;&#x3D;<code>AJAX</code> (Asynchronous JavaScript And XML)：异步的 JavaScript 和 XML。&#x3D;&#x3D;</p>
<p>我们先来说概念中的 <code>JavaScript</code> 和 <code>XML</code>，<code>JavaScript</code> 表明该技术和前端相关；<code>XML</code> 是指以此进行数据交换。而这两个我们之前都学习过。</p>
<h4 id="3-1-1-作用"><a href="#3-1-1-作用" class="headerlink" title="3.1.1  作用"></a>3.1.1  作用</h4><p>AJAX 作用有以下两方面：</p>
<ol>
<li><strong>与服务器进行数据交换</strong>：通过AJAX可以给服务器发送请求，服务器将数据直接响应回给浏览器。如下图</li>
</ol>
<p>我们先来看之前做功能的流程，如下图：</p>
<img src="assets/image-20210823235114367.png" alt="image-20210823235114367" style="zoom:70%;" />

<p>如上图，<code>Servlet</code> 调用完业务逻辑层后将数据存储到域对象中，然后跳转到指定的 <code>jsp</code> 页面，在页面上使用 <code>EL表达式</code> 和 <code>JSTL</code> 标签库进行数据的展示。</p>
<p>而我们学习了AJAX 后，就可以&#x3D;&#x3D;使用AJAX和服务器进行通信，以达到使用 HTML+AJAX来替换JSP页面&#x3D;&#x3D;了。如下图，浏览器发送请求servlet，servlet 调用完业务逻辑层后将数据直接响应回给浏览器页面，页面使用 HTML 来进行数据展示。</p>
<img src="assets/image-20210823235006847.png" alt="image-20210823235006847" style="zoom:70%;" />

<ol start="2">
<li><strong>异步交互</strong>：可以在&#x3D;&#x3D;不重新加载整个页面&#x3D;&#x3D;的情况下，与服务器交换数据并&#x3D;&#x3D;更新部分网页&#x3D;&#x3D;的技术，如：搜索联想、用户名是否可用校验，等等…</li>
</ol>
<img src="assets/image-20210824000706401.png" alt="image-20210824000706401" style="zoom:80%;" />

<p>上图所示的效果我们经常见到，在我们输入一些关键字（例如 <code>奥运</code>）后就会在下面联想出相关的内容，而联想出来的这部分数据肯定是存储在百度的服务器上，而我们并没有看出页面重新刷新，这就是 &#x3D;&#x3D;更新局部页面&#x3D;&#x3D; 的效果。再如下图：</p>
<img src="assets/image-20210824001015706.png" alt="image-20210824001015706" style="zoom:80%;" />

<p>我们在用户名的输入框输入用户名，当输入框一失去焦点，如果用户名已经被占用就会在下方展示提示的信息；在这整个过程中也没有页面的刷新，只是在局部展示出了提示信息，这就是 &#x3D;&#x3D;更新局部页面&#x3D;&#x3D; 的效果。</p>
<h4 id="3-1-2-同步和异步"><a href="#3-1-2-同步和异步" class="headerlink" title="3.1.2  同步和异步"></a>3.1.2  同步和异步</h4><p>知道了局部刷新后，接下来我们再聊聊同步和异步:</p>
<ul>
<li>同步发送请求过程如下</li>
</ul>
<img src="assets/image-20210824001443897.png" alt="image-20210824001443897" style="zoom:80%;" />

<p>​	浏览器页面在发送请求给服务器，在服务器处理请求的过程中，浏览器页面不能做其他的操作。只能等到服务器响应结束后才能，浏览器页面才能继续做其他的操作。</p>
<ul>
<li><p>异步发送请求过程如下</p>
<img src="assets/image-20210824001608916.png" alt="image-20210824001608916" style="zoom:80%;" />

<p>浏览器页面发送请求给服务器，在服务器处理请求的过程中，浏览器页面还可以做其他的操作。</p>
</li>
</ul>
<h3 id="3-2-快速入门"><a href="#3-2-快速入门" class="headerlink" title="3.2  快速入门"></a>3.2  快速入门</h3><h4 id="3-2-1-服务端实现"><a href="#3-2-1-服务端实现" class="headerlink" title="3.2.1 服务端实现"></a>3.2.1 服务端实现</h4><p>在项目的创建 <code>com.itheima.web.servlet</code> ，并在该包下创建名为  <code>AjaxServlet</code> 的servlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/ajaxServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AjaxServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 响应数据</span></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;hello ajax~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-客户端实现"><a href="#3-2-2-客户端实现" class="headerlink" title="3.2.2  客户端实现"></a>3.2.2  客户端实现</h4><p>在 <code>webapp</code> 下创建名为 <code>01-ajax-demo1.html</code> 的页面，在该页面书写 <code>ajax</code> 代码</p>
<ul>
<li><p>创建核心对象，不同的浏览器创建的对象是不同的</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">var</span> xhttp;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123;</span><br><span class="line">    xhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// code for IE6, IE5</span></span><br><span class="line">    xhttp = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">xhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:8080/ajax-demo/ajaxServlet&quot;</span>);</span><br><span class="line"><span class="comment">//发送请求</span></span><br><span class="line">xhttp.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取响应</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">xhttp.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 通过 this.responseText 可以获取到服务端响应的数据</span></span><br><span class="line">        <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>完整代码如下：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 创建核心对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> xhttp;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        xhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// code for IE6, IE5</span></span></span><br><span class="line"><span class="language-javascript">        xhttp = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//2. 发送请求</span></span></span><br><span class="line"><span class="language-javascript">    xhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:8080/ajax-demo/ajaxServlet&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    xhttp.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//3. 获取响应</span></span></span><br><span class="line"><span class="language-javascript">    xhttp.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-测试"><a href="#3-2-3-测试" class="headerlink" title="3.2.3  测试"></a>3.2.3  测试</h4><p>在浏览器地址栏输入 <code>http://localhost:8080/ajax-demo/01-ajax-demo1.html</code> ，在 <code>01-ajax-demo1.html</code>加载的时候就会发送 <code>ajax</code> 请求，效果如下</p>
<img src="assets/image-20210824005956117.png" alt="image-20210824005956117" style="zoom:67%;" />

<p>我们可以通过 <code>开发者模式</code> 查看发送的 AJAX 请求。在浏览器上按 <code>F12</code> 快捷键</p>
<img src="assets/image-20210824010247642.png" alt="image-20210824010247642" style="zoom:80%;" />

<p>这个是查看所有的请求，如果我们只是想看 异步请求的话，点击上图中 <code>All</code> 旁边的 <code>XHR</code>，会发现只展示 Type 是 <code>xhr</code> 的请求。如下图：</p>
<img src="assets/image-20210824010438260.png" alt="image-20210824010438260" style="zoom:80%;" /> 

<h3 id="3-3-案例"><a href="#3-3-案例" class="headerlink" title="3.3 案例"></a>3.3 案例</h3><p>需求：在完成用户注册时，当用户名输入框失去焦点时，校验用户名是否在数据库已存在</p>
<img src="assets/image-20210824201415745.png" alt="image-20210824201415745" style="zoom:60%;" />

<h4 id="3-3-1-分析"><a href="#3-3-1-分析" class="headerlink" title="3.3.1  分析"></a>3.3.1  分析</h4><ul>
<li><strong>前端完成的逻辑</strong><ol>
<li>给用户名输入框绑定光标失去焦点事件 <code>onblur</code></li>
<li>发送 ajax请求，携带username参数</li>
<li>处理响应：是否显示提示信息</li>
</ol>
</li>
<li><strong>后端完成的逻辑</strong><ol>
<li>接收用户名</li>
<li>调用service查询User。此案例是为了演示前后端异步交互，所以此处我们不做业务逻辑处理</li>
<li>返回标记</li>
</ol>
</li>
</ul>
<p>整体流程如下：</p>
<img src="assets/image-20210829183854285.png" alt="image-20210829183854285" style="zoom:80%;" />

<h4 id="3-3-2-后端实现"><a href="#3-3-2-后端实现" class="headerlink" title="3.3.2  后端实现"></a>3.3.2  后端实现</h4><p>在 <code>com.ithiema.web.servlet</code> 包中定义名为 <code>SelectUserServlet</code>  的servlet。代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/selectUserServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectUserServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 接收用户名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 调用service查询User对象，此处不进行业务逻辑处理，直接给 flag 赋值为 true，表明用户名占用</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//3. 响应标记</span></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;&quot;</span> + flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-前端实现"><a href="#3-3-3-前端实现" class="headerlink" title="3.3.3  前端实现"></a>3.3.3  前端实现</h4><p>将 <code>04-资料\1. 验证用户名案例\1. 静态页面</code> 下的文件整体拷贝到项目下 <code>webapp</code> 下。并在 <code>register.html</code> 页面的 <code>body</code> 结束标签前编写 <code>script</code> 标签，在该标签中实现如下逻辑</p>
<p><strong>第一步：给用户名输入框绑定光标失去焦点事件 <code>onblur</code></strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 给用户名输入框绑定 失去焦点事件</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username&quot;</span>).<span class="property">onblur</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>第二步：发送 ajax请求，携带username参数</strong></p>
<p>在 <code>第一步</code> 绑定的匿名函数中书写发送 ajax 请求的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//2. 发送ajax请求</span></span><br><span class="line"><span class="comment">//2.1. 创建核心对象</span></span><br><span class="line"><span class="keyword">var</span> xhttp;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123;</span><br><span class="line">    xhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// code for IE6, IE5</span></span><br><span class="line">    xhttp = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.2. 发送请求</span></span><br><span class="line">xhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:8080/ajax-demo/selectUserServlet);</span></span><br><span class="line"><span class="string">xhttp.send();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//2.3. 获取响应</span></span><br><span class="line"><span class="string">xhttp.onreadystatechange = function() &#123;</span></span><br><span class="line"><span class="string">    if (this.readyState == 4 &amp;&amp; this.status == 200) &#123;</span></span><br><span class="line"><span class="string">        //处理响应的结果</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure>

<p>由于我们发送的是 GET 请求，所以需要在 URL 后拼接从输入框获取的用户名数据。而我们在 <code>第一步</code> 绑定的匿名函数中通过以下代码可以获取用户名数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取用户名的值</span></span><br><span class="line"><span class="keyword">var</span> username = <span class="variable language_">this</span>.<span class="property">value</span>;  <span class="comment">//this ： 给谁绑定的事件，this就代表谁</span></span><br></pre></td></tr></table></figure>

<p>而携带数据需要将 URL 修改为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">xhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:8080/ajax-demo/selectUserServlet?username=&quot;</span>+username);</span><br></pre></td></tr></table></figure>

<p><strong>第三步：处理响应：是否显示提示信息</strong></p>
<p>当 <code>this.readyState == 4 &amp;&amp; this.status == 200</code> 条件满足时，说明已经成功响应数据了。</p>
<p>此时需要判断响应的数据是否是 “true” 字符串，如果是说明用户名已经占用给出错误提示；如果不是说明用户名未被占用清除错误提示。代码如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">responseText</span> == <span class="string">&quot;true&quot;</span>)&#123;</span><br><span class="line">    <span class="comment">//用户名存在，显示提示信息</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username_err&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//用户名不存在 ，清楚提示信息</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username_err&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>综上所述，前端完成代码如下：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 给用户名输入框绑定 失去焦点事件</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username&quot;</span>).<span class="property">onblur</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//2. 发送ajax请求</span></span><br><span class="line">    <span class="comment">// 获取用户名的值</span></span><br><span class="line">    <span class="keyword">var</span> username = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.1. 创建核心对象</span></span><br><span class="line">    <span class="keyword">var</span> xhttp;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123;</span><br><span class="line">        xhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// code for IE6, IE5</span></span><br><span class="line">        xhttp = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.2. 发送请求</span></span><br><span class="line">    xhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:8080/ajax-demo/selectUserServlet?username=&quot;</span>+username);</span><br><span class="line">    xhttp.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.3. 获取响应</span></span><br><span class="line">    xhttp.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">//alert(this.responseText);</span></span><br><span class="line">            <span class="comment">//判断</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">responseText</span> == <span class="string">&quot;true&quot;</span>)&#123;</span><br><span class="line">                <span class="comment">//用户名存在，显示提示信息</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username_err&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//用户名不存在 ，清楚提示信息</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username_err&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4，axios"><a href="#4，axios" class="headerlink" title="4，axios"></a>4，axios</h2><p>Axios 对原生的AJAX进行封装，简化书写。</p>
<p>Axios官网是：<code>https://www.axios-http.cn</code></p>
<h3 id="4-1-基本使用"><a href="#4-1-基本使用" class="headerlink" title="4.1  基本使用"></a>4.1  基本使用</h3><p>axios 使用是比较简单的，分为以下两步：</p>
<ul>
<li><p>引入 axios 的 js 文件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用axios 发送请求，并获取响应结果</p>
<ul>
<li><p>发送 get 请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo1/aJAXDemo1?username=zhangsan&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>)&#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送 post 请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo1/aJAXDemo1&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:<span class="string">&quot;username=zhangsan&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>)&#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><code>axios()</code> 是用来发送异步请求的，小括号中使用 js 对象传递请求相关的参数：</p>
<ul>
<li><code>method</code> 属性：用来设置请求方式的。取值为 <code>get</code> 或者 <code>post</code>。</li>
<li><code>url</code> 属性：用来书写请求的资源路径。如果是 <code>get</code> 请求，需要将请求参数拼接到路径的后面，格式为： <code>url?参数名=参数值&amp;参数名2=参数值2</code>。</li>
<li><code>data</code> 属性：作为请求体被发送的数据。也就是说如果是 <code>post</code> 请求的话，数据需要作为 <code>data</code> 属性的值。</li>
</ul>
<p><code>then()</code> 需要传递一个匿名函数。我们将 <code>then()</code> 中传递的匿名函数称为 &#x3D;&#x3D;回调函数&#x3D;&#x3D;，意思是该匿名函数在发送请求时不会被调用，而是在成功响应后调用的函数。而该回调函数中的 <code>resp</code> 参数是对响应的数据进行封装的对象，通过 <code>resp.data</code> 可以获取到响应的数据。</p>
<h3 id="4-2-快速入门"><a href="#4-2-快速入门" class="headerlink" title="4.2  快速入门"></a>4.2  快速入门</h3><h4 id="4-2-1-后端实现"><a href="#4-2-1-后端实现" class="headerlink" title="4.2.1  后端实现"></a>4.2.1  后端实现</h4><p>定义一个用于接收请求的servlet，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/axiosServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AxiosServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;get...&quot;</span>);</span><br><span class="line">        <span class="comment">//1. 接收请求参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        <span class="comment">//2. 响应数据</span></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;hello Axios~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;post...&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-前端实现"><a href="#4-2-2-前端实现" class="headerlink" title="4.2.2  前端实现"></a>4.2.2  前端实现</h4><ul>
<li><p>引入 js 文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;js/axios-0.18.0.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送 ajax 请求</p>
<ul>
<li><p>get 请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet?username=zhangsan&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>post 请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:<span class="string">&quot;username=zhangsan&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><strong>整体页面代码如下：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. get</span></span></span><br><span class="line"><span class="language-javascript">   <span class="comment">/* axios(&#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        method:&quot;get&quot;,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        url:&quot;http://localhost:8080/ajax-demo/axiosServlet?username=zhangsan&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">    &#125;).then(function (resp) &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        alert(resp.data);</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">    &#125;)*/</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//2. post  在js中&#123;&#125; 表示一个js对象，而这个js对象中有三个属性</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">axios</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:<span class="string">&quot;username=zhangsan&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-请求方法别名"><a href="#4-3-请求方法别名" class="headerlink" title="4.3  请求方法别名"></a>4.3  请求方法别名</h3><p>为了方便起见， Axios 已经为所有支持的请求方法提供了别名。如下：</p>
<ul>
<li><p><code>get</code> 请求 ： <code>axios.get(url[,config])</code></p>
</li>
<li><p><code>delete</code> 请求 ： <code>axios.delete(url[,config])</code></p>
</li>
<li><p><code>head</code> 请求 ： <code>axios.head(url[,config])</code></p>
</li>
<li><p><code>options</code> 请求 ： <code>axios.option(url[,config])</code></p>
</li>
<li><p><code>post</code> 请求：<code>axios.post(url[,data[,config])</code></p>
</li>
<li><p><code>put</code> 请求：<code>axios.put(url[,data[,config])</code></p>
</li>
<li><p><code>patch</code> 请求：<code>axios.patch(url[,data[,config])</code></p>
</li>
</ul>
<p>而我们只关注 <code>get</code> 请求和 <code>post</code> 请求。</p>
<p>入门案例中的 <code>get</code> 请求代码可以改为如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet?username=zhangsan&quot;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>入门案例中的 <code>post</code> 请求代码可以改为如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet&quot;</span>,<span class="string">&quot;username=zhangsan&quot;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5，JSON"><a href="#5，JSON" class="headerlink" title="5，JSON"></a>5，JSON</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1  概述"></a>5.1  概述</h3><p>&#x3D;&#x3D;概念：<code>JavaScript Object Notation</code>。JavaScript 对象表示法.&#x3D;&#x3D;</p>
<p>如下是 <code>JavaScript</code> 对象的定义格式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">name</span>:<span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">	<span class="attr">age</span>:<span class="number">23</span>,</span><br><span class="line">	<span class="attr">city</span>:<span class="string">&quot;北京&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们再看看 <code>JSON</code> 的格式：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="string">&quot;北京&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>通过上面 js 对象格式和 json 格式进行对比，发现两个格式特别像。只不过 js 对象中的属性名可以使用引号（可以是单引号，也可以是双引号）；而 <code>json</code> 格式中的键要求必须使用双引号括起来，这是 <code>json</code> 格式的规定。<code>json</code> 格式的数据有什么作用呢？</p>
<p>作用：由于其语法格式简单，层次结构鲜明，现多用于作为&#x3D;&#x3D;数据载体&#x3D;&#x3D;，在网络中进行数据传输。如下图所示就是服务端给浏览器响应的数据，这个数据比较简单，如果现需要将 JAVA 对象中封装的数据响应回给浏览器的话，应该以何种数据传输呢？</p>
<img src="assets/image-20210830232718632.png" alt="image-20210830232718632" style="zoom:80%;" />

<p>大家还记得 <code>ajax</code> 的概念吗？ 是 &#x3D;&#x3D;异步的 JavaScript 和 xml&#x3D;&#x3D;。这里的 xml就是以前进行数据传递的方式，如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">student</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>23<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">city</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">city</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>再看 <code>json</code> 描述以上数据的写法：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>	</span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="string">&quot;北京&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>上面两种格式进行对比后就会发现 <code>json</code> 格式数据的简单，以及所占的字节数少等优点。</p>
<h3 id="5-2-JSON-基础语法"><a href="#5-2-JSON-基础语法" class="headerlink" title="5.2  JSON 基础语法"></a>5.2  JSON 基础语法</h3><h4 id="5-2-1-定义格式"><a href="#5-2-1-定义格式" class="headerlink" title="5.2.1  定义格式"></a>5.2.1  定义格式</h4><p><code>JSON</code> 本质就是一个字符串，但是该字符串内容是有一定的格式要求的。 定义格式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量名 = <span class="string">&#x27;&#123;&quot;key&quot;:value,&quot;key&quot;:value,...&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><code>JSON</code> 串的键要求必须使用双引号括起来，而值根据要表示的类型确定。value 的数据类型分为如下</p>
<ul>
<li>数字（整数或浮点数）</li>
<li>字符串（使用双引号括起来）</li>
<li>逻辑值（true或者false）</li>
<li>数组（在方括号中）</li>
<li>对象（在花括号中）</li>
<li>null</li>
</ul>
<p>示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonStr = <span class="string">&#x27;&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:23,&quot;addr&quot;:[&quot;北京&quot;,&quot;上海&quot;,&quot;西安&quot;]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2-2-代码演示"><a href="#5-2-2-代码演示" class="headerlink" title="5.2.2  代码演示"></a>5.2.2  代码演示</h4><p>创建一个页面，在该页面的 <code>&lt;script&gt;</code> 标签中定义json字符串</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 定义JSON字符串</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> jsonStr = <span class="string">&#x27;&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:23,&quot;addr&quot;:[&quot;北京&quot;,&quot;上海&quot;,&quot;西安&quot;]&#125;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(jsonStr);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过浏览器打开，页面效果如下图所示</p>
<img src="assets/image-20210831223339530.png" alt="image-20210831223339530" style="zoom:80%;" />

<p>现在我们需要获取到该 <code>JSON</code> 串中的 <code>name</code> 属性值，应该怎么处理呢？</p>
<p>如果它是一个 js 对象，我们就可以通过 <code>js对象.属性名</code> 的方式来获取数据。JS 提供了一个对象 <code>JSON</code> ，该对象有如下两个方法：</p>
<ul>
<li><code>parse(str)</code> ：将 JSON串转换为 js 对象。使用方式是： &#x3D;&#x3D;<code>var jsObject = JSON.parse(jsonStr);</code>&#x3D;&#x3D;</li>
<li><code>stringify(obj)</code> ：将 js 对象转换为 JSON 串。使用方式是：&#x3D;&#x3D;<code>var jsonStr = JSON.stringify(jsObject)</code>&#x3D;&#x3D;</li>
</ul>
<p>代码演示：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 定义JSON字符串</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> jsonStr = <span class="string">&#x27;&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:23,&quot;addr&quot;:[&quot;北京&quot;,&quot;上海&quot;,&quot;西安&quot;]&#125;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(jsonStr);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//2. 将 JSON 字符串转为 JS 对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> jsObject = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonStr);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(jsObject)</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(jsObject.<span class="property">name</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//3. 将 JS 对象转换为 JSON 字符串</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> jsonStr2 = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(jsObject);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(jsonStr2)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-发送异步请求携带参数"><a href="#5-2-3-发送异步请求携带参数" class="headerlink" title="5.2.3  发送异步请求携带参数"></a>5.2.3  发送异步请求携带参数</h4><p>后面我们使用 <code>axios</code> 发送请求时，如果要携带复杂的数据时都会以 <code>JSON</code> 格式进行传递，如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:<span class="string">&quot;username=zhangsan&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>请求参数不可能由我们自己拼接字符串吧？肯定不用，可以提前定义一个 js 对象，用来封装需要提交的参数，然后使用 <code>JSON.stringify(js对象)</code> 转换为 <code>JSON</code> 串，再将该 <code>JSON</code> 串作为 <code>axios</code> 的 <code>data</code> 属性值进行请求参数的提交。如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jsObject = &#123;<span class="attr">name</span>:<span class="string">&quot;张三&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(jsObject)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>而 <code>axios</code> 是一个很强大的工具。我们只需要将需要提交的参数封装成 js 对象，并将该 js 对象作为 <code>axios</code> 的 <code>data</code> 属性值进行，它会自动将 js 对象转换为 <code>JSON</code> 串进行提交。如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jsObject = &#123;<span class="attr">name</span>:<span class="string">&quot;张三&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/ajax-demo/axiosServlet&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:jsObject  <span class="comment">//这里 axios 会将该js对象转换为 json 串的</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(resp.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x3D;&#x3D;注意：&#x3D;&#x3D;</p>
<ul>
<li>js 提供的 <code>JSON</code> 对象我们只需要了解一下即可。因为 <code>axios</code> 会自动对 js 对象和 <code>JSON</code> 串进行想换转换。</li>
<li>发送异步请求时，如果请求参数是 <code>JSON</code> 格式，那请求方式必须是 <code>POST</code>。因为 <code>JSON</code> 串需要放在请求体中。</li>
</ul>
</blockquote>
<h3 id="5-3-JSON串和Java对象的相互转换"><a href="#5-3-JSON串和Java对象的相互转换" class="headerlink" title="5.3  JSON串和Java对象的相互转换"></a>5.3  JSON串和Java对象的相互转换</h3><p>学习完 json 后，接下来聊聊 json 的作用。以后我们会以 json 格式的数据进行前后端交互。前端发送请求时，如果是复杂的数据就会以 json 提交给后端；而后端如果需要响应一些复杂的数据时，也需要以 json 格式将数据响应回给浏览器。</p>
<img src="assets/image-20210831104901912.png" alt="image-20210831104901912" style="zoom:70%;" />

<p>在后端我们就需要重点学习以下两部分操作：</p>
<ul>
<li>请求数据：JSON字符串转为Java对象</li>
<li>响应数据：Java对象转为JSON字符串</li>
</ul>
<p>接下来给大家介绍一套 API，可以实现上面两部分操作。这套 API 就是 <code>Fastjson</code></p>
<h4 id="5-3-1-Fastjson-概述"><a href="#5-3-1-Fastjson-概述" class="headerlink" title="5.3.1  Fastjson 概述"></a>5.3.1  Fastjson 概述</h4><p><code>Fastjson</code> 是阿里巴巴提供的一个Java语言编写的高性能功能完善的 <code>JSON</code> 库，是目前Java语言中最快的 <code>JSON</code> 库，可以实现 <code>Java</code> 对象和 <code>JSON</code> 字符串的相互转换。</p>
<h4 id="5-3-2-Fastjson-使用"><a href="#5-3-2-Fastjson-使用" class="headerlink" title="5.3.2  Fastjson 使用"></a>5.3.2  Fastjson 使用</h4><p><code>Fastjson</code> 使用也是比较简单的，分为以下三步完成</p>
<ol>
<li><p><strong>导入坐标</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Java对象转JSON</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> JSON.toJSONString(obj);</span><br></pre></td></tr></table></figure>

<p>将 Java 对象转换为 JSON 串，只需要使用 <code>Fastjson</code> 提供的 <code>JSON</code> 类中的 <code>toJSONString()</code> 静态方法即可。</p>
</li>
<li><p><strong>JSON字符串转Java对象</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> JSON.parseObject(jsonStr, User.class);</span><br></pre></td></tr></table></figure>

<p>将 json 转换为 Java 对象，只需要使用 <code>Fastjson</code> 提供的 <code>JSON</code> 类中的 <code>parseObject()</code> 静态方法即可。</p>
</li>
</ol>
<h4 id="5-3-3-代码演示"><a href="#5-3-3-代码演示" class="headerlink" title="5.3.3  代码演示"></a>5.3.3  代码演示</h4><ul>
<li><p>引入坐标</p>
</li>
<li><p>创建一个类，专门用来测试 Java 对象和 JSON 串的相互转换，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastJsonDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//1. 将Java对象转为JSON字符串</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1</span>);</span><br><span class="line">        user.setUsername(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(user);</span><br><span class="line">        System.out.println(jsonString);<span class="comment">//&#123;&quot;id&quot;:1,&quot;password&quot;:&quot;123&quot;,&quot;username&quot;:&quot;zhangsan&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 将JSON字符串转为Java对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> JSON.parseObject(<span class="string">&quot;&#123;\&quot;id\&quot;:1,\&quot;password\&quot;:\&quot;123\&quot;,\&quot;username\&quot;:\&quot;zhangsan\&quot;&#125;&quot;</span>, User.class);</span><br><span class="line">        System.out.println(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="6，案例"><a href="#6，案例" class="headerlink" title="6，案例"></a>6，案例</h2><h3 id="6-1-需求"><a href="#6-1-需求" class="headerlink" title="6.1  需求"></a>6.1  需求</h3><p>使用Axios + JSON 完成品牌列表数据查询和添加。页面效果还是下图所示：</p>
<img src="assets/image-20210830234803335.png" alt="image-20210830234803335" style="zoom:60%;" />

<h3 id="6-2-查询所有功能"><a href="#6-2-查询所有功能" class="headerlink" title="6.2  查询所有功能"></a>6.2  查询所有功能</h3><p><img src="/assets/image-20210831085332612.png" alt="image-20210831085332612"></p>
<p>如上图所示就该功能的整体流程。前后端需以 JSON 格式进行数据的传递；由于此功能是查询所有的功能，前端发送 ajax 请求不需要携带参数，而后端响应数据需以如下格式的 json 数据</p>
<p><img src="/assets/image-20210831090839336.png" alt="image-20210831090839336"></p>
<h4 id="6-2-1-环境准备"><a href="#6-2-1-环境准备" class="headerlink" title="6.2.1  环境准备"></a>6.2.1  环境准备</h4><p>将 <code>02-AJAX\04-资料\3. 品牌列表案例\初始工程</code> 下的 <code>brand-demo</code> 工程拷贝到我们自己 <code>工作空间</code> ，然后再将项目导入到我们自己的 Idea 中。工程目录结构如下：</p>
<img src="assets/image-20210831091604457.png" alt="image-20210831091604457" style="zoom:80%;" />

<p>&#x3D;&#x3D;注意：&#x3D;&#x3D;</p>
<ul>
<li>在给定的原始工程中已经给定一些代码。而在此案例中我们只关注前后端交互代码实现</li>
<li>要根据自己的数据库环境去修改连接数据库的信息，在 <code>mybatis-config.xml</code> 核心配置文件中修改</li>
</ul>
<h4 id="6-2-2-后端实现"><a href="#6-2-2-后端实现" class="headerlink" title="6.2.2  后端实现"></a>6.2.2  后端实现</h4><p>在 <code>com.itheima.web</code> 包下创建名为 <code>SelectAllServlet</code> 的 <code>servlet</code>，具体的逻辑如下：</p>
<ul>
<li>调用 service 的 <code>selectAll()</code> 方法进行查询所有的逻辑处理</li>
<li>将查询到的集合数据转换为 json 数据。我们将此过程称为 &#x3D;&#x3D;序列化&#x3D;&#x3D;；如果是将 json 数据转换为 Java 对象，我们称之为 &#x3D;&#x3D;反序列化&#x3D;&#x3D;</li>
<li>将 json 数据响应回给浏览器。这里一定要设置响应数据的类型及字符集 <code>response.setContentType(&quot;text/json;charset=utf-8&quot;);</code></li>
</ul>
<p><code>SelectAllServlet</code> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/selectAllServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectAllServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BrandService</span> <span class="variable">brandService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 调用Service查询</span></span><br><span class="line">        List&lt;Brand&gt; brands = brandService.selectAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 将集合转换为JSON数据   序列化</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(brands);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 响应数据  application/json   text/json</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/json;charset=utf-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(jsonString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-2-3-前端实现"><a href="#6-2-3-前端实现" class="headerlink" title="6.2.3  前端实现"></a>6.2.3  前端实现</h4><ol>
<li><strong>引入 js 文件</strong></li>
</ol>
<p>在 <code>brand.html</code> 页面引入 <code>axios</code> 的 js 文件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>绑定 <code>页面加载完毕</code> 事件</strong></li>
</ol>
<p>在 <code>brand.html</code> 页面绑定加载完毕事件，该事件是在页面加载完毕后被触发，代码如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>发送异步请求</strong></li>
</ol>
<p>在页面加载完毕事件绑定的匿名函数中发送异步请求，代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//2. 发送ajax请求</span></span><br><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-demo/selectAllServlet&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>处理响应数据</strong></li>
</ol>
<p>在 <code>then</code> 中的回调函数中通过 <code>resp.data</code> 可以获取响应回来的数据，而数据格式如下</p>
<img src="assets/image-20210831093617083.png" alt="image-20210831093617083" style="zoom:80%;" />

<p>现在我们需要拼接字符串，将下面表格中的所有的 <code>tr</code> 拼接到一个字符串中，然后使用 <code>document.getElementById(&quot;brandTable&quot;).innerHTML = 拼接好的字符串</code>  就可以动态的展示出用户想看到的数据</p>
<img src="assets/image-20210831093938057.png" alt="image-20210831093938057" style="zoom:70%;" />

<p>而表头行是固定的，所以先定义初始值是表头行数据的字符串，如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取数据</span></span><br><span class="line"><span class="keyword">let</span> brands = resp.<span class="property">data</span>;</span><br><span class="line"><span class="keyword">let</span> tableData = <span class="string">&quot; &lt;tr&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;th&gt;序号&lt;/th&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;th&gt;品牌名称&lt;/th&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;th&gt;企业名称&lt;/th&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;th&gt;排序&lt;/th&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;th&gt;品牌介绍&lt;/th&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;th&gt;状态&lt;/th&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;th&gt;操作&lt;/th&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;    &lt;/tr&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>接下来遍历响应回来的数据 <code>brands</code> ，拿到每一条品牌数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; brands.<span class="property">length</span> ; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> brand = brands[i];</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>紧接着就是从 <code>brand</code> 对象中获取数据并且拼接 <code>数据行</code>，累加到 <code>tableData</code> 字符串变量中</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">tableData += <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;    &lt;tr align=\&quot;center\&quot;&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;td&gt;&quot;</span>+(i+<span class="number">1</span>)+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">brandName</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">companyName</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">ordered</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">description</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">status</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;        &lt;td&gt;&lt;a href=\&quot;#\&quot;&gt;修改&lt;/a&gt; &lt;a href=\&quot;#\&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;    &lt;/tr&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>最后再将拼接好的字符串写到表格中</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置表格数据</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;brandTable&quot;</span>).<span class="property">innerHTML</span> = tableData;</span><br></pre></td></tr></table></figure>

<p><strong>整体页面代码如下：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;addBrand.html&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;新增&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;brandTable&quot;</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 当页面加载完成后，发送ajax请求</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//2. 发送ajax请求</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">axios</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">method</span>:<span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-demo/selectAllServlet&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//获取数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> brands = resp.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> tableData = <span class="string">&quot; &lt;tr&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;        &lt;th&gt;序号&lt;/th&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;        &lt;th&gt;品牌名称&lt;/th&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;        &lt;th&gt;企业名称&lt;/th&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;        &lt;th&gt;排序&lt;/th&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;        &lt;th&gt;品牌介绍&lt;/th&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;        &lt;th&gt;状态&lt;/th&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;        &lt;th&gt;操作&lt;/th&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;    &lt;/tr&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; brands.<span class="property">length</span> ; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> brand = brands[i];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                tableData += <span class="string">&quot;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;    &lt;tr align=\&quot;center\&quot;&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;        &lt;td&gt;&quot;</span>+(i+<span class="number">1</span>)+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">brandName</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">companyName</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">ordered</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">description</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;        &lt;td&gt;&quot;</span>+brand.<span class="property">status</span>+<span class="string">&quot;&lt;/td&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;        &lt;td&gt;&lt;a href=\&quot;#\&quot;&gt;修改&lt;/a&gt; &lt;a href=\&quot;#\&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;\n&quot;</span> +</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;    &lt;/tr&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 设置表格数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;brandTable&quot;</span>).<span class="property">innerHTML</span> = tableData;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-添加品牌功能"><a href="#6-3-添加品牌功能" class="headerlink" title="6.3  添加品牌功能"></a>6.3  添加品牌功能</h3><p><img src="/assets/image-20210831100117014.png" alt="image-20210831100117014"></p>
<p>如上所示，当我们点击 <code>新增</code> 按钮，会跳转到 <code>addBrand.html</code> 页面。在 <code>addBrand.html</code> 页面输入数据后点击 <code>提交</code> 按钮，就会将数据提交到后端，而后端将数据保存到数据库中。</p>
<p>具体的前后端交互的流程如下：</p>
<p><img src="/assets/image-20210831100329698.png" alt="image-20210831100329698"></p>
<p>&#x3D;&#x3D;说明：&#x3D;&#x3D;</p>
<p>前端需要将用户输入的数据提交到后端，这部分数据需要以 json 格式进行提交，数据格式如下：</p>
<p><img src="/assets/image-20210831101234467.png" alt="image-20210831101234467"></p>
<h4 id="6-3-1-后端实现"><a href="#6-3-1-后端实现" class="headerlink" title="6.3.1  后端实现"></a>6.3.1  后端实现</h4><p>在 <code>com.itheima.web</code> 包下创建名为 <code>AddServlet</code> 的 <code>servlet</code>，具体的逻辑如下：</p>
<ul>
<li><p>获取请求参数</p>
<p>由于前端提交的是 json 格式的数据，所以我们不能使用 <code>request.getParameter()</code> 方法获取请求参数</p>
<ul>
<li>如果提交的数据格式是 <code>username=zhangsan&amp;age=23</code> ，后端就可以使用 <code>request.getParameter()</code> 方法获取</li>
<li>如果提交的数据格式是 json，后端就需要通过 request 对象获取输入流，再通过输入流读取数据</li>
</ul>
</li>
<li><p>将获取到的请求参数（json格式的数据）转换为 <code>Brand</code> 对象</p>
</li>
<li><p>调用 service 的 <code>add()</code> 方法进行添加数据的逻辑处理</p>
</li>
<li><p>将 json 数据响应回给浏览器。</p>
</li>
</ul>
<p><code>AddServlet</code> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/addServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">BrandService</span> <span class="variable">brandService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 接收数据,request.getParameter 不能接收json的数据</span></span><br><span class="line">       <span class="comment">/* String brandName = request.getParameter(&quot;brandName&quot;);</span></span><br><span class="line"><span class="comment">        System.out.println(brandName);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取请求体数据</span></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> request.getReader();</span><br><span class="line">        <span class="type">String</span> <span class="variable">params</span> <span class="operator">=</span> br.readLine();</span><br><span class="line">        <span class="comment">// 将JSON字符串转为Java对象</span></span><br><span class="line">        <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> JSON.parseObject(params, Brand.class);</span><br><span class="line">        <span class="comment">//2. 调用service 添加</span></span><br><span class="line">        brandService.add(brand);</span><br><span class="line">        <span class="comment">//3. 响应成功标识</span></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-3-2-前端实现"><a href="#6-3-2-前端实现" class="headerlink" title="6.3.2  前端实现"></a>6.3.2  前端实现</h4><p>在 <code>addBrand.html</code> 页面给 <code>提交</code> 按钮绑定点击事件，并在绑定的匿名函数中发送异步请求，代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 给按钮绑定单击事件</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//2. 发送ajax请求</span></span><br><span class="line">    <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-demo/addServlet&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:???</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">        <span class="comment">// 判断响应数据是否为 success</span></span><br><span class="line">        <span class="keyword">if</span>(resp.<span class="property">data</span> == <span class="string">&quot;success&quot;</span>)&#123;</span><br><span class="line">            location.<span class="property">href</span> = <span class="string">&quot;http://localhost:8080/brand-demo/brand.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们只需要考虑如何获取页面上用户输入的数据即可。</p>
<p>首先我们先定义如下的一个 js 对象，该对象是用来封装页面上输入的数据，并将该对象作为上面发送异步请求时 <code>data</code> 属性的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将表单数据转为json</span></span><br><span class="line"><span class="keyword">var</span> formData = &#123;</span><br><span class="line">    <span class="attr">brandName</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">companyName</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">ordered</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">description</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">status</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接下来获取输入框输入的数据，并将获取到的数据赋值给 <code>formData</code> 对象指定的属性。比如获取用户名的输入框数据，并把该数据赋值给 <code>formData</code> 对象的 <code>brandName</code> 属性</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取表单数据</span></span><br><span class="line"><span class="keyword">let</span> brandName = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;brandName&quot;</span>).<span class="property">value</span>;</span><br><span class="line"><span class="comment">// 设置数据</span></span><br><span class="line">formData.<span class="property">brandName</span> = brandName;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;说明：其他的输入框都用同样的方式获取并赋值。&#x3D;&#x3D;但是有一个比较特殊，就是状态数据，如下图是页面内容</p>
<img src="assets/image-20210831103843798.png" alt="image-20210831103843798" style="zoom:80%;" />

<p>我们需要判断哪儿个被选中，再将选中的单选框数据赋值给 <code>formData</code> 对象的 <code>status</code> 属性，代码实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> status = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;status&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; status.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(status[i].<span class="property">checked</span>)&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        formData.<span class="property">status</span> = status[i].<span class="property">value</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>整体页面代码如下：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>添加品牌<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>添加品牌<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    品牌名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;brandName&quot;</span> <span class="attr">name</span>=<span class="string">&quot;brandName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    企业名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;companyName&quot;</span> <span class="attr">name</span>=<span class="string">&quot;companyName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    排序：<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;ordered&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ordered&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    描述信息：<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;20&quot;</span> <span class="attr">id</span>=<span class="string">&quot;description&quot;</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    状态：</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span>禁用</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>启用<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 给按钮绑定单击事件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将表单数据转为json</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> formData = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">brandName</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">companyName</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">ordered</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">description</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">status</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取表单数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> brandName = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;brandName&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置数据</span></span></span><br><span class="line"><span class="language-javascript">        formData.<span class="property">brandName</span> = brandName;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取表单数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> companyName = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;companyName&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置数据</span></span></span><br><span class="line"><span class="language-javascript">        formData.<span class="property">companyName</span> = companyName;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取表单数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> ordered = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ordered&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置数据</span></span></span><br><span class="line"><span class="language-javascript">        formData.<span class="property">ordered</span> = ordered;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取表单数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> description = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;description&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置数据</span></span></span><br><span class="line"><span class="language-javascript">        formData.<span class="property">description</span> = description;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> status = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&quot;status&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; status.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(status[i].<span class="property">checked</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                formData.<span class="property">status</span> = status[i].<span class="property">value</span> ;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//console.log(formData);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//2. 发送ajax请求</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">axios</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-demo/addServlet&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>:formData</span></span><br><span class="line"><span class="language-javascript">        &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 判断响应数据是否为 success</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(resp.<span class="property">data</span> == <span class="string">&quot;success&quot;</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                location.<span class="property">href</span> = <span class="string">&quot;http://localhost:8080/brand-demo/brand.html&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;说明：&#x3D;&#x3D;</p>
<p><code>查询所有</code> 功能和 <code>添加品牌</code> 功能就全部实现，大家肯定会感觉前端的代码很复杂；而这只是暂时的，后面学习了 <code>vue</code> 前端框架后，这部分前端代码就可以进行很大程度的简化。</p>
]]></content>
  </entry>
</search>
